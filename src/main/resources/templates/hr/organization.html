<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}" lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>ì¡°ì§ë„ ê´€ë¦¬</title>
  <link rel="stylesheet" href="https://uicdn.toast.com/tui.grid/latest/tui-grid.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://uicdn.toast.com/tui.grid/latest/tui-grid.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background: #f8f9fa;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .header-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .content-section {
      display: flex;
      gap: 20px;
    }

    .org-chart {
      width: 30%;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .employee-table {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .department-tree ul {
      list-style: none;
      padding-left: 20px;
    }

    .toggle-btn {
      cursor: pointer;
      margin-right: 5px;
    }

    #grid {
      width: 100%;
      height: 300px;
    }
  </style>
</head>

<body layout:fragment="content">
  <div class="container mt-3">
    <div class="header-section">
      <h5 class="fw-bold">ì¸ì‚¬ ê´€ë¦¬ / ì¡°ì§ë„ ê´€ë¦¬</h5>
      <div class="d-flex gap-2">
        <button class="btn btn-primary btn-sm">â• ë¶€ì„œ ì¶”ê°€</button>
        <button class="btn btn-secondary btn-sm" disabled>âœï¸ ë¶€ì„œ ìˆ˜ì •</button>
        <button class="btn btn-danger btn-sm">âŒ ë¶€ì„œ ì‚­ì œ</button>
      </div>
    </div>

    <div class="content-section">
      <section class="org-chart">
        <input type="text" class="form-control mb-3" placeholder="ë¶€ì„œ ê²€ìƒ‰ í›„ [Enter]">
        <div class="department-tree">
			<ul>
			    <!-- âœ… íšŒì‚¬ ì •ë³´ -->
			    <li th:data-company-id="${company.companyNum}">
			        <span class="toggle-btn">â–¶</span> 
			        <span th:text="${company.companyName}"></span> / 
			        <span th:text="${company.companyEngName}"></span> 
			        (<span th:text="${company.totalEmployeeCount}"></span>)
			
			        <ul>
			            <!-- âœ… ë³¸ì‚¬ & ì§€ì  -->
			            <li th:each="dept : ${departments}" th:if="${dept.parentDepartmentNum == null}" th:data-dept-id="${dept.departmentNum}">
			                <span class="toggle-btn">â–¶</span> 
			                <span th:text="${dept.departmentName}"></span> 
			                (<span th:text="${dept.totalEmployeeCount}"></span>)
			
			                <ul>
			                    <!-- âœ… í•˜ìœ„ ë¶€ì„œ -->
			                    <li th:each="subDept : ${departments}" th:if="${subDept.parentDepartmentNum == dept.departmentNum}" th:data-dept-id="${subDept.departmentNum}">
			                        ğŸ“„ <span th:text="${subDept.departmentName}"></span> 
			                        (<span th:text="${subDept.totalEmployeeCount}"></span>)
			                    </li>
			                </ul>
			            </li>
			        </ul>
			    </li>
			</ul>
        </div>
      </section>

      <section class="employee-table">
        <h5 class="fw-bold">ì„ íƒí•œ ë¶€ì„œ: ì„ íƒí•œë¶€ì„œì´ë¦„</h5>
        <input type="text" class="form-control mb-3" placeholder="ì‚¬ì› ê²€ìƒ‰ í›„ [Enter]">
        <div id="grid"></div>
      </section>
    </div>
  </div>

  <script>
	  $(document).ready(function () {
		    // âœ… íŠ¸ë¦¬ ë©”ë‰´ í† ê¸€ ë²„íŠ¼
		    $(document).on("click", ".toggle-btn", function () {
		        $(this).siblings("ul").toggle(); // í•˜ìœ„ ë¶€ì„œ ëª©ë¡ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
		        $(this).text($(this).text() === "â–¶" ? "â–¼" : "â–¶"); // ë²„íŠ¼ ì•„ì´ì½˜ ë³€ê²½
		    });
	
		    // âœ… ë¶€ì„œ í´ë¦­ ì‹œ ì§ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
		    $(document).on("click", ".department-tree li", function () {
		        let departmentNum = $(this).data("dept-id"); // ë¶€ì„œë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
		        let isCompany = $(this).hasClass("company-node"); // íšŒì‚¬ì¸ì§€ í™•ì¸
		        let departmentName = $(this).find("span").first().text().trim(); // ë¶€ì„œëª… ê°€ì ¸ì˜¤ê¸°
	
		        console.log("ğŸ“Œ ì„ íƒí•œ ì¡°ì§ ë²ˆí˜¸:", departmentNum, "íšŒì‚¬ ì—¬ë¶€:", isCompany);
	
		        // âœ… UI ì—…ë°ì´íŠ¸ (ì„ íƒí•œ ë¶€ì„œ ì´ë¦„ í‘œì‹œ)
		        $(".employee-table h5").text("ì„ íƒí•œ ë¶€ì„œ: " + departmentName);
	
		        // âœ… AJAX ìš”ì²­ìœ¼ë¡œ ì§ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
		        $.ajax({
		            url: isCompany ? `/api/hr/employees/company/${departmentNum}` : `/api/hr/employees/${departmentNum}`,
		            type: "GET",
		            dataType: "json",
		            success: function (data) {
		                console.log("âœ… ì¡°íšŒëœ ì‚¬ì› ëª©ë¡:", data);
		                grid.resetData(data);
		            },
		            error: function (xhr, status, error) {
		                console.error("ğŸš¨ ì‚¬ì› ì¡°íšŒ ì˜¤ë¥˜:", error);
		            }
		        });
		    });
	
		    // âœ… TUI Grid ì´ˆê¸°í™”
		    const grid = new tui.Grid({
		        el: document.getElementById("grid"),
		        pageOptions: {
		            useClient: true, // âœ… í´ë¼ì´ì–¸íŠ¸ ì¸¡ í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
		            perPage: 5
		        },
		        columns: [
		            { header: "ì‚¬ì› ID", name: "employeeId" },
		            { header: "ì‚¬ì›ëª…", name: "employeeName" },
		            { header: "ì´ë©”ì¼", name: "email" },
		            { header: "ì§ê¸‰", name: "position" },
		            { header: "ë¶€ì„œ", name: "departmentName" }
		        ]
		    });
		});



  </script>
</body>
</html>