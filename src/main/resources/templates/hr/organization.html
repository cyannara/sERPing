<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}" lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>ì¡°ì§ë„ ê´€ë¦¬</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background: #f8f9fa;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .header-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    .content-section {
      display: flex;
      gap: 20px;
    }
    .org-chart {
      width: 30%;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .employee-table {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .department-tree ul {
      list-style: none;
      padding-left: 20px;
    }
    .toggle-btn {
      cursor: pointer;
      margin-right: 5px;
    }
    .select-wrapper {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    #grid {
      width: 100%;
      height: 300px;
    }
    .profile-image {
    width: 150px; /* ê°€ë¡œ í¬ê¸° ê³ ì • */
    height: auto; /* ì„¸ë¡œ í¬ê¸°ëŠ” ë¹„ìœ¨ ìœ ì§€ */
    border-radius: 5px; /* ì„ íƒì : ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    object-fit: contain; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€ */
}
  </style>
</head>

<body layout:fragment="content">

  <div class="container mt-3">
    <div class="header-section">
      <h5 class="fw-bold">ì¸ì‚¬ ê´€ë¦¬ / ì¡°ì§ë„ ê´€ë¦¬</h5>
      <div class="d-flex gap-2">
		<button id="addDeptBtn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#deptModal">
		    <i class="fas fa-plus-circle"></i> ë¶€ì„œ ì¶”ê°€
		</button>
		<button id="editDeptBtn" class="btn btn-secondary" disabled><i class="fas fa-pencil-alt"></i> ë¶€ì„œ ìˆ˜ì •</button>
      </div>
    </div>

    <div class="content-section">
      <section class="org-chart">
        <input type="text" class="form-control mb-3" id="deptSearchKW" placeholder="ë¶€ì„œ ê²€ìƒ‰ í›„ [Enter]">
        <div class="department-tree">
            <ul>
                <!-- íšŒì‚¬ ì •ë³´ -->
                <li th:data-company-id="${company.companyNum}" class="select-item" id="selectCompanySJ">
                    <div class="select-wrapper" id="comClick">
                        <span class="toggle-btn">â–¼</span> 
                   		<input type="checkbox" class="dept-checkbox" value="company" disabled />
                        <span class="select-text" th:text="${company.companyName}" id="selectComKorName"></span> <span> / </span> 
                        <span class="select-text" th:text="${company.companyEngName}" id="selectComEngName"></span> 
                        (<span class="count" th:text="${company.totalEmployeeCount}"></span>)
                    </div>
                    <ul class="sub-list company-sub-list">
                        <!-- ë³¸ì‚¬ & ì§€ì  -->
	                    <li th:each="dept : ${departments}" th:if="${dept.parentDepartmentNum == null}" 
	                        th:data-dept-id="${dept.departmentNum}" class="select-item selectTopDept">
	                        <div class="select-wrapper" id="topDeptClick">
	                            <span class="toggle-btn">â–¼</span> 
	                            <input type="checkbox" class="dept-checkbox" th:value="${dept.departmentNum}" />
	                            <span class="select-text" th:text="${dept.departmentName}"></span> 
	                            (<span class="count" th:text="${dept.totalEmployeeCount}"></span>)
	                        </div>
	                        <ul class="sub-list">
                                <!-- í•˜ìœ„ ë¶€ì„œ -->
                            <li th:each="subDept : ${departments}" th:if="${subDept.parentDepartmentNum == dept.departmentNum}" 
                                th:data-dept-id="${subDept.departmentNum}" class="select-item selectSubDept">
                                <div class="select-wrapper" id="subDeptClick">
                                    <input type="checkbox" class="dept-checkbox" th:value="${subDept.departmentNum}" />
                                    ğŸ“„ <span class="select-text" th:text="${subDept.departmentName}"></span> 
                                    (<span class="count" th:text="${subDept.totalEmployeeCount}"></span>)
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
  </section>

      <section class="employee-table">
        <h5 class="fw-bold">ì‚¬ì› ëª©ë¡</h5>
        <div id="grid"></div>
      </section>
    </div>
    
    
    <!-- ì‚¬ì› ì •ë³´ / ì¸ì‚¬ ë°œë ¹ ëª¨ë‹¬ -->
<div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div class="modal-header">
        <h5 class="modal-title" id="employeeModalLabel">ì‚¬ì› ì •ë³´</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- ëª¨ë‹¬ ë°”ë”” -->
      <div class="modal-body">
        <div class="row">
          <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
          <div class="col-md-3 text-center">
            <img src="https://via.placeholder.com/150" class="profile-image" id="modalProfileImage" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
          </div>

          <!-- ì‚¬ì› ì •ë³´ -->
          <div class="col-md-9">
            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì‚¬ì›ë²ˆí˜¸</label>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modalEmployeeId" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì‚¬ì›ëª…</label>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modalEmployeeName" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì§ê¸‰</label>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modalPosition" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ë¶€ì„œ</label>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modalDepartment" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì…ì‚¬ì¼</label>
              <div class="col-md-8">
                <input type="date" class="form-control" id="modalHireDate" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì—°ë½ì²˜</label>
              <div class="col-md-8">
                <input type="text" class="form-control" id="modalPhone" readonly>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-md-4 fw-bold">ì´ë©”ì¼</label>
              <div class="col-md-8">
                <input type="email" class="form-control" id="modalEmail" readonly>
              </div>
            </div>

            <!-- ì¸ì‚¬ ë°œë ¹ ì‹œ ë³´ì¼ ë¶€ë¶„ (ìˆ¨ê¹€ ì²˜ë¦¬) -->
            <div id="transferFields" style="display: none;">
              <hr>
              <div class="row mb-2">
                <label class="col-md-4 fw-bold">ì´ì „ ì§ê¸‰</label>
                <div class="col-md-8">
                  <input type="text" class="form-control" id="modalOldPosition" readonly>
                </div>
              </div>

              <div class="row mb-2">
                <label class="col-md-4 fw-bold">ì´ì „ ë¶€ì„œ</label>
                <div class="col-md-8">
                  <input type="text" class="form-control" id="modalOldDepartment" readonly>
                </div>
              </div>

              <div class="row mb-2">
                <label class="col-md-4 fw-bold">ë°œë ¹ ì§ê¸‰</label>
                <div class="col-md-8">
                  <select class="form-select" id="modalNewPosition"></select>
                </div>
              </div>

              <div class="row mb-2">
                <label class="col-md-4 fw-bold">ë°œë ¹ ë¶€ì„œ</label>
                <div class="col-md-8">
                  <select class="form-select" id="modalNewDepartment"></select>
                </div>
              </div>

              <div class="row mb-2">
                <label class="col-md-4 fw-bold">ë°œë ¹ ì‚¬ìœ </label>
                <div class="col-md-8">
                  <textarea class="form-control" id="modalReason" rows="2"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ëª¨ë‹¬ í‘¸í„° -->
      <div class="modal-footer d-flex justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>
    
  </div>


  <script th:inline="javascript">
  let companyNumSJ = /*[[${session.companyNum}]]*/ null;
  let companyNum = /*[[${session.companyNum}]]*/ null; 
  let departmentNumSJ = 0;
  
  const header = document.querySelector('meta[name="_csrf_header"]').content;
  const token = document.querySelector('meta[name="_csrf"]').content;
  
  const dataSource = {
	        api: {
	            readData: {
	                url: '/hr/rest/emp/organization',
	                method: 'GET',
	                initParams: { companyNum:companyNumSJ , departmentNum:departmentNumSJ  }
	            }
	        },
	        contentType: 'application/json',
	    };
  
  
  function formatPhoneNumber(phoneNumber) {
	    if (!phoneNumber) return ""; // ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
	    phoneNumber = phoneNumber.replace(/\D/g, ""); // ìˆ«ì ì´ì™¸ì˜ ë¬¸ì ì œê±°

	    if (phoneNumber.length === 11) {
	        return phoneNumber.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
	    } else if (phoneNumber.length === 10) {
	        return phoneNumber.replace(/(\d{3})(\d{3})(\d{4})/, "$1-$2-$3");
	    }
	    return phoneNumber; // ìœ„ ì¡°ê±´ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ì›ë³¸ ë°˜í™˜
	}
  
  // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ (ì „ì—­ í•¨ìˆ˜ë¡œ ì •ì˜)
  function openEmployeeModal(mode, data) {
	  console.log("ğŸ“Œ ëª¨ë‹¬ ë°ì´í„°:", data); // ğŸ”¥ ë°ì´í„° í™•ì¸
	  
    $("#employeeModalLabel").text(mode === "transfer" ? "ì¸ì‚¬ ë°œë ¹" : "ì‚¬ì› ì •ë³´");

    $("#modalEmployeeId").val(data.employeeId);
    $("#modalEmployeeName").val(data.employeeName);
    $("#modalPosition").val(data.position);
    $("#modalDepartment").val(data.departmentName);
    // hireDate í¬ë§·íŒ…
    $("#modalHireDate").val(data.hireDate ? data.hireDate.split("T")[0] : ""); 
    // ì—°ë½ì²˜ ìë™ í¬ë§· ì ìš©
    $("#modalPhone").val(formatPhoneNumber(data.phone));
    $("#modalEmail").val(data.email);
    $("#modalProfileImage").attr("src", data.profileImage || "https://via.placeholder.com/150");

    if (mode === "transfer") {
      $("#transferFields").show();
      $("#transferBtn").show();
      $("#saveBtn").hide();
    } else {
      $("#transferFields").hide();
      $("#transferBtn").hide();
      $("#saveBtn").show();
    }

    $("#employeeModal").modal('show');
  }

      $(document).ready(function () {
    	  
    	    // âœ… ë¶€ì„œ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
    	    $("#addDeptBtn").click(function () {
    	        $("#deptParent").val(""); // ê¸°ë³¸ê°’ ì„¤ì •
    	        $("#deptName").val("");
    	        $("#deptModal").modal("show");
    	    });

    	    // âœ… ë¶€ì„œ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ API í˜¸ì¶œ
    	    $("#saveDeptBtn").click(function() {
    	        let selectedParent = $("#deptParent option:selected");
    	        let deptData = {
    	            departmentName: $("#deptName").val(),
    	            parentDepartmentNum: selectedParent.val() || null, // ìµœìƒìœ„ ë¶€ì„œë©´ null
    	            companyNum: companyNum, // ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
    	            departmentType: selectedParent.data("type") || "DT003",  // ê¸°ë³¸ê°’ ì„¤ì •
    	        };

    	        console.log("ğŸ“Œ ë¶€ì„œ ì¶”ê°€ ìš”ì²­ ë°ì´í„°:", deptData);

    	        $.ajax({
    	            url: "/hr/rest/dept/add",
    	            type: "POST",
    	            contentType: "application/json",
    	            data: JSON.stringify(deptData),
    	            beforeSend: function(xhr) {
    	                xhr.setRequestHeader(header, token); // âœ… CSRF í† í° ì¶”ê°€
    	            },
    	            success: function(response) {
    	                alert("âœ… ë¶€ì„œ ì¶”ê°€ ì„±ê³µ!");
    	                $("#deptModal").modal("hide");
    	                location.reload();
    	            },
    	            error: function(xhr, status, error) {
    	                alert("âŒ ë¶€ì„œ ì¶”ê°€ ì‹¤íŒ¨! " + xhr.responseText);
    	            }
    	        });
    	    });
    	    
		// ë¶€ì„œ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ
		
	    // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ë¶€ì„œ ìˆ˜ì • ë²„íŠ¼ í™œì„±í™”
	    $(document).on("change", ".dept-checkbox", function () {
	        let selectedDept = $(".dept-checkbox:checked");
	
	        if (selectedDept.length === 1) {
	            $("#editDeptBtn").prop("disabled", false); // ë²„íŠ¼ í™œì„±í™”
	        } else {
	            $("#editDeptBtn").prop("disabled", true); // ë²„íŠ¼ ë¹„í™œì„±í™”
	        }
	    });
		
		
	    // âœ… ë¶€ì„œ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
	    $(document).on("click", "#editDeptBtn", function () {
	        let selectedDept = $(".dept-checkbox:checked");

	        if (selectedDept.length !== 1) {
	            alert("ìˆ˜ì •í•  ë¶€ì„œë¥¼ í•˜ë‚˜ë§Œ ì„ íƒí•˜ì„¸ìš”.");
	            return;
	        }

	        let departmentNum = selectedDept.val(); // ì„ íƒëœ ë¶€ì„œ ID ê°€ì ¸ì˜¤ê¸°
	        console.log("ğŸ“Œ ì„ íƒëœ ë¶€ì„œ ID:", departmentNum); // ë””ë²„ê¹…ìš©

	        // âœ… ì„ íƒëœ ë¶€ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (AJAX ìš”ì²­)
	        $.ajax({
	            url: `/hr/rest/dept/get/${departmentNum}`, // ë¶€ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” API í˜¸ì¶œ
	            type: "GET",
	            contentType: "application/json",
	            beforeSend: function(xhr) {
	                xhr.setRequestHeader(header, token); // CSRF í† í° ì¶”ê°€
	            },
	            success: function(response) {
	                console.log("ğŸ“Œ ë¶€ì„œ ì •ë³´ ì‘ë‹µ:", response); // ë””ë²„ê¹…ìš©

	                // âœ… ë¶€ì„œ ì •ë³´ ëª¨ë‹¬ì— ì±„ìš°ê¸°
	                $("#editDeptId").val(response.departmentNum);  // ë¶€ì„œ ID
	                $("#editDeptName").val(response.departmentName); // ë¶€ì„œëª…
	                $("#editDeptStatus").val(response.departmentStatus); // ë¶€ì„œ ìƒíƒœ

	                // âœ… ëª¨ë‹¬ ì—´ê¸°
	                $("#editDeptModal").modal("show");
	            },
	            error: function(xhr, status, error) {
	                alert("âŒ ë¶€ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
	                console.error("âŒ ì˜¤ë¥˜:", xhr.responseText);
	            }
	        });
	    });
		
		
		$("#saveEditDeptBtn").click(function () {
		    let deptId = $("#editDeptId").val();
		    let updatedDeptName = $("#editDeptName").val().trim();
		    let updatedDeptStatus = $("#editDeptStatus").val();
		
		    if (!updatedDeptName) {
		        alert("ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
		        return;
		    }
		
		    // âœ… ë¹„í™œì„±í™”í•˜ë ¤ë©´ ì†Œì†ëœ ì‚¬ì›ì´ ì—†ì–´ì•¼ í•¨
		    if (updatedDeptStatus === "DU002") {
		        $.ajax({
		            url: `/hr/rest/dept/employees/${deptId}`, // ë¶€ì„œ ë‚´ ì‚¬ì› ìˆ˜ í™•ì¸ API
		            type: "GET",
		            success: function(response) {
		            	
		            	console.log("ğŸ“Œ ë¶€ì„œ ì§ì› ìˆ˜:", response.employeeCount); // ë””ë²„ê¹…
		                console.log("ğŸ“Œ ì‘ë‹µ ë°ì´í„°:", response); // ğŸ”¥ ë°ì´í„° í™•ì¸
		                
		                if (response.employeeCount > 0) {
		                    alert("í•´ë‹¹ ë¶€ì„œì— ì†Œì†ëœ ì‚¬ì›ì´ ìˆì–´ ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		                } else {
		                    console.log("ğŸ“Œ ì‚¬ì› ì—†ìŒ â†’ ë¶€ì„œ ë¹„í™œì„±í™” ì§„í–‰"); // ğŸ”¥ ë””ë²„ê¹…ìš© ë¡œê·¸
		                    updateDepartment(deptId, updatedDeptName, updatedDeptStatus);
		                }
		            },
		            error: function() {
		                alert("ë¶€ì„œ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
		            }
		        });
		    } else {
		    	updateDepartment(deptId, updatedDeptName, updatedDeptStatus);
		    }
		});
		
		// âœ… ë¶€ì„œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
		function updateDepartment(deptId, updatedDeptName, updatedDeptStatus) {
		    let deptData = {
		        departmentNum: deptId,
		        departmentName: updatedDeptName,
		        departmentStatus: updatedDeptStatus
		    };
		
		    $.ajax({
		        url: "/hr/rest/dept/update",
		        type: "PUT",
		        contentType: "application/json",
		        data: JSON.stringify(deptData),
		        beforeSend: function(xhr) {
		            xhr.setRequestHeader(header, token); // âœ… CSRF í† í° ì¶”ê°€
		        },
		        success: function(response) {
		            alert("âœ… ë¶€ì„œ ìˆ˜ì • ì„±ê³µ!");
		            $("#editDeptModal").modal("hide");
		            location.reload();
		        },
		        error: function(xhr, status, error) {
		            alert("âŒ ë¶€ì„œ ìˆ˜ì • ì‹¤íŒ¨! " + xhr.responseText);
		        }
		    });
		}

    	  

    	  
    	  
          $(".company-sub-list, .sub-list").show();

          // ë¶€ì„œ íŠ¸ë¦¬ í† ê¸€ ê¸°ëŠ¥ë§Œ ìœ ì§€
          $(document).on("click", ".toggle-btn", function (event) {
              event.stopPropagation();
              let $targetList = $(this).closest("li").children("ul.sub-list");
              $targetList.slideToggle(200);
              $(this).text($(this).text() === "â–¼" ? "â–¶" : "â–¼");
          });

          // Toast Grid ì´ˆê¸°í™” (ë°ì´í„° ì—†ì´)
          const grid = new tui.Grid({
              el: document.getElementById("grid"),
              pageOptions: { useClient: false, perPage: 5 },
              data: dataSource,
              columns: [
                  { header: "ì‚¬ì› ID", name: "employeeId" },
                  { header: "ì‚¬ì›ëª…", name: "employeeName" },
                  { header: "ì´ë©”ì¼", name: "email" },
                  { header: "ì§ê¸‰", name: "position" },
                  { header: "ë¶€ì„œ", name: "departmentName" }
              ]
          });

          
          // Toast Grid í´ë¦­ ì´ë²¤íŠ¸ (ëª¨ë‹¬ ì—´ê¸°)
          grid.on('click', function(ev) {
            if (ev.rowKey !== null) {
              let rowData = grid.getRow(ev.rowKey); // ì„ íƒí•œ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              openEmployeeModal("view", rowData);
            }
          });

          
          
       // ë¶€ì„œ ì„ íƒ ì‹œ ë°ì´í„° ë¡œë“œ
          $(document).on('click', '.department-tree [data-company-id], .department-tree [data-dept-id]', function(event) {
        	    event.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œë¡œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€

        	    let companyId = $(this).data('company-id'); // `data-company-id` ê°’ ê°€ì ¸ì˜¤ê¸°
        	    let departmentNum = $(this).data('dept-id'); // `data-dept-id` ê°’ ê°€ì ¸ì˜¤ê¸°

        	    if (companyId !== undefined) {
        	        
        	        departmentNumSJ=0;
        	        fetch(`/hr/rest/emp/organization?perPage=5&companyNum=${companyNum}&departmentNum=${departmentNumSJ}&page=1`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            "X-CSRF-Token": token
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        grid.resetData(data.data.contents);  // ì˜µì…˜ í…Œì´ë¸” ë°ì´í„° ì—…ë°ì´íŠ¸
                        console.log(data);
                    })
                    .catch(error => console.error("ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨:", error));
        	        
        	        
        	        
        	    } else if (departmentNum !== undefined) {
        	        departmentNumSJ = departmentNum;

        	     // ì¿¼ë¦¬ í˜¸ì¶œ
                    fetch(`/hr/rest/emp/organization?perPage=5&companyNum=${companyNum}&departmentNum=${departmentNumSJ}&page=1`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            "X-CSRF-Token": token
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        grid.resetData(data.data.contents);  // ì˜µì…˜ í…Œì´ë¸” ë°ì´í„° ì—…ë°ì´íŠ¸
                        console.log(data);
                    })
                    .catch(error => console.error("ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨:", error));
        	        
        	    }
        	});
      });
      
      
      



      
  </script>
  
	<!-- âœ… ë¶€ì„œ ì¶”ê°€ ëª¨ë‹¬ -->
	<div class="modal fade" id="deptModal" tabindex="-1" aria-labelledby="deptModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <!-- ëª¨ë‹¬ í—¤ë” -->
	      <div class="modal-header">
	        <h5 class="modal-title" id="deptModalLabel">ë¶€ì„œ ì¶”ê°€</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	
	      <!-- ëª¨ë‹¬ ë°”ë”” -->
	      <div class="modal-body">
	        <form id="addDeptForm">
	          <!-- âœ… ìƒìœ„ ë¶€ì„œ ì„ íƒ -->
	          <div class="mb-3">
	            <label class="fw-bold">ìƒìœ„ ë¶€ì„œ</label>
	            <select class="form-select" id="deptParent">
	              <option value="">(ìµœìƒìœ„ ë¶€ì„œ)</option>
	              <option th:each="dept : ${departments}" th:value="${dept.departmentNum}" th:text="${dept.departmentName}"></option>
	            </select>
	          </div>
	
	          <!-- âœ… ë¶€ì„œëª… ì…ë ¥ -->
	          <div class="mb-3">
	            <label class="fw-bold">ë¶€ì„œëª…</label>
	            <input type="text" class="form-control" id="deptName" required>
	          </div>
	        </form>
	      </div>
	
	      <!-- ëª¨ë‹¬ í‘¸í„° -->
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
	        <button type="button" class="btn btn-primary" id="saveDeptBtn">ì €ì¥</button>
	      </div>
	    </div>
	  </div>
	</div>
	
<!-- âœ… ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade" id="editDeptModal" tabindex="-1" aria-labelledby="editDeptModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- ëª¨ë‹¬ í—¤ë” -->
      <div class="modal-header">
        <h5 class="modal-title" id="editDeptModalLabel">ë¶€ì„œ ìˆ˜ì •</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- ëª¨ë‹¬ ë°”ë”” -->
      <div class="modal-body">
        <form id="editDeptForm">
          <input type="hidden" id="editDeptId">  <!-- ë¶€ì„œ ID ì €ì¥ -->

          <!-- âœ… ë¶€ì„œëª… ìˆ˜ì • -->
          <div class="mb-3">
            <label class="fw-bold">ë¶€ì„œëª…</label>
            <input type="text" class="form-control" id="editDeptName" required>
          </div>

          <!-- âœ… í™œì„±í™” ì—¬ë¶€ -->
          <div class="mb-3">
            <label class="fw-bold">ìƒíƒœ</label>
            <select class="form-select" id="editDeptStatus">
              <option value="DU001">ìš´ì˜ì¤‘</option>
              <option value="DU002">ë¹„í™œì„±</option>
            </select>
          </div>
        </form>
      </div>

      <!-- ëª¨ë‹¬ í‘¸í„° -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="button" class="btn btn-primary" id="saveEditDeptBtn">ì €ì¥</button>
      </div>
    </div>
  </div>
</div>


  
  
</body>
</html>
