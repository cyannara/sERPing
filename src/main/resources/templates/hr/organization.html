<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}" lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>ì¡°ì§ë„ ê´€ë¦¬</title>
  <link rel="stylesheet" href="https://uicdn.toast.com/tui.grid/latest/tui-grid.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://uicdn.toast.com/tui.grid/latest/tui-grid.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background: #f8f9fa;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .header-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }
    .content-section {
      display: flex;
      gap: 20px;
    }
    .org-chart {
      width: 30%;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .employee-table {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .department-tree ul {
      list-style: none;
      padding-left: 20px;
    }
    .toggle-btn {
      cursor: pointer;
      margin-right: 5px;
    }
    .select-wrapper {
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    #grid {
      width: 100%;
      height: 300px;
    }
  </style>
</head>

<body layout:fragment="content">
  <div class="container mt-3">
    <div class="header-section">
      <h5 class="fw-bold">ì¸ì‚¬ ê´€ë¦¬ / ì¡°ì§ë„ ê´€ë¦¬</h5>
      <div class="d-flex gap-2">
        <button class="btn btn-primary btn-sm">â• ë¶€ì„œ ì¶”ê°€</button>
        <button class="btn btn-secondary btn-sm" disabled>âœï¸ ë¶€ì„œ ìˆ˜ì •</button>
        <button class="btn btn-danger btn-sm">âŒ ë¶€ì„œ ì‚­ì œ</button>
      </div>
    </div>

    <div class="content-section">
      <section class="org-chart">
        <input type="text" class="form-control mb-3" id="deptSearchKW" placeholder="ë¶€ì„œ ê²€ìƒ‰ í›„ [Enter]">
        <div class="department-tree">
            <ul>
                <!-- âœ… íšŒì‚¬ ì •ë³´ -->
                <li th:data-company-id="${company.companyNum}" class="select-item" id="selectCompanySJ">
                    <div class="select-wrapper" id="comClick">
                        <span class="toggle-btn">â–¼</span> 
                        <span class="select-text" th:text="${company.companyName}" id="selectComKorName"></span> <span> / </span> 
                        <span class="select-text" th:text="${company.companyEngName}" id="selectComEngName"></span> 
                        (<span class="count" th:text="${company.totalEmployeeCount}"></span>)
                    </div>
                    <ul class="sub-list company-sub-list">
                        <!-- âœ… ë³¸ì‚¬ & ì§€ì  -->
                        <li th:each="dept : ${departments}" th:if="${dept.parentDepartmentNum == null}" th:data-dept-id="${dept.departmentNum}" class="select-item selectTopDept">
                            <div class="select-wrapper" id="topDeptClick">
                                <span class="toggle-btn">â–¼</span> 
                                <span class="select-text" th:text="${dept.departmentName}"></span> 
                                (<span class="count" th:text="${dept.totalEmployeeCount}"></span>)
                            </div>
                            <ul class="sub-list">
                                <!-- âœ… í•˜ìœ„ ë¶€ì„œ -->
                                <li th:each="subDept : ${departments}" th:if="${subDept.parentDepartmentNum == dept.departmentNum}" th:data-dept-id="${subDept.departmentNum}" class="select-item selectSubDept">
                                    <div class="select-wrapper" id="subDeptClick">
                                        ğŸ“„ <span class="select-text" th:text="${subDept.departmentName}"></span> 
                                        (<span class="count" th:text="${subDept.totalEmployeeCount}"></span>)
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
      </section>

      <section class="employee-table">
        <h5 class="fw-bold">ì‚¬ì› ëª©ë¡</h5>
        <div id="grid"></div>
      </section>
    </div>
  </div>

  <script th:inline="javascript">
  let companyNumSJ = [[${company.companyNum}]];
  let departmentNumSJ = 0;
  
  
  const dataSource = {
	        api: {
	            readData: {
	                url: 'http://localhost:81/hr/rest/emp/organization',
	                method: 'GET',
	                initParams: { companyNum:companyNumSJ , departmentNum:departmentNumSJ  }
	            }
	        },
	        contentType: 'application/json',
	    };

      $(document).ready(function () {
          $(".company-sub-list, .sub-list").show();

          // âœ… ë¶€ì„œ íŠ¸ë¦¬ í† ê¸€ ê¸°ëŠ¥ë§Œ ìœ ì§€
          $(document).on("click", ".toggle-btn", function (event) {
              event.stopPropagation();
              let $targetList = $(this).closest("li").children("ul.sub-list");
              $targetList.slideToggle(200);
              $(this).text($(this).text() === "â–¼" ? "â–¶" : "â–¼");
          });

          // âœ… Toast Grid ì´ˆê¸°í™” (ë°ì´í„° ì—†ì´)
          const grid = new tui.Grid({
              el: document.getElementById("grid"),
              pageOptions: { useClient: false, perPage: 2 }, // âœ… í´ë¼ì´ì–¸íŠ¸ ëª¨ë“œ
              data: dataSource,
              columns: [
                  { header: "ì‚¬ì› ID", name: "employeeId" },
                  { header: "ì‚¬ì›ëª…", name: "employeeName" },
                  { header: "ì´ë©”ì¼", name: "email" },
                  { header: "ì§ê¸‰", name: "position" },
                  { header: "ë¶€ì„œ", name: "departmentName" }
              ]
          });

          
          
          
          $(document).on('click', '.department-tree [data-company-id], .department-tree [data-dept-id]', function(event) {
        	    event.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œë¡œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€

        	    let companyId = $(this).data('company-id'); // `data-company-id` ê°’ ê°€ì ¸ì˜¤ê¸°
        	    let departmentId = $(this).data('dept-id'); // `data-dept-id` ê°’ ê°€ì ¸ì˜¤ê¸°

        	    if (companyId !== undefined) {
        	        alert(`íšŒì‚¬ ID: ${companyId} í´ë¦­ë¨!`);
        	    } else if (departmentId !== undefined) {
        	        alert(`ë¶€ì„œ ID: ${departmentId} í´ë¦­ë¨!`);
        	    }
        	});
      });
      



      
  </script>
</body>
</html>
