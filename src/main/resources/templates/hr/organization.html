	<!DOCTYPE html>
	<html layout:decorate="~{layouts/layout}" lang="en"
	      xmlns:th="http://www.thymeleaf.org"
	      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	      xmlns="http://www.w3.org/1999/xhtml">
	<head>
	<meta charset="UTF-8">
	<title>Ï°∞ÏßÅÎèÑ Í¥ÄÎ¶¨</title>
	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
	  <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
	  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	  <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	  <style>
	    body {
	      font-family: "Inter", sans-serif;
	      background: #f8f9fa;
	    }
	    .container {
	      display: flex;
	      flex-direction: column;
	      gap: 15px;
	    }
	    .header-section {
	      display: flex;
	      flex-direction: column;
	      align-items: flex-start;
	      gap: 10px;
	    }
	    .content-section {
	      display: flex;
	      gap: 20px;
	    }
	    .org-chart {
	      width: 30%;
	      background: white;
	      padding: 20px;
	      border-radius: 5px;
	      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	    }
	    .employee-table {
	      flex: 1;
	      background: white;
	      padding: 20px;
	      border-radius: 5px;
	      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	    }
	    .department-tree ul {
	      list-style: none;
	      padding-left: 20px;
	    }
	    .toggle-btn {
	      cursor: pointer;
	      margin-right: 5px;
	    }
	    .select-wrapper {
	      cursor: pointer;
	      display: inline-flex;
	      align-items: center;
	      gap: 5px;
	    }
	    #grid {
	      width: 100%;
	      height: 300px;
	    }
	    .profile-image {
	    width: 150px; /* Í∞ÄÎ°ú ÌÅ¨Í∏∞ Í≥†Ï†ï */
	    height: auto; /* ÏÑ∏Î°ú ÌÅ¨Í∏∞Îäî ÎπÑÏú® Ïú†ÏßÄ */
	    border-radius: 5px; /* ÏÑ†ÌÉùÏ†Å: Î™®ÏÑúÎ¶¨ Îë•Í∏ÄÍ≤å */
	    object-fit: contain; /* Ïù¥ÎØ∏ÏßÄ ÎπÑÏú® Ïú†ÏßÄ */
	}
	  </style>
	</head>
	
	<body layout:fragment="content">
	
	  <div class="container mt-3">
	    <h2>Î∂ÄÏÑú Í¥ÄÎ¶¨</h2>
	    <div class="header-section">
	      <div class="d-flex gap-2">
			<button id="addDeptBtn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#deptModal">
			    <i class="fas fa-plus-circle"></i> Î∂ÄÏÑú Ï∂îÍ∞Ä
			</button>
			<button id="editDeptBtn" class="btn btn-secondary" disabled><i class="fas fa-pencil-alt"></i> Î∂ÄÏÑú ÏàòÏ†ï</button>
	      </div>
	    </div>
	
	    <div class="content-section">
	      <section class="org-chart">
	        <!-- <input type="text" class="form-control mb-3" id="deptSearchKW" placeholder="Î∂ÄÏÑú Í≤ÄÏÉâ ÌõÑ [Enter]"> -->
	        <div class="department-tree">
	            <ul>
	                <!-- ÌöåÏÇ¨ Ï†ïÎ≥¥ -->
	                <li th:data-company-id="${company.companyNum}" class="select-item" id="selectCompanySJ">
	                    <div class="select-wrapper" id="comClick">
	                        <span class="toggle-btn">‚ñº</span> 
	                   		<input type="checkbox" class="dept-checkbox" value="company" disabled />
	                        <span class="select-text" th:text="${company.companyName}" id="selectComKorName"></span> <span> / </span> 
	                        <span class="select-text" th:text="${company.companyEngName}" id="selectComEngName"></span> 
	                        (<span class="count" th:text="${company.totalEmployeeCount}"></span>)
	                    </div>
	                    <ul class="sub-list company-sub-list">
	                        <!-- Î≥∏ÏÇ¨ & ÏßÄÏ†ê -->
		                    <li th:each="dept : ${departments}" th:if="${dept.parentDepartmentNum == null}" 
		                        th:data-dept-id="${dept.departmentNum}" class="select-item selectTopDept">
		                        <div class="select-wrapper" id="topDeptClick">
		                            <span class="toggle-btn">‚ñº</span> 
		                            <input type="checkbox" class="dept-checkbox" th:value="${dept.departmentNum}" />
		                            <span class="select-text" th:text="${dept.departmentName}"></span> 
		                            (<span class="count" th:text="${dept.totalEmployeeCount}"></span>)
		                        </div>
		                        <ul class="sub-list">
	                                <!-- ÌïòÏúÑ Î∂ÄÏÑú -->
	                            <li th:each="subDept : ${departments}" th:if="${subDept.parentDepartmentNum == dept.departmentNum}" 
	                                th:data-dept-id="${subDept.departmentNum}" class="select-item selectSubDept">
	                                <div class="select-wrapper" id="subDeptClick">
	                                    <input type="checkbox" class="dept-checkbox" th:value="${subDept.departmentNum}" />
	                                    üìÑ <span class="select-text" th:text="${subDept.departmentName}"></span> 
	                                    (<span class="count" th:text="${subDept.totalEmployeeCount}"></span>)
	                                </div>
	                            </li>
	                        </ul>
	                    </li>
	                </ul>
	            </li>
	        </ul>
	    </div>
	  </section>
	
	      <section class="employee-table">
	        <h5 class="fw-bold">ÏÇ¨Ïõê Î™©Î°ù</h5>
	        <div id="grid"></div>
	      </section>
	    </div>
	    
	    
	    <!-- ÏÇ¨Ïõê Ï†ïÎ≥¥ / Ïù∏ÏÇ¨ Î∞úÎ†π Î™®Îã¨ -->
	<div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg">
	    <div class="modal-content">
	      <!-- Î™®Îã¨ Ìó§Îçî -->
	      <div class="modal-header">
	        <h5 class="modal-title" id="employeeModalLabel">ÏÇ¨Ïõê Ï†ïÎ≥¥</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	
	      <!-- Î™®Îã¨ Î∞îÎîî -->
	      <div class="modal-body">
	        <div class="row">
	          <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ -->
	          <div class="col-md-3 text-center">
	            <img src="https://via.placeholder.com/150" class="profile-image" id="modalProfileImage" alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ">
	          </div>
	
	          <!-- ÏÇ¨Ïõê Ï†ïÎ≥¥ -->
	          <div class="col-md-9">
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">ÏÇ¨ÏõêÎ≤àÌò∏</label>
	              <div class="col-md-8">
	                <input type="text" class="form-control" id="modalEmployeeId" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">ÏÇ¨ÏõêÎ™Ö</label>
	              <div class="col-md-8">
	                <input type="text" class="form-control" id="modalEmployeeName" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">ÏßÅÍ∏â</label>
	              <div class="col-md-8">
	                <input type="text" class="form-control" id="modalPosition" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">Î∂ÄÏÑú</label>
	              <div class="col-md-8">
	                <input type="text" class="form-control" id="modalDepartment" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">ÏûÖÏÇ¨Ïùº</label>
	              <div class="col-md-8">
	                <input type="date" class="form-control" id="modalHireDate" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">Ïó∞ÎùΩÏ≤ò</label>
	              <div class="col-md-8">
	                <input type="text" class="form-control" id="modalPhone" readonly>
	              </div>
	            </div>
	
	            <div class="row mb-2">
	              <label class="col-md-4 fw-bold">Ïù¥Î©îÏùº</label>
	              <div class="col-md-8">
	                <input type="email" class="form-control" id="modalEmail" readonly>
	              </div>
	            </div>
	
	            <!-- Ïù∏ÏÇ¨ Î∞úÎ†π Ïãú Î≥¥Ïùº Î∂ÄÎ∂Ñ (Ïà®ÍπÄ Ï≤òÎ¶¨) -->
	            <div id="transferFields" style="display: none;">
	              <hr>
	              <div class="row mb-2">
	                <label class="col-md-4 fw-bold">Ïù¥Ï†Ñ ÏßÅÍ∏â</label>
	                <div class="col-md-8">
	                  <input type="text" class="form-control" id="modalOldPosition" readonly>
	                </div>
	              </div>
	
	              <div class="row mb-2">
	                <label class="col-md-4 fw-bold">Ïù¥Ï†Ñ Î∂ÄÏÑú</label>
	                <div class="col-md-8">
	                  <input type="text" class="form-control" id="modalOldDepartment" readonly>
	                </div>
	              </div>
	
	              <div class="row mb-2">
	                <label class="col-md-4 fw-bold">Î∞úÎ†π ÏßÅÍ∏â</label>
	                <div class="col-md-8">
	                  <select class="form-select" id="modalNewPosition"></select>
	                </div>
	              </div>
	
	              <div class="row mb-2">
	                <label class="col-md-4 fw-bold">Î∞úÎ†π Î∂ÄÏÑú</label>
	                <div class="col-md-8">
	                  <select class="form-select" id="modalNewDepartment"></select>
	                </div>
	              </div>
	
	              <div class="row mb-2">
	                <label class="col-md-4 fw-bold">Î∞úÎ†π ÏÇ¨Ïú†</label>
	                <div class="col-md-8">
	                  <textarea class="form-control" id="modalReason" rows="2"></textarea>
	                </div>
	              </div>
	            </div>
	          </div>
	        </div>
	      </div>
	
	      <!-- Î™®Îã¨ Ìë∏ÌÑ∞ -->
	      <div class="modal-footer d-flex justify-content-center">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Îã´Í∏∞</button>
	      </div>
	    </div>
	  </div>
	</div>
	    
	  </div>
	
	
	  <script th:inline="javascript">
	  let companyNum = /*[[${session.companyNum}]]*/ null; 
	  let departmentNumSJ = 0;
	  
	  const header = document.querySelector('meta[name="_csrf_header"]').content;
	  const token = document.querySelector('meta[name="_csrf"]').content;
	  
	  const dataSource = {
		        api: {
		            readData: {
		                url: '/hr/rest/emp/organization',
		                method: 'GET',
		                initParams: { companyNum:companyNum, departmentNum:0 }
		            }
		        },
		        contentType: 'application/json',
		    };
	  
	  
	  function formatPhoneNumber(phoneNumber) {
		    if (!phoneNumber) return ""; // Í∞íÏù¥ ÏóÜÏúºÎ©¥ Îπà Î¨∏ÏûêÏó¥ Î∞òÌôò
		    phoneNumber = phoneNumber.replace(/\D/g, ""); // Ïà´Ïûê Ïù¥Ïô∏Ïùò Î¨∏Ïûê Ï†úÍ±∞
	
		    if (phoneNumber.length === 11) {
		        return phoneNumber.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
		    } else if (phoneNumber.length === 10) {
		        return phoneNumber.replace(/(\d{3})(\d{3})(\d{4})/, "$1-$2-$3");
		    }
		    return phoneNumber; // ÏúÑ Ï°∞Í±¥Ïóê Ìï¥ÎãπÌïòÏßÄ ÏïäÏúºÎ©¥ ÏõêÎ≥∏ Î∞òÌôò
		}
	  
	  // Î™®Îã¨ Ïó¥Í∏∞ Ìï®Ïàò (Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Ï†ïÏùò)
	  function openEmployeeModal(mode, data) {
		  console.log("üìå Î™®Îã¨ Îç∞Ïù¥ÌÑ∞:", data); // üî• Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
		  
	    $("#employeeModalLabel").text(mode === "transfer" ? "Ïù∏ÏÇ¨ Î∞úÎ†π" : "ÏÇ¨Ïõê Ï†ïÎ≥¥");
	
	    $("#modalEmployeeId").val(data.employeeId);
	    $("#modalEmployeeName").val(data.employeeName);
	    $("#modalPosition").val(data.position);
	    $("#modalDepartment").val(data.departmentName);
	    // hireDate Ìè¨Îß∑ÌåÖ
	    $("#modalHireDate").val(data.hireDate ? data.hireDate.split("T")[0] : ""); 
	    // Ïó∞ÎùΩÏ≤ò ÏûêÎèô Ìè¨Îß∑ Ï†ÅÏö©
	    $("#modalPhone").val(formatPhoneNumber(data.phone));
	    $("#modalEmail").val(data.email);
	    $("#modalProfileImage").attr("src", data.profileImage || "https://via.placeholder.com/150");
	
	    if (mode === "transfer") {
	      $("#transferFields").show();
	      $("#transferBtn").show();
	      $("#saveBtn").hide();
	    } else {
	      $("#transferFields").hide();
	      $("#transferBtn").hide();
	      $("#saveBtn").show();
	    }
	
	    $("#employeeModal").modal('show');
	  }
	
	      $(document).ready(function () {
	    	  
	    	    // ‚úÖ Î∂ÄÏÑú Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Î™®Îã¨ Ïó¥Í∏∞
	    	    $("#addDeptBtn").click(function () {
	    	        $("#deptParent").val(""); // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
	    	        $("#deptName").val("");
	    	        $("#deptModal").modal("show");
	    	    });
	
	    	    // ‚úÖ Î∂ÄÏÑú Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú API Ìò∏Ï∂ú
	    	    $("#saveDeptBtn").click(function() {
	    	        let selectedParent = $("#deptParent option:selected");
	    	        let deptData = {
	    	            departmentName: $("#deptName").val(),
	    	            parentDepartmentNum: selectedParent.val() || null, // ÏµúÏÉÅÏúÑ Î∂ÄÏÑúÎ©¥ null
	    	            companyNum: companyNum, // ÏÑ∏ÏÖòÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
	    	            departmentType: selectedParent.data("type") || "DT003",  // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
	    	        };
	
	    	        console.log("üìå Î∂ÄÏÑú Ï∂îÍ∞Ä ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞:", deptData);
	
	    	        $.ajax({
	    	            url: "/hr/rest/dept/add",
	    	            type: "POST",
	    	            contentType: "application/json",
	    	            data: JSON.stringify(deptData),
	    	            beforeSend: function(xhr) {
	    	                xhr.setRequestHeader(header, token); // ‚úÖ CSRF ÌÜ†ÌÅ∞ Ï∂îÍ∞Ä
	    	            },
	    	            success: function(response) {
	    	                alert("‚úÖ Î∂ÄÏÑú Ï∂îÍ∞Ä ÏÑ±Í≥µ!");
	    	                $("#deptModal").modal("hide");
	    	                location.reload();
	    	            },
	    	            error: function(xhr, status, error) {
	    	                alert("‚ùå Î∂ÄÏÑú Ï∂îÍ∞Ä Ïã§Ìå®! " + xhr.responseText);
	    	            }
	    	        });
	    	    });
	    	    
			// Î∂ÄÏÑú ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠Ïãú
			
		    // Ï≤¥ÌÅ¨Î∞ïÏä§ ÌÅ¥Î¶≠ Ïãú Î∂ÄÏÑú ÏàòÏ†ï Î≤ÑÌäº ÌôúÏÑ±Ìôî
		    $(document).on("change", ".dept-checkbox", function () {
		        let selectedDept = $(".dept-checkbox:checked");
		
		        if (selectedDept.length === 1) {
		            $("#editDeptBtn").prop("disabled", false); // Î≤ÑÌäº ÌôúÏÑ±Ìôî
		        } else {
		            $("#editDeptBtn").prop("disabled", true); // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
		        }
		    });
			
			
		    // ‚úÖ Î∂ÄÏÑú ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Î™®Îã¨ Ïó¥Í∏∞
		    $(document).on("click", "#editDeptBtn", function () {
		        let selectedDept = $(".dept-checkbox:checked");
	
		        if (selectedDept.length !== 1) {
		            alert("ÏàòÏ†ïÌï† Î∂ÄÏÑúÎ•º ÌïòÎÇòÎßå ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
		            return;
		        }
	
		        let departmentNum = selectedDept.val(); // ÏÑ†ÌÉùÎêú Î∂ÄÏÑú ID Í∞ÄÏ†∏Ïò§Í∏∞
		        console.log("üìå ÏÑ†ÌÉùÎêú Î∂ÄÏÑú ID:", departmentNum); // ÎîîÎ≤ÑÍπÖÏö©
	
		        // ‚úÖ ÏÑ†ÌÉùÎêú Î∂ÄÏÑú Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ (AJAX ÏöîÏ≤≠)
		        $.ajax({
		            url: `/hr/rest/dept/get/${departmentNum}`, // Î∂ÄÏÑú Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî API Ìò∏Ï∂ú
		            type: "GET",
		            contentType: "application/json",
		            beforeSend: function(xhr) {
		                xhr.setRequestHeader(header, token); // CSRF ÌÜ†ÌÅ∞ Ï∂îÍ∞Ä
		            },
		            success: function(response) {
		                console.log("üìå Î∂ÄÏÑú Ï†ïÎ≥¥ ÏùëÎãµ:", response); // ÎîîÎ≤ÑÍπÖÏö©
	
		                // ‚úÖ Î∂ÄÏÑú Ï†ïÎ≥¥ Î™®Îã¨Ïóê Ï±ÑÏö∞Í∏∞
		                $("#editDeptId").val(response.departmentNum);  // Î∂ÄÏÑú ID
		                $("#editDeptName").val(response.departmentName); // Î∂ÄÏÑúÎ™Ö
		                $("#editDeptStatus").val(response.departmentStatus); // Î∂ÄÏÑú ÏÉÅÌÉú
	
		                // ‚úÖ Î™®Îã¨ Ïó¥Í∏∞
		                $("#editDeptModal").modal("show");
		            },
		            error: function(xhr, status, error) {
		                alert("‚ùå Î∂ÄÏÑú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.");
		                console.error("‚ùå Ïò§Î•ò:", xhr.responseText);
		            }
		        });
		    });
			
			
			$("#saveEditDeptBtn").click(function () {
			    let deptId = $("#editDeptId").val();
			    let updatedDeptName = $("#editDeptName").val().trim();
			    let updatedDeptStatus = $("#editDeptStatus").val();
			
			    if (!updatedDeptName) {
			        alert("Î∂ÄÏÑúÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
			        return;
			    }
			
			    // ‚úÖ ÎπÑÌôúÏÑ±ÌôîÌïòÎ†§Î©¥ ÏÜåÏÜçÎêú ÏÇ¨ÏõêÏù¥ ÏóÜÏñ¥Ïïº Ìï®
			    if (updatedDeptStatus === "DU002") {
			        $.ajax({
			            url: `/hr/rest/dept/employees/${deptId}`, // Î∂ÄÏÑú ÎÇ¥ ÏÇ¨Ïõê Ïàò ÌôïÏù∏ API
			            type: "GET",
			            success: function(response) {
			            	
			            	console.log("üìå Î∂ÄÏÑú ÏßÅÏõê Ïàò:", response.employeeCount); // ÎîîÎ≤ÑÍπÖ
			                console.log("üìå ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:", response); // üî• Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
			                
			                if (response.employeeCount > 0) {
			                    alert("Ìï¥Îãπ Î∂ÄÏÑúÏóê ÏÜåÏÜçÎêú ÏÇ¨ÏõêÏù¥ ÏûàÏñ¥ ÎπÑÌôúÏÑ±ÌôîÌï† Ïàò ÏóÜÏäµÎãàÎã§.");
			                } else {
			                    console.log("üìå ÏÇ¨Ïõê ÏóÜÏùå ‚Üí Î∂ÄÏÑú ÎπÑÌôúÏÑ±Ìôî ÏßÑÌñâ"); // üî• ÎîîÎ≤ÑÍπÖÏö© Î°úÍ∑∏
			                    updateDepartment(deptId, updatedDeptName, updatedDeptStatus);
			                }
			            },
			            error: function() {
			                alert("Î∂ÄÏÑú ÏÉÅÌÉú ÌôïÏù∏ Ï§ë Ïò§Î•ò Î∞úÏÉù");
			            }
			        });
			    } else {
			    	updateDepartment(deptId, updatedDeptName, updatedDeptStatus);
			    }
			});
			
			// ‚úÖ Î∂ÄÏÑú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
			function updateDepartment(deptId, updatedDeptName, updatedDeptStatus) {
			    let deptData = {
			        departmentNum: deptId,
			        departmentName: updatedDeptName,
			        departmentStatus: updatedDeptStatus
			    };
			
			    $.ajax({
			        url: "/hr/rest/dept/update",
			        type: "PUT",
			        contentType: "application/json",
			        data: JSON.stringify(deptData),
			        beforeSend: function(xhr) {
			            xhr.setRequestHeader(header, token); // ‚úÖ CSRF ÌÜ†ÌÅ∞ Ï∂îÍ∞Ä
			        },
			        success: function(response) {
			            alert("‚úÖ Î∂ÄÏÑú ÏàòÏ†ï ÏÑ±Í≥µ!");
			            $("#editDeptModal").modal("hide");
			            location.reload();
			        },
			        error: function(xhr, status, error) {
			            alert("‚ùå Î∂ÄÏÑú ÏàòÏ†ï Ïã§Ìå®! " + xhr.responseText);
			        }
			    });
			}
	
	    	  
	
	    	  
	    	  
	          $(".company-sub-list, .sub-list").show();
	
	          // Î∂ÄÏÑú Ìä∏Î¶¨ ÌÜ†Í∏Ä Í∏∞Îä•Îßå Ïú†ÏßÄ
	          $(document).on("click", ".toggle-btn", function (event) {
	              event.stopPropagation();
	              let $targetList = $(this).closest("li").children("ul.sub-list");
	              $targetList.slideToggle(200);
	              $(this).text($(this).text() === "‚ñº" ? "‚ñ∂" : "‚ñº");
	          });
	
	          // Toast Grid Ï¥àÍ∏∞Ìôî (Îç∞Ïù¥ÌÑ∞ ÏóÜÏù¥)
	          const grid = new tui.Grid({
	              el: document.getElementById("grid"),
	              pageOptions: { useClient: false, perPage: 5 },
	              data: dataSource,
	              columns: [
	                  { header: "ÏÇ¨Ïõê ID", name: "employeeId" },
	                  { header: "ÏÇ¨ÏõêÎ™Ö", name: "employeeName" },
	                  { header: "Ïù¥Î©îÏùº", name: "email" },
	                  { header: "ÏßÅÍ∏â", name: "position" },
	                  { header: "Î∂ÄÏÑú", name: "departmentName" }
	              ]
	          });
	
	          
	          // Toast Grid ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ (Î™®Îã¨ Ïó¥Í∏∞)
	          grid.on('click', function(ev) {
	            if (ev.rowKey !== null) {
	              let rowData = grid.getRow(ev.rowKey); // ÏÑ†ÌÉùÌïú ÌñâÏùò Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
	              openEmployeeModal("view", rowData);
	            }
	          });
	
	          
	          
	       // Î∂ÄÏÑú ÏÑ†ÌÉù Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
	          $(document).on('click', '.department-tree [data-company-id], .department-tree [data-dept-id]', function(event) {
	        	    event.stopPropagation(); // Î∂ÄÎ™® ÏöîÏÜåÎ°ú Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Î∞©ÏßÄ
	
	        	   
	        	    let departmentNum = $(this).data('dept-id'); // `data-dept-id` Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
	        	    
	        	    console.log("üìå ÏÑ†ÌÉùÌïú Î∂ÄÏÑú Î≤àÌò∏:", departmentNum);
	
	        	    if (departmentNum == undefined) {	        	        
	        	    	departmentNum=0;
	        	    } 
	        	    grid.readData(1,{departmentNum});
	
	        	    /*fetch(`/hr/rest/emp/organization?perPage=5&companyNum=${companyNum}&departmentNum=${departmentNumSJ}&page=1`, {
	                        method: 'GET',
	                        headers: {
	                            'Content-Type': 'application/json',
	                            "X-CSRF-Token": token
	                        }
	                    })
	                    .then(response => response.json())
	                    .then(data => {
	                        grid.resetData(data.data.contents);  // ÏòµÏÖò ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
	                        grid.setPaginationTotalCount(data.data.pagination.totalCount)
	                        console.log(data);
	                    })
	                    .catch(error => console.error("Îç∞Ïù¥ÌÑ∞ ÏöîÏ≤≠ Ïã§Ìå®:", error));*/
	        	       
	        	        
	        	        
	        	}); 
	      });
	      
	      
	      
	
	
	
	      
	  </script>
	  
		<!-- ‚úÖ Î∂ÄÏÑú Ï∂îÍ∞Ä Î™®Îã¨ -->
		<div class="modal fade" id="deptModal" tabindex="-1" aria-labelledby="deptModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <!-- Î™®Îã¨ Ìó§Îçî -->
		      <div class="modal-header">
		        <h5 class="modal-title" id="deptModalLabel">Î∂ÄÏÑú Ï∂îÍ∞Ä</h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		
		      <!-- Î™®Îã¨ Î∞îÎîî -->
		      <div class="modal-body">
		        <form id="addDeptForm">
		          <!-- ‚úÖ ÏÉÅÏúÑ Î∂ÄÏÑú ÏÑ†ÌÉù -->
		          <div class="mb-3">
		            <label class="fw-bold">ÏÉÅÏúÑ Î∂ÄÏÑú</label>
		            <select class="form-select" id="deptParent">
		              <option value="">(ÏµúÏÉÅÏúÑ Î∂ÄÏÑú)</option>
		              <option th:each="dept : ${departments}" th:value="${dept.departmentNum}" th:text="${dept.departmentName}"></option>
		            </select>
		          </div>
		
		          <!-- ‚úÖ Î∂ÄÏÑúÎ™Ö ÏûÖÎ†• -->
		          <div class="mb-3">
		            <label class="fw-bold">Î∂ÄÏÑúÎ™Ö</label>
		            <input type="text" class="form-control" id="deptName" required>
		          </div>
		        </form>
		      </div>
		
		      <!-- Î™®Îã¨ Ìë∏ÌÑ∞ -->
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
		        <button type="button" class="btn btn-primary" id="saveDeptBtn">Ï†ÄÏû•</button>
		      </div>
		    </div>
		  </div>
		</div>
		
	<!-- ‚úÖ Î∂ÄÏÑú ÏàòÏ†ï Î™®Îã¨ -->
	<div class="modal fade" id="editDeptModal" tabindex="-1" aria-labelledby="editDeptModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <!-- Î™®Îã¨ Ìó§Îçî -->
	      <div class="modal-header">
	        <h5 class="modal-title" id="editDeptModalLabel">Î∂ÄÏÑú ÏàòÏ†ï</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	
	      <!-- Î™®Îã¨ Î∞îÎîî -->
	      <div class="modal-body">
	        <form id="editDeptForm">
	          <input type="hidden" id="editDeptId">  <!-- Î∂ÄÏÑú ID Ï†ÄÏû• -->
	
	          <!-- ‚úÖ Î∂ÄÏÑúÎ™Ö ÏàòÏ†ï -->
	          <div class="mb-3">
	            <label class="fw-bold">Î∂ÄÏÑúÎ™Ö</label>
	            <input type="text" class="form-control" id="editDeptName" required>
	          </div>
	
	          <!-- ‚úÖ ÌôúÏÑ±Ìôî Ïó¨Î∂Ä -->
	          <div class="mb-3">
	            <label class="fw-bold">ÏÉÅÌÉú</label>
	            <select class="form-select" id="editDeptStatus">
	              <option value="DU001">Ïö¥ÏòÅÏ§ë</option>
	              <option value="DU002">ÎπÑÌôúÏÑ±</option>
	            </select>
	          </div>
	        </form>
	      </div>
	
	      <!-- Î™®Îã¨ Ìë∏ÌÑ∞ -->
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
	        <button type="button" class="btn btn-primary" id="saveEditDeptBtn">Ï†ÄÏû•</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	
	  
	  
	</body>
	</html>
