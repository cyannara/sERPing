<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}" lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">

    <!-- TOAST UI Library -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>ì¸ì‚¬ ë°œë ¹ ê´€ë¦¬</title>
</head>

<body layout:fragment="content">
<div class="container mt-3">
    <h2>ì¸ì‚¬ ë°œë ¹ ê´€ë¦¬</h2>

    <!-- ğŸ” ì‚¬ì› ê²€ìƒ‰ -->
    <div class="search-box bg-light p-3 rounded shadow-sm">
        <div class="row align-items-center">
            <div class="col-md-2 text-end"><label class="fw-bold">ì‚¬ì› ê²€ìƒ‰</label></div>
            <div class="col-md-3">
                <select class="form-select" id="employeeSearchCategory">
                    <option value="ì „ì²´">ì „ì²´</option>
                    <option value="employeeName">ì‚¬ì›ëª…</option>
                    <option value="employeeId">ì‚¬ì›ID</option>
                    <option value="phone">ì—°ë½ì²˜</option>
                </select>
            </div>
            <div class="col-md-5">
                <input type="text" class="form-control" id="employeeSearchKeyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ í›„ [Enter]">
            </div>
        </div>
        <div class="row mt-2">
            <div class="col text-center">
                <button class="btn btn-primary" id="searchEmployeeBtn">ì¡°íšŒ</button>
            </div>
        </div>
    </div>

    <!-- ğŸ”² ì‚¬ì› ëª©ë¡ -->
    <div class="row mt-3">
        <div class="col">
            <h5>ì‚¬ì› ëª©ë¡</h5>
            <div id="employeeGrid"></div>
        </div>
    </div>

    <!-- ğŸ”² ì¸ì‚¬ ë°œë ¹ ì´ë ¥ -->
    <div class="row mt-3">
        <div class="col">
            <h5>ì¸ì‚¬ ë°œë ¹ ì´ë ¥</h5>
            <div id="historyGrid"></div>
        </div>
    </div>

    <!-- ğŸ”˜ ì¸ì‚¬ ë°œë ¹ ì¶”ê°€ ë²„íŠ¼ -->
    <div class="row mt-3">
        <div class="col text-end">
            <button class="btn btn-warning" id="openHistoryModalBtn">+ ì¸ì‚¬ ë°œë ¹ ë“±ë¡</button>
        </div>
    </div>
</div>

<!-- ì¸ì‚¬ ë°œë ¹ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ì¸ì‚¬ ë°œë ¹ ë“±ë¡</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="fw-bold">ëŒ€ìƒ ì‚¬ì›</label>
                    <input type="text" class="form-control" id="modalEmployeeName" readonly>
                </div>
                <div class="mb-3">
                    <label class="fw-bold">ë³€ê²½ ìœ í˜•</label>
                    <select class="form-select" id="modalChangeType">
                        <option value="ì§ê¸‰ ë³€ê²½">ì§ê¸‰ ë³€ê²½</option>
                        <option value="ë¶€ì„œ ì´ë™">ë¶€ì„œ ì´ë™</option>
                        <option value="ê·¼ë¬´ í˜•íƒœ ë³€ê²½">ê·¼ë¬´ í˜•íƒœ ë³€ê²½</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="fw-bold">ìƒˆ ì§ê¸‰</label>
                    <select class="form-select" id="modalNewPosition"></select>
                </div>
                <div class="mb-3">
                    <label class="fw-bold">ìƒˆ ë¶€ì„œ</label>
                    <select class="form-select" id="modalNewDepartment"></select>
                </div>
                <div class="mb-3">
                    <label class="fw-bold">ë°œë ¹ ì‚¬ìœ </label>
                    <textarea class="form-control" id="modalReason"></textarea>
                </div>
                <div class="mb-3">
                    <label class="fw-bold">ì ìš©ì¼</label>
                    <input type="date" class="form-control" id="modalEffectiveDate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="saveHistoryBtn">ì €ì¥</button>
            </div>
        </div>
    </div>
</div>


<!-- ğŸ“Œ JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    let employeeGrid, historyGrid;
    let selectedEmployee = null;
    fetchEmployeeList(); 

    // âœ… ì‚¬ì› ëª©ë¡ Grid ì´ˆê¸°í™”
    function initializeEmployeeGrid() {
        employeeGrid = new tui.Grid({
            el: document.getElementById('employeeGrid'),
            columns: [
                { header: "ì‚¬ì›ë²ˆí˜¸", name: "employeeId", width: 100 },
                { header: "ì‚¬ì›ëª…", name: "employeeName", width: 150 },
                { header: "ì§ê¸‰", name: "position", width: 100 },
                { header: "ë¶€ì„œ", name: "department", width: 150 },
            ],
            rowHeaders: ['checkbox']
        });

        fetchEmployeeList();
    }

    // âœ… ì¸ì‚¬ ë°œë ¹ ì´ë ¥ Grid ì´ˆê¸°í™”
    function initializeHistoryGrid() {
        historyGrid = new tui.Grid({
            el: document.getElementById('historyGrid'),
            columns: [
                { header: "ë³€ê²½ ìœ í˜•", name: "changeType", width: 120 },
                { header: "ìƒˆ ì§ê¸‰", name: "newPosition", width: 120 },
                { header: "ìƒˆ ë¶€ì„œ", name: "newDepartment", width: 120 },
                { header: "ì ìš©ì¼", name: "effectiveDate", width: 120 }
            ]
        });
    }

    function fetchEmployeeList() {
        fetch('/hr/rest/emp/list')
        .then(response => response.json())
        .then(data => {
            console.log("ğŸ“¥ ë¶ˆëŸ¬ì˜¨ ì‚¬ì› ë°ì´í„°:", data);
            if (Array.isArray(data.data?.contents)) { 
                employeeGrid.resetData(data.data.contents);
            } else {
                console.error("âŒ ì˜ëª»ëœ ë°ì´í„° í˜•ì‹:", data);
            }
        })
        .catch(error => console.error("âŒ ì‚¬ì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error));
    }

    document.getElementById("searchEmployeeBtn").addEventListener("click", fetchEmployeeList);
    fetchEmployeeList();
    document.getElementById("openHistoryModalBtn").addEventListener("click", function () {
        if (!selectedEmployee) {
            alert("ì‚¬ì›ì„ ì„ íƒí•˜ì„¸ìš”.");
            return;
        }
        new bootstrap.Modal(document.getElementById('historyModal')).show();
    });

    initializeEmployeeGrid();
    initializeHistoryGrid();
});
</script>

</body>
</html>
