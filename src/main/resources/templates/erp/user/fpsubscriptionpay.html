<!DOCTYPE html>
 <!-- =======================================================
 * ê¸°ê°„ êµ¬ë… ì„œë¹„ìŠ¤ë¥¼ ê²°ì œ í•  ìˆ˜ ìˆë‹¤
 * @author ê°œë°œíŒ€ í‘œí•˜ì—°
 * @since 2025.02.17
 * @version 1.0
 * @see
 *
 * <pre>
 * << ê°œì •ì´ë ¥(Modification Information) >>
 *
 *   ìˆ˜ì •ì¼      ìˆ˜ì •ì          ìˆ˜ì •ë‚´ìš©
 *  -------    --------    ---------------------------
 *  2025.02.17  í‘œí•˜ì—°          ìµœì´ˆ ìƒì„±
 *
 *  </pre>
 ======================================================== -->

<html layout:decorate="~{layouts/layout}"
      lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<body layout:fragment="content">
    <div class="container">
        <h3>êµ¬ë… ê²°ì œ</h3>
        <nav class="p-0 m-0 d-flex justify-content-start">
		    <div class="nav nav-tabs" id="nav-tab" role="tablist">
		        <button class="nav-link border active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-fp"
		            type="button" role="tab" aria-controls="#nav-fp" aria-selected="true">ê¸°ê°„êµ¬ë…</button>
		        <button class="nav-link border" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-rg"
		            type="button" role="tab" aria-controls="#nav-rg" aria-selected="false">ì •ê¸°êµ¬ë…</button>
		    </div>
		</nav>


        <div class="tab-content border" id="nav-tabContent" style="background-color: #ffffff;">
            <!-- ê¸°ê°„ êµ¬ë… -->
            <div class="tab-pane fade show active" id="nav-fp" role="tabpanel" aria-labelledby="nav-fp-tab" tabindex="0">
                <h3>ê¸°ê°„ êµ¬ë… ê²°ì œ ì„œë¹„ìŠ¤</h3>
                <div class="d-flex">
					<div style="width: 900px;" class="me-5">
		                <div class="section-title subperiod">â–· sERPing ê¸°ê°„êµ¬ë…</div>
		                <table>
						    <tr>
						        <th>30ì¼</th>
						        <th>90ì¼</th>
						        <th>180ì¼</th>
						        <th>360ì¼</th>
						    </tr>
						    <tr class="subscribe-options">
						        <td>
						            <label for="erp-sub-30">
						                <input type="radio" id="erp-sub-30" data-day="30_60000" name="erp-subscription" value="1">60,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="erp-sub-90">
						                <input type="radio" id="erp-sub-90" data-day="90_174600" name="erp-subscription" value="2">174,600ì›
						            </label>
						        </td>
						        <td>
						            <label for="erp-sub-180">
						                <input type="radio" id="erp-sub-180" data-day="180_338400" name="erp-subscription" value="3">338,400ì›
						            </label>
						        </td>
						        <td>
						            <label for="erp-sub-360">
						                <input type="radio" id="erp-sub-360" data-day="360_648000" name="erp-subscription" value="4">648,000ì›
						            </label>
						        </td>
						    </tr>
						</table>
		
		                <div class="section-title subgroup">â–· ê·¸ë£¹ì›¨ì–´ ì¸ì› ì¶”ê°€ ì„œë¹„ìŠ¤ (ì„œë¹„ìŠ¤ ê¸°ê°„ ë§ì¶¤) [í•„ìˆ˜ ì„ íƒ]</div>
		                <table>
						    <tr>
						        <th>50ëª… ê¸°ê°„ë§ì¶¤</th>
						        <th>100ëª… ê¸°ê°„ë§ì¶¤</th>
						        <th>ë¬´ì œí•œ ê¸°ê°„ë§ì¶¤</th>
						    </tr>
						    <tr class="subscribe-options">
						        <td>
						            <label for="group-sub-50">
						                <input type="radio" id="group-sub-50" data-day="0_0" name="group-subscription" value="5">0ì›
						            </label>
						        </td>
						        <td>
						            <label for="group-sub-100">
						                <input type="radio" id="group-sub-100" data-day="0_0" name="group-subscription" value="6">
						            </label>
						        </td>
						        <td>
						            <label for="group-sub-limit">
						                <input type="radio" id="group-sub-limit" data-day="0_0" name="group-subscription" value="7">
						            </label>
						        </td>
						    </tr>
						</table>
		
		                <div class="section-title addService">â–· ì¶”ê°€ ì„œë¹„ìŠ¤</div>
		                <table>
						    <tr>
						        <th>ì„œë¹„ìŠ¤ëª…</th>
						        <th>30ì¼</th>
						        <th>90ì¼</th>
						        <th>180ì¼</th>
						        <th>360ì¼</th>
						        <th>ê¸°ê°„ë§ì¶¤</th>
						    </tr>
						    <tr>
						        <td>ì¸ì‚¬ê´€ë¦¬</td>
						        <td>
						            <label for="hr-sub-30">
						                <input type="radio" id="hr-sub-30" data-day="30_15000" name="hr-subscription" value="8"> 15,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="hr-sub-90">
						                <input type="radio" id="hr-sub-90" data-day="90_27000" name="hr-subscription" value="9"> 27,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="hr-sub-180">
						                <input type="radio" id="hr-sub-180" data-day="180_54000" name="hr-subscription" value="10"> 54,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="hr-sub-360">
						                <input type="radio" id="hr-sub-360" data-day="360_108000" name="hr-subscription" value="11"> 108,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="hr-sub-custom">
						                <input type="radio" id="hr-sub-custom" data-day="0_0" name="hr-subscription" value="30"> 
						            </label>
						        </td>
						    </tr>
						    <tr>
						        <td>ì§€ì ê´€ë¦¬</td>
						        <td>
						            <label for="branch-sub-30">
						                <input type="radio" id="branch-sub-30" data-day="30_15000" name="branch-subscription" value="12"> 15,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="branch-sub-90">
						                <input type="radio" id="branch-sub-90" data-day="90_27000" name="branch-subscription" value="13"> 27,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="branch-sub-180">
						                <input type="radio" id="branch-sub-180" data-day="180_54000" name="branch-subscription" value="14"> 54,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="branch-sub-360">
						                <input type="radio" id="branch-sub-360" data-day="360_108000" name="branch-subscription" value="15"> 108,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="branch-sub-custom">
						                <input type="radio" id="branch-sub-custom" data-day="0_0" name="branch-subscription" value="31"> 
						            </label>
						        </td>
						    </tr>
						    <tr>
						        <td>íšŒê³„ê´€ë¦¬</td>
						        <td>
						            <label for="account-sub-30">
						                <input type="radio" id="account-sub-30" data-day="30_15000" name="account-subscription" value="16"> 15,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="account-sub-90">
						                <input type="radio" id="account-sub-90" data-day="90_27000" name="account-subscription" value="17"> 27,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="account-sub-180">
						                <input type="radio" id="account-sub-180" data-day="180_54000" name="account-subscription" value="18"> 54,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="account-sub-360">
						                <input type="radio" id="account-sub-360" data-day="360_108000" name="account-subscription" value="19"> 108,000ì›
						            </label>
						        </td>
						        <td>
						            <label for="account-sub-custom">
						                <input type="radio" id="account-sub-custom" data-day="0_0" name="account-subscription" value="32"> 
						            </label>
						        </td>
						    </tr>
						</table>
		            </div>
		            <div class="d-flex align-items-end">
		            	<table class="payment-table">
					        <tr>
					            <th>ê²°ì œë°©ì‹ì„ íƒ</th>
					            <th>
					                <select class="select-box" id="payment-method">
					                    <option value="ì¹´ë“œê²°ì œ">ì¹´ë“œê²°ì œ</option>
					                    <!-- <option value="ê³„ì¢Œì´ì²´">ê³„ì¢Œì´ì²´</option> -->
					                </select>
					            </th>
					        </tr>
					        <tr>
					            <th>ì´ ê²°ì œê¸ˆì•¡</th>
					            <td class="total-price">0ì›</td>
					        </tr>
					        <tr>
					            <td colspan="2"><button class="periodpaygo">ê²°ì œ</button></td>
					        </tr>
					    </table>
		            </div>
				</div>
			</div>
            <!-- ì •ê¸° êµ¬ë… -->
            <div class="tab-pane fade" id="nav-rg" role="tabpanel" aria-labelledby="nav-rg-tab" tabindex="0">
                <h3>ì •ê¸° êµ¬ë… ê²°ì œ ì„œë¹„ìŠ¤</h3>
            </div>
        </div>
    </div>
    <!-- JavaScript -->
    <script th:inline="javascript">
        setTimeout(async () => {
            console.log("ì—¬ê¸°ëŠ” ì‚¬ìš©í•˜ëŠ”ê³³:", window.subscriptionState);
            
            //êµ¬ë…ê¸°ê°„ì— ë§ê²Œ ê°€ê²© ë‹¤ ë³€ê²½ì‹œì¼œ ì£¼ê² ì–´
            remake_date(0);
            
            //ê¸°ê°„ êµ¬ë… ê²°ì œ ì„œë¹„ìŠ¤ ê´€ë ¨
            let tag = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp";
            if(window.subscriptionState.subObj == "date"){
            	tag += `í˜„ì¬ ê¸°ê°„ì œ êµ¬ë…ì¤‘ ì…ë‹ˆë‹¤. [ë‚¨ì€ê¸°ê°„ : ${window.subscriptionState.subObjdate}ì¼]`;
            }else{
            	tag += `í˜„ì¬ ì •ê¸° êµ¬ë…ì¤‘ ì…ë‹ˆë‹¤. [ê²°ì œ ë¶ˆê°€ í•©ë‹ˆë‹¤]`;
            	document.querySelector(".periodpaygo").remove();
            }
            document.querySelector(".subperiod").insertAdjacentHTML("beforeend", tag);
            
            //ê·¸ë£¹ì›¨ì–´ ì¸ì› ì¶”ê°€ ì„œë¹„ìŠ¤
            tag = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp";
            if(window.subscriptionState.groupObj == "date"){
            	let hrpersonnel = await hr_list([[${session.companyNum}]]);
            	tag += `[${window.subscriptionState.gpOption}ëª… ì„œë¹„ìŠ¤ ì‚¬ìš©ì¤‘ / í˜„ì¬ì‚¬ì› ${hrpersonnel}ëª…]`;
            	if(hrpersonnel > 100){
            		document.querySelector("#group-sub-50").remove();
            		document.querySelector("#group-sub-100").remove();
            	}else if(hrpersonnel > 50){
            		document.querySelector("#group-sub-50").remove();
            	}else{
            	}
            }else{
            	tag += `í˜„ì¬ ì •ê¸° êµ¬ë…ì¤‘ ì…ë‹ˆë‹¤. [ê²°ì œ ë¶ˆê°€ í•©ë‹ˆë‹¤]`;
            }
            document.querySelector(".subgroup").insertAdjacentHTML("beforeend", tag);
            //console.log(tag);
            
          //ì¸ì‚¬, ì§€ì , íšŒê³„ ì„œë¹„ìŠ¤ í˜„í™©
          tag = "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp";
          tag += `[ì¸ì‚¬ê´€ë¦¬ : ${window.subscriptionState.hrObjdate}ì¼ / ì§€ì ê´€ë¦¬ : ${window.subscriptionState.pointObjdate}ì¼ / íšŒê³„ê´€ë¦¬ : ${window.subscriptionState.accountObjdate}ì¼] ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
          document.querySelector(".addService").insertAdjacentHTML("beforeend", tag);
            
        }, 500);
        
        async function hr_list(data){
        	const url = "/erp/rest/hrlist/"+data;
        	//console.log(url);
        	return fetch( url, {
        			method:"get",
        			headers: {
        				"Content-Type": "application/json",
        			},
        			//body : JSON.stringify(requestData),
        		})
        	.then( result => result.text() )
        	.then( result => {
        		return result;
        	})
        }
        
     	// êµ¬ë…ê¸°ê°„ì— ë§ê²Œ ê°€ê²©ì„ ë³€ê²½
        function remake_date(redate) {
    let baseDate = window.subscriptionState.subObjdate + redate;
    //console.log("í˜„ì¬êµ¬ë…ê¸°ê°„:", baseDate);

    // ê°€ê²© ë³€ê²½ ëŒ€ìƒ ë° ë°°ìˆ˜ ì„¤ì •
    const elementsToUpdate = [
        { selector: "#group-sub-100", key: "groupObjdate", multiplier: 1000 },
        { selector: "#group-sub-limit", key: "groupObjdate", multiplier: 2000 },
        { selector: "#hr-sub-custom", key: "hrObjdate", multiplier: 500 },
        { selector: "#branch-sub-custom", key: "pointObjdate", multiplier: 500 },
        { selector: "#account-sub-custom", key: "accountObjdate", multiplier: 500 }
    ];

    elementsToUpdate.forEach(({ selector, key, multiplier }) => {
    	let adjustedDate; // ğŸ”¹ ë³€ìˆ˜ ì„ ì–¸ì„ ë£¨í”„ ë°–ì—ì„œ ìˆ˜í–‰

        if (key === "groupObjdate") {
            adjustedDate = baseDate - (window.subscriptionState["subObjdate"] || 0);
        } else {
            adjustedDate = baseDate - (window.subscriptionState[key] || 0);
        }
        let element = document.querySelector(selector);
        
        if (element) {
            let parentLabel = element.parentElement;
            let updatedPrice;

            // íŠ¹ì • ì˜µì…˜ ì ìš© ì‹œ ê°€ê²© ì¡°ì •
            if (window.subscriptionState.gpOption === "100" && selector === "#group-sub-limit") {
                updatedPrice = (redate * multiplier) + (window.subscriptionState.groupObjdate * multiplier / 2);
            } else {
                updatedPrice = adjustedDate * multiplier;
            }

            // ê°€ê²© ì—…ë°ì´íŠ¸
            //parentLabel.innerHTML = parentLabel.innerHTML.replace(/\d{1,3}(,\d{3})*ì›/g, updatedPrice.toLocaleString() + "ì›");
            
            let priceSpan = parentLabel.querySelector(".price-text");
            if (!priceSpan) {
                priceSpan = document.createElement("span");
                priceSpan.classList.add("price-text");
                parentLabel.appendChild(priceSpan);
            }
            priceSpan.textContent = updatedPrice.toLocaleString() + "ì›";
            
            
            //console.log(`ì—…ë°ì´íŠ¸ ì‹œë„: ${selector} data-day=${adjustedDate}_${updatedPrice}`);

            element.setAttribute("data-day", `${adjustedDate}_${updatedPrice}`);
            //console.log("ì ìš© ëŒ€ìƒ:", element); // ì‹¤ì œ ìš”ì†Œ í™•ì¸
            //console.log("ì„¤ì •í•  ê°’:", `${adjustedDate}_${updatedPrice}`);


            //console.log(`ì—…ë°ì´íŠ¸ëœ ê°€ê²© (${selector}):`, updatedPrice);

            // ë§ˆì§€ë§‰ ê°’ì´ " 0ì›"ì´ë©´ display: none ì²˜ë¦¬
            /* if (parentLabel.innerHTML.trim().endsWith("0ì›")) {
                parentLabel.style.display = "none";
            } else {
                parentLabel.style.display = "inline-block";
            } */
        }
    });

    // ë¼ë””ì˜¤ ë²„íŠ¼ í‘œì‹œ ì„¤ì •
    const radioGroups = [
        { key: "hrObjdate", selectors: ["#hr-sub-30", "#hr-sub-90", "#hr-sub-180", "#hr-sub-360"] },
        { key: "pointObjdate", selectors: ["#branch-sub-30", "#branch-sub-90", "#branch-sub-180", "#branch-sub-360"] },
        { key: "accountObjdate", selectors: ["#account-sub-30", "#account-sub-90", "#account-sub-180", "#account-sub-360"] }
    ];

    radioGroups.forEach(({ key, selectors }) => {
        let adjustedDate = baseDate - (window.subscriptionState[key] || 0);

        selectors.forEach(selector => {
            let element = document.querySelector(selector);
            if (element) {
                let label = element.closest("label");
                if (label) {
                    let minDays = parseInt(selector.match(/\d+/)[0]); // ì˜ˆ: "#hr-sub-30" â†’ 30 ì¶”ì¶œ
                    label.style.display = adjustedDate < minDays ? "none" : "inline-block";
                }
            }
        });
    });
}

        
        document.addEventListener("DOMContentLoaded", function () {
            document.addEventListener("change", function (event) {
                let target = event.target;

                if (target.matches('input[name="erp-subscription"], input[name="group-subscription"], input[name="hr-subscription"], input[name="branch-subscription"], input[name="account-subscription"]')) {
                    if (target.matches('input[name="erp-subscription"]')) {
                        const daysMap = { 1: 30, 2: 90, 3: 180, 4: 360 };
                        const selectedDays = daysMap[target.value] || 0;
                        remake_date(selectedDays);
                    }
                    if (target.checked) {
                        let selectedValue = target.value; // ì„ íƒí•œ value ê°’
                        let selectedPrice = target.parentElement.textContent.trim(); // ê°€ê²© í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
                        let selectedDataDay = target.getAttribute("data-day") || "0_0"; // data-day ê°’ ê°€ì ¸ì˜¤ê¸°

                        // âœ… ì„ íƒëœ êµ¬ë… ì˜µì…˜ê³¼ data-day ê°’ ì €ì¥
                        updateSubscriptionSummary(selectedValue, selectedPrice, selectedDataDay);
                    }
                }
            });
        });
        
		/**
		 * ì„ íƒí•œ êµ¬ë… ì˜µì…˜ì„ ëª¨ì•„ì„œ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
		 */
		 function updateSubscriptionSummary(selectedValue, selectedPrice, selectedDataDay) {
		    let selectedValues = [];
		    let selectedDataDays = [];
		    let totalPrice = 0;

		    // ëª¨ë“  ì²´í¬ëœ ë¼ë””ì˜¤ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°
		    const checkedRadios = document.querySelectorAll('input[type="radio"]:checked');

		    checkedRadios.forEach(radio => {
		        let value = radio.value; // ì„ íƒëœ value ê°’
		        let priceText = radio.parentElement.textContent.trim().replace(/[^0-9]/g, ""); // ê°€ê²© ì¶”ì¶œ (ìˆ«ìë§Œ ë‚¨ê¹€)
		        let price = parseInt(priceText, 10) || 0; // ìˆ«ìë¡œ ë³€í™˜
		        let dataDay = radio.getAttribute("data-day") || "0_0"; // data-day ì†ì„± ê°’

		        selectedValues.push(value);
		        selectedDataDays.push(dataDay);
		        totalPrice += price;
		    });

		    // 3ìë¦¬ë§ˆë‹¤ ì½¤ë§ˆ ì¶”ê°€í•˜ì—¬ ì¶œë ¥
		    let formattedTotalPrice = totalPrice.toLocaleString() + "ì›";

		    console.log("ì´ ì„ íƒí•œ êµ¬ë… value:", selectedValues.join("_"));
		    console.log("ì´ ì„ íƒí•œ data-day ê°’:", selectedDataDays.join("-"));
		    console.log("ì´ ê²°ì œ ê¸ˆì•¡:", formattedTotalPrice);

		    document.querySelector(".total-price").innerText = formattedTotalPrice;
		}
		
		//ê²°ì œì²˜ë¦¬
		/* document.querySelector(".periodpaygo").addEventListener("click", function(){
			console.log(document.querySelector("#payment-method").value);
			if(document.querySelector("#payment-method").value == "ì¹´ë“œê²°ì œ"){
				//ê²°ì œëª¨ë“ˆ í™œì„±í™”
				var INIStdPay = new INIStdPay();
			    INIStdPay.pay({
			        mid: "INIpayTest",  // í…ŒìŠ¤íŠ¸ MID
			        oid: "TEST_ORDER_12345", // í…ŒìŠ¤íŠ¸ìš© ì£¼ë¬¸ë²ˆí˜¸
			        price: 1000, // í…ŒìŠ¤íŠ¸ ê²°ì œ ê¸ˆì•¡
			        goodName: "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
			        buyerName: "í™ê¸¸ë™",
			        buyerTel: "01012345678",
			        buyerEmail: "test@example.com",
			        returnUrl: "https://yourdomain.com/payment/success",
			        closeUrl: "https://yourdomain.com/payment/fail"
			    });
			}
		}); */
    </script>
    
<!-- KGì´ë‹ˆì‹œìŠ¤ í‘œì¤€ ê²°ì œ JavaScript SDK -->
<script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>

<script>
document.querySelector(".periodpaygo").addEventListener("click", async function () {
    console.log(document.querySelector("#payment-method").value);

    if (document.querySelector("#payment-method").value == "ì¹´ë“œê²°ì œ") {
        // í˜„ì¬ ì„ íƒëœ êµ¬ë… ì˜µì…˜ ê°€ì ¸ì˜¤ê¸°
        let selectedValues = [];
        let selectedDataDays = [];
        let totalPrice = 0;
        // ëª¨ë“  ì²´í¬ëœ ë¼ë””ì˜¤ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°
        const checkedRadios = document.querySelectorAll('input[type="radio"]:checked');
        checkedRadios.forEach(radio => {
            let value = radio.value; // ì„ íƒëœ value ê°’
            let priceText = radio.parentElement.textContent.trim().replace(/[^0-9]/g, ""); // ê°€ê²© ì¶”ì¶œ (ìˆ«ìë§Œ ë‚¨ê¹€)
            let price = parseInt(priceText, 10) || 0; // ìˆ«ìë¡œ ë³€í™˜
            let dataDay = radio.getAttribute("data-day") || "0_0"; // data-day ì†ì„± ê°’
            selectedValues.push(value);
            selectedDataDays.push(dataDay);
            totalPrice += price;
        });
        // ì£¼ë¬¸ë²ˆí˜¸ ë° ê²°ì œ ê¸ˆì•¡ ì„¤ì •
        let orderId = selectedValues.join("_"); // ì£¼ë¬¸ë²ˆí˜¸ ì„¤ì •
        let dataDay = selectedDataDays.join("-");	//ì˜µì…˜ë³„ ê¸°ê°„_ì£¼ë¬¸ê¸ˆì•¡
        let formattedTotalPrice = totalPrice.toLocaleString(); // ê²°ì œ ê¸ˆì•¡ 3ìë¦¬ë§ˆë‹¤ ì½¤ë§ˆ ì¶”ê°€
        console.log("ğŸš€ ì£¼ë¬¸ë²ˆí˜¸:", orderId);
        console.log("ğŸš€ ì£¼ë¬¸ì˜µì…˜:", dataDay);
        console.log("ğŸ’° ê²°ì œ ê¸ˆì•¡:", formattedTotalPrice);
        
     	// ë°±ì—”ë“œì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
        let response = await fetch("/erp/rest/get-imp-key");
        let data = await response.json();
        if (!data || !data.impKey) {
            console.error("API í‚¤ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            return;
        }
		if(formattedTotalPrice != "0"){
	        // ì´ë‹ˆì‹œìŠ¤ ê²°ì œ ìš”ì²­ ì‹¤í–‰
	        IMP.init(data.impKey); // ê³ ê°ì‚¬ ì‹ë³„ì½”ë“œ ì‚¬ìš©
	        IMP.request_pay({
	            pg: "html5_inicis.INIpayTest", // KGì´ë‹ˆì‹œìŠ¤ í…ŒìŠ¤íŠ¸ìš© PGì‚¬
	            pay_method: "card", // ê²°ì œ ë°©ì‹
	            merchant_uid: orderId, // ì£¼ë¬¸ë²ˆí˜¸ (ì„ íƒí•œ êµ¬ë… ì˜µì…˜ value ì¡°í•©)
	            name: "ê¸°ê°„ êµ¬ë…ì„œë¹„ìŠ¤", // ê²°ì œ ìƒí’ˆëª…
	            amount: 1, // ê²°ì œ ê¸ˆì•¡ (formattedTotalPrice ì‚¬ìš©í•˜ì§€ ì•Šê³  ì •ìˆ˜ë¡œ ì „ë‹¬)
	            buyer_email: "test@example.com",
	            buyer_name: "í™ê¸¸ë™",
	            buyer_tel: "01012345678",
	            buyer_addr: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬",
	            buyer_postcode: "12345"
	        }, function (rsp) {
	            if (rsp.success) {
	                console.log("âœ… ê²°ì œ ì„±ê³µ:", rsp);
	                console.log("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì£¼ë¬¸ë²ˆí˜¸: " + rsp.merchant_uid+" "+orderId+" "+formattedTotalPrice+"ì›",window.subscriptionState);
	                payGO(orderId, formattedTotalPrice, window.subscriptionState, dataDay);
	            } else {
	            	//alert("ê²°ì œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€: " + rsp.error_msg);
	                console.log("âŒ ê²°ì œ ì‹¤íŒ¨:", rsp);
	                console.log("ê²°ì œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€: " + rsp.error_msg+" "+orderId+" "+formattedTotalPrice+"ì›",window.subscriptionState);
	                //ê²°ì œ ì‹¤íŒ¨ì—¬ë„ ê²°ì œë¡œ ë„˜ê¸¸ ì˜ˆì • (í…ŒìŠ¤íŠ¸ë‹ˆê¹Œ)
	                payGO(orderId, formattedTotalPrice, window.subscriptionState, dataDay);
	            }
	        });
		}else{
			alert('êµ¬ë… ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
		}
    }
});
</script>
<script th:inline="javascript">
	function payGO(orderId, price, subscriptionState, dataDay){
		//console.log("í•¨ìˆ˜í˜¸ì¶œ " +orderId+" "+price+"ì›", subscriptionState, [[${session.companyNum}]]);
		let companyNum = [[${session.companyNum}]];
		let employeeNum = [[${session.employeeNum}]];
		console.log(employeeNum);
		const requestData = {
				companyNum: companyNum,		//íšŒì‚¬ë²ˆí˜¸
				orderId: orderId,			//ì£¼ë¬¸ë‚´ì—­(ë¶„í• í•´ì„œ ì¨ì•¼í•¨ 1_24_53_32)
				dataDay: dataDay,			//ì£¼ë¬¸ì˜µì…˜ ë³„ ê¸°ê°„_ê¸ˆì•¡  30_25000-70_15000
				price: price,				//ìµœì¢…ê²°ì œ ê¸ˆì•¡
				paymethod : "EP02",						//ê²°ì œë°©ì‹
				employeeNum : employeeNum,				//ê²°ì œì(ì‚¬ì›ID)
				subscriptionState: subscriptionState,	//í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ ì„œë¹„ìŠ¤ë‚´ì—­ (ê°ì²´)
				subscriptionNum: 0						//ê¸°ë³¸í‚¤ ê²°ê³¼ ë°˜í™˜ í•˜ëŠ” ê³µê°„
		};
		console.log("ë³´ë‚´ëŠ” ê°’", requestData);
		const url = "/erp/rest/periodservicepay";
		fetch ( url, {
			method : "POST",
			headers : {
				"Content-Type": "application/json",
			},
			body : JSON.stringify(requestData),
		})
		.then( result => result.text() )
		.then( result => {
			console.log("ê²°ì œ ê²°ê³¼" + result);
			if(result==="OK"){
				alert("â˜…ì„±ê³µâ˜… í–ˆìŠµë‹ˆë‹¤");
				//ì´ë•Œ í˜ì´ì§€ë¥¼ ì´ë™ ì‹œì¼œë²„ë¦¬ì!!!
			}else{
				alert("ê¸°ê°„ êµ¬ë…ì— ì‹¤íŒ¨ í–ˆìŠµë‹ˆë‹¤");
			}
		})
	}
</script>



    
    
	<style>
        table {
            width: 100%;
            max-width: 900px;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            background-color: #ddd;
            border: 1px solid black;
        }
        .subscribe-options input {
            margin-right: 10px;
        }
        .payment-table {
            width: 100%;
            max-width: 500px;
            border-collapse: collapse;
            margin: 20px auto;
            font-size: 18px;
        }
        .payment-table th, .payment-table td {
            border: 1px solid black;
            padding: 15px;
            text-align: center;
        }
        .payment-table th {
            background-color: #f2f2f2;
        }
        .total-price {
            font-size: 24px;
            font-weight: bold;
        }
        .select-box {
            font-size: 16px;
            padding: 8px;
            width: 100%;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        label {
        	margin-bottom: 0;
        }
    </style>
</body>
