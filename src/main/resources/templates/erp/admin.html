<!DOCTYPE html>
<!-- =======================================================
	* ERPíšŒì‚¬ ê´€ë¦¬ìí˜ì´ì§€ ì‚¬ìš©íšŒì‚¬ ê´€ë¦¬ í˜ì´ì§€
	* @author ERP ê´€ë¦¬ì ê°œë°œíŒ€ í‘œí•˜ì—°
	* @since 2025.02.12
	* @version 1.0
	* @see
	*
	* <pre>
	* << ê°œì •ì´ë ¥(Modification Information) >>
	*
	*   ìˆ˜ì •ì¼      ìˆ˜ì •ì          ìˆ˜ì •ë‚´ìš©
	*  ======    =======    ==============================
	*  2025.02.12  í‘œí•˜ì—°          ìµœì´ˆìƒì„±
	*  2025.02.14  í‘œí•˜ì—°          íšŒì‚¬ë“±ë¡ ë° ê²€ìƒ‰ê¸°ëŠ¥ í™œì„±í™”
	*  2025.02.26  í‘œí•˜ì—°          íšŒì‚¬êµ¬ë…ì •ë³´, êµ¬ë…ë‚´ì—­, ì„¸ê¸ˆê³„ì‚°ì„œ, í˜„ê¸ˆì˜ìˆ˜ì¦, ê±°ë˜ëª…ì„¸ì„œ í™œì„±í™”
	*  2025.02.28  í‘œí•˜ì—°          ë ˆì´ì•„ì›ƒ ìˆ˜ì •
	*
	*  </pre>
======================================================== -->
<html layout:decorate="~{/erp/layouts/main}">
<div class="container w-100 mw-1600" layout:fragment="content">
	<div class="d-flex flex-column mb-1 mt-3">
		<!-- íšŒì‚¬ ê²€ìƒ‰ ì˜ì—­ -->
		<div class="p-2">
			<div class="d-flex justify-content-center border border-primary-subtle rounded-3 bg-primary-subtle p-3">
				<fieldset class="me-3">
					<legend>ê³„ì•½</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="ok_contact" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="ok_contact">ê³„ì•½</label>
						</div>
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="no_contact" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="no_contact">ë¯¸ê³„ì•½</label>
						</div>
					</div>
				</fieldset>
				<fieldset class="me-3">
					<legend>ì„œë¹„ìŠ¤</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="useing" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="useing">ì‚¬ìš©ì¤‘</label>
						</div>
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="unuseing" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="unuseing">ë§Œë£Œ</label>
						</div>
					</div>
				</fieldset>
				<fieldset class="me-3">
					<legend>êµ¬ë…í˜•íƒœ</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="daysubscript" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="daysubscript">ê¸°ê°„êµ¬ë…</label>
						</div>
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="regulsubscript" autocomplete="off" checked="checked">
							<label class="btn btn-outline-primary" for="regulsubscript">ì •ê¸°êµ¬ë…</label>
						</div>
					</div>
				</fieldset>
				<fieldset class="me-3">
					<legend>ë‚¨ì€ê¸°ê°„</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<input type="checkbox" class="btn-check" id="lastday" autocomplete="off">
							<label class="btn btn-outline-primary" for="lastday">10ì¼ ë¯¸ë§Œ</label>
						</div>
					</div>
				</fieldset>
				<fieldset class="me-3">
					<legend>íšŒì‚¬ëª…</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<input type="text" name="companyName2" id="companyName2" class="form-control col-8 input-box">
						</div>
					</div>
				</fieldset>
				<fieldset class="me-3">
					<legend>ì²˜ë¦¬</legend>
					<div class="fieldset-container">
						<div class="form-check mt-2 p-0">
							<button type="button" class="btn btn-success me-2" onclick="search()">ê²€ìƒ‰</button>
				  			<button type="button" class="btn btn-secondary" onclick="reset()">ì´ˆê¸°í™”</button>
						</div>
					</div>
				</fieldset>
				
				<!-- <div>
					<select name="display_amount" id="display_amount" class="col-8 input-box" onchange="changeDisplay()">
						<option value="5" selected>5</option>
						<option value="10">10</option>
						<option value="20">20</option>
						<option value="50">50</option>
						<option value="100">100</option>
					</select>
				</div> -->
			</div>
		</div>
		<!-- íšŒì‚¬ ê²€ìƒ‰ ì˜ì—­ ë -->
		<!-- í† ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ ì˜ì—­ -->
		<div class="p-2">
			<div class="d-flex justify-content-center">
				<div id="grid"></div>
			</div>
		</div>
		<!-- í† ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ ì˜ì—­ ë -->
		<!-- ë°ì´í„° ì²˜ë¦¬ ì˜ì—­ -->
		<div class="pt-2 ps-2 pe-2" style="width: 1560px;">
		    <div class="d-flex justify-content-center border border-primary-subtle rounded-3 p-0" style="height: 420px;">
		        <!-- ì™¼ìª½ ì˜ì—­ -->
		        <div class="d-flex flex-column flex-grow-1 flex-wrap p-1 btn-list" style="max-width: 779px;">
		            <div class="d-flex flex-wrap mb-1 justify-content-between align-items-center" style="margin-left: 7px;margin-top: 10px;">
					    
					    <!-- ì™¼ìª½ ì •ë ¬ ë²„íŠ¼ ê·¸ë£¹ -->
					    <div class="d-flex gap-2">
					        <button type="button" class="btn btn-outline-success btn-sm inputComInser">íšŒì‚¬ë“±ë¡</button>
					        <div class="csbtnlist" style="display: none;">
							    <button type="button" class="btn btn-outline-primary btn-sm cslist">CSë‚´ì—­</button>
							    <button type="button" class="btn btn-outline-success btn-sm reinfo">êµ¬ë…ì •ë³´</button>
							    <button type="button" class="btn btn-outline-success btn-sm relist">êµ¬ë…ë‚´ì—­</button>
							    <!-- <button type="button" class="btn btn-outline-danger btn-sm getout">ì¤‘ë„í•´ì§€</button> -->
							    <button type="button" class="btn btn-outline-warning btn-sm pwreset">ë¹„ë°€ë²ˆí˜¸ì´ˆê¸°í™”</button>
							</div>
					    </div>
					
					    <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ ë²„íŠ¼ -->
					    <div>
					        <button type="button" class="btn btn-danger btn-sm allCance" style="display: none; position: relative; left: -7px;">ë‹«ê¸°</button>
					    </div>
					    
					</div>

		            <!-- í¼ì‹œì‘ -->
		            <div id="formSection" style="display: none; margin-left: 7px; margin-top: 10px;">
			            <form action="#" id="inputComFrom" enctype="multipart/form-data">
						<input type="hidden" id="csrfToken" name="_csrf" th:value="${_csrf != null ? _csrf.token : ''}">
			            <!-- EQ01=ë‹¨ìˆœë¬¸ì˜ / EQ02=ìƒíƒœë³€ê²½ / EQ03=ë°œí–‰ / EQ04=ì‹ ê·œë“±ë¡ -->
			            <input type="hidden" value="EQ04" id="customerServiceDivision" name="customerServiceDivision">
			            <input type="hidden" value="" id="businessFullNumber" name="businessFullNumber">
			            <input type="hidden" value="" id="fullAddress" name="fullAddress">
			            <!-- í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ì›ë²ˆí˜¸ -->
			            <input type="hidden" value="" id="employeeNum" name="employeeNum">
			            <div class="d-flex flex-wrap mb-1">
			            	<div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">íšŒì‚¬ë²ˆí˜¸</span>
									<input type="number" class="form-control" id="companyNum" name="companyNum" readonly="readonly" style="width: 50px;">
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">íšŒì‚¬ëª…</span>
									<input type="text" class="form-control" id="companyName" name="companyName" style="width: 115px">
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">íšŒì‚¬ì˜ë¬¸ëª…</span>
									<input type="text" class="form-control" placeholder="20ì ì´í•˜ ì†Œë¬¸ì" id="companyEngName" name="companyEngName" style="width: 125px">
								</div>
			                </div>
			                <div class="p-0">
								<div class="input-group input-group-sm mb-1">
									<span class="input-group-text">ì‚¬ì—…ìë²ˆí˜¸</span>
									<input type="text" class="form-control" id="businessNum1" name="businessNum1" style="width: 50px">
									<input type="text" class="form-control" id="businessNum2" name="businessNum2" style="width: 40px">
									<input type="text" class="form-control" id="businessNum3" name="businessNum3" style="width: 60px">
								</div>
							</div>
			            </div>
			            <div class="d-flex flex-wrap mb-1">
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">ëŒ€í‘œìëª…</span>
									<input type="text" class="form-control" id="representationName" name="representationName" style="width: 75px">
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">ëŒ€í‘œìì—°ë½ì²˜</span>
									<input type="text" class="form-control" id="representationPhone" name="representationPhone" style="width: 123px">
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">ë‹´ë‹¹ìëª…</span>
									<input type="text" class="form-control" id="chargerName" name="chargerName" style="width: 75px">
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1">
									<span class="input-group-text">ë‹´ë‹¹ìì—°ë½ì²˜</span>
									<input type="text" class="form-control" id="chargerPhone" name="chargerPhone" style="width: 124px">
								</div>
			                </div>
			            </div>
			            <div class="d-flex flex-wrap mb-1">
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1 pe-1">
			                		<input type="file" class="form-control" placeholder="png, jpg ê°€ëŠ¥" accept=".jpg, .jpeg, .png" id="businessLicense" name="businessLicense" style="width: 400px;">
								    <button class="btn btn-outline-secondary" type="button" id="businessLicense_upload">ì—…ë¡œë“œ</button>
									
								</div>
			                </div>
			                <div class="p-0">
				                <div class="input-group input-group-sm mb-1">
								    <span class="input-group-text">email</span>
									<input type="text" class="form-control" id="chargerEmail" name="chargerEmail" style="width: 244px;">
								</div>
			                </div>
			            </div>
			            <div class="d-flex flex-wrap mb-1">
			                <div class="p-0">
								<div class="input-group input-group-sm mb-1 pe-1">
									<span class="input-group-text">ì£¼ì†Œ</span>
									<input type="text" class="form-control" id="companyAddress" readonly="readonly" name="companyAddress" style="width: 340px;">
									<button class="btn btn-outline-secondary" type="button" id="companyAddress_search">ì£¼ì†Œê²€ìƒ‰</button>
								</div>
			                </div>
			                <div class="p-0">
			                	<div class="input-group input-group-sm mb-1">
									<span class="input-group-text">ë‚˜ë¨¸ì§€ì£¼ì†Œ</span>
									<input type="text" class="form-control" id="companyAddressMOD" name="companyAddressMOD" style="width: 210px;">
								</div>
			                </div>
			            </div>
			            <div class="csinfolist" style="display: none;">
			            	<div class="d-flex flex-wrap mb-1">
				                <div class="p-0 me-2">
									<div class="input-group input-group-sm mb-1 pe-1">
										<span class="input-group-text">ì„œë¹„ìŠ¤ìƒíƒœ</span>
										<select class="form-select custom-select" style="width: 120px;">
										  <option value="EC01">ì„œë¹„ìŠ¤</option>
										  <!-- <option value="EC02">ì¼ì‹œì •ì§€</option> -->
										  <option value="EC03">ë§Œë£Œ</option>
										</select>
										<button class="btn btn-outline-secondary serviceChange" type="button">ë³€ê²½</button>
									</div>
				                </div>
				                <div class="p-0 me-2">
				                	<div class="input-group input-group-sm mb-1">
										<input type="text" class="form-control" id="dateChangeInput" name="dateChangeInput" style="width: 72px;">
										<button class="btn btn-outline-secondary dateChange" type="button">ê¸°ê°„ë³€ê²½</button>
									</div>
				                </div>
				                <div class="p-0 me-2">
				                	<div class="input-group input-group-sm mb-1">
										<span class="input-group-text">ë‚¨ì€ê¸°ê°„</span>
										<input type="text" class="form-control" id="dDay" name="dDay" style="width: 100px;" readonly="readonly">
									</div>
				                </div>
				                <div class="p-0">
				                	<div class="input-group input-group-sm mb-1">
										<span class="input-group-text">ë§Œë£Œì¼</span>
										<input type="text" class="form-control" id="subscriptionEndDate" name="subscriptionEndDate" style="width: 100px;" readonly="readonly">
									</div>
				                </div>
				            </div>
				        </div>
			            <div class="d-flex align-items-stretch mb-1">
						    <div class="p-0 flex-grow-1 me-2">
						        <div class="mb-1">
						            <label class="form-label"><b>ë‚´ìš© ë“±ë¡</b> &nbsp;&nbsp;&nbsp;&nbsp;<span class="errMessage" style="font-weight: bold; color: red;"></span></label>
						            <textarea style="width: 683px;" class="form-control" id="customerServiceContent" name="customerServiceContent" rows="4"></textarea>
						        </div>
						    </div>
						    <div class="p-0">
						        <div style="margin-top: 32px;margin-right: 7px;">
						            <button style="height: 110px;" type="button" class="btn btn-outline-success" id="insertAndUpdate"><b>ë“± ë¡</b></button>
						        </div>
						    </div>
						</div>
			            </form>
		            </div>
		            <!-- í¼ì‹œì‘ ë -->
		        </div>
		        <!-- ì™¼ìª½ ì˜ì—­ ë -->
		
		        <!-- ê°€ìš´ë° êµ¬ë¶„ì„  -->
		        <div class="d-flex justify-content-center align-items-center">
		            <div class="vr border-start border-primary-subtle" style="width: 2px; height: 100%;"></div>
		        </div>
		
		        <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
		        <div class="d-flex justify-content-center flex-grow-1 p-1" style="max-width: 779px;">
		            <div class="d-flex flex-column mb-3 overflow-auto appendsection">
					</div>
		        </div>
		    </div>
		</div>
		<!-- ë°ì´í„° ì²˜ë¦¬ ì˜ì—­ ë-->
	</div>
	
	
	<!-- ì‚¬ì—…ì ë“±ë¡ì¦ ëª¨ë‹¬ -->
	<div class="modal fade" id="businessLicenseModal" tabindex="-1" aria-labelledby="businessLicenseModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="businessLicenseModalLabel">ì‚¬ì—…ì ë“±ë¡ì¦</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body d-flex justify-content-center">
				    <img id="businessLicenseImg" src="" class="img-fluid" alt="ì‚¬ì—…ì ë“±ë¡ì¦">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>
	
	<!-- PDF ë§Œë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
	<!-- ê³„ì•½ì„œ ëª¨ë‹¬ -->
	<div class="modal fade" id="contractModal" tabindex="-1" aria-labelledby="contractModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-lg modal-dialog-centered">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="contractModalLabel">ì‚¬ìš©ê³„ì•½ì„œ</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body" id="contractContent">
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- ê²°ì œ ìƒì„¸ë‚´ì—­ ëª¨ë‹¬ -->
	<div class="modal fade" id="subinfolistModal" tabindex="-1" aria-labelledby="subinfolistModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="subinfolistModalLabel">ìƒì„¸ êµ¬ë… ë‚´ì—­</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- ëª¨ë‹¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ì¶”ê°€ë  ì˜ˆì • -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>
	
	<!-- í†µí•© ëª¨ë‹¬ -->
	<div id="universalModal" class="modal fade" tabindex="-1" aria-hidden="true">
	    <div class="modal-dialog modal-xl">
	        <div class="modal-content">
	            <div class="modal-header p-3">
	                <h5 id="modalTitle" class="modal-title"></h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                <div class="pdf-container">
	                    <canvas id="pdfCanvas"></canvas>
	                </div>
	            </div>
	            <div class="modal-footer p-2">
                       <button type="button" class="btn btn-secondary" id="pdfDown">PDF</button>
				    <button type="button" class="btn btn-secondary closemodal"  data-bs-dismiss="modal">ë‹«ê¸°</button>
                   </div>
	        </div>
	    </div>
	</div>
	<!-- í†µí•© ëª¨ë‹¬ ë -->

		
	
	<script th:inline="javascript">
		//í´ë¦­í•œ í–‰ì˜ ì •ë³´ë¥¼ ë‹´ëŠ” ì „ì—­ ë³€ìˆ˜
		var rowData = false;
		var subrowData = false;
		//ëª…ì„¸ì„œ ì²˜ë¦¬ ì •ë³´ë¥¼ ë‹´ëŠ” ì „ì—­ ë³€ìˆ˜
		var variactionNum = 0;
		
		//í˜„ì¬ ê·¸ë¦¬ë“œì— ê°•ì¡°ëœí–‰ì„ ê¸°ë¡í•  ë³€ìˆ˜
		let selectedRowKey = null;
		let subselectedRowKey = null;
		
		//ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´
		let employeeNum = ErpEmployeeInfo.employeeNum;
		document.querySelector("#employeeNum").value = employeeNum;
		
		// í˜ì´ì§€ ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë°”ì¸ë”©
		document.addEventListener("DOMContentLoaded", function() {
			// ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
		    document.body.addEventListener("click", function(event) {
		        if (event.target.classList.contains("contract-btn")) {
		            let value = event.target.getAttribute("data-id");
		            openBusinessLicenseModal(value);
		        }
		    });
		});
		
		// ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
		function openBusinessLicenseModal(value) {
		    console.log("ì‚¬ì—…ì ë“±ë¡ì¦ ëª¨ë‹¬ í˜¸ì¶œë¨, value:", value);
		    // ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì • (ì„œë²„ì˜ ì´ë¯¸ì§€ ê²½ë¡œì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
		    let imageUrl = `http://www.hanalin.net/erp/bsnlicense/${value}`; 
		    // ì´ë¯¸ì§€ ì„¤ì •
		    document.getElementById("businessLicenseImg").src = imageUrl;
		    // ëª¨ë‹¬ í‘œì‹œ
		    let modal = new bootstrap.Modal(document.getElementById("businessLicenseModal"));
		    modal.show();
		}
		
		//ê·¸ë¦¬ë“œ ì„ ì–¸
		var Grid = tui.Grid;
		const dataSource = {
			api : {
				//readData: { url: '/erp/rest/comlist', method: 'GET', initParams: { param : 'param' } },	//ì´ê±°ì¸ë° ê³µí†µí•¨ìˆ˜ë¥¼ ìœ„í•´ ë³€ê²½
				//readData: { url: '/erp/rest/comlist', method: 'GET', initParams: { page: 1 } },
				readData: { url: '/erp/rest/comlist', method: 'GET'},
			//createData: { url: '/api/createData', method: 'POST' },
			//updateData: { url: '/api/updateData', method: 'PUT' },
			//modifyData: { url: 'http://localhost:81/api/board/modifyData', method: 'PUT' },
			//deleteData: { url: '/api/deleteData', method: 'DELETE' },
			},
			contentType : 'application/json',
		};

		//ê·¸ë¦¬ë“œ ìƒì„±
		const grid = new Grid({
			el : document.getElementById('grid'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
			scrollX: false,
		    scrollY: false,
		    minBodyHeight: 201,
		    columnOptions: {
		        resizable: true
		    },
			pageOptions : {
				useClient : false, //í˜ì´ì§€ ë„¤ì´ì…˜ í• êº¼ë©´ false // ìë™ìœ¼ë¡œ í•˜ê²Œí• ê»´ë©´ true
				perPage : 5, //í•œí˜ì´ì§€ì— ëª‡ê°œ ë³´ì—¬ì¤„ì§€
			},
			//ì¹¼ëŸ¼ ì •í•˜ê¸°
			columns: [
				{ header: "íšŒì‚¬ë²ˆí˜¸", name: "companyNum", editor: 'text', align: "center", width: "70" },
				{ header: "íšŒì‚¬ëª…", name: "companyName", editor: 'text', align: "center", width: "200" },
				{ header: "ëŒ€í‘œìëª…", name: "representationName", editor: 'text', align: "center", width: "100" },
				{ header: "ë‹´ë‹¹ìëª…", name: "chargerName", editor: 'text', align: "center", width: "100" },
				{ header: "ë‹´ë‹¹ìì—°ë½ì²˜", name: "chargerPhone", editor: 'text', align: "center", width: "200" },
				{ header: "ì´ë©”ì¼", name: "chargerEmail", editor: 'text', align: "center" },
				{ header: "ì‚¬ì—…ìë“±ë¡ì¦", name: "businessLicense", editor: 'text', width: "100",
					formatter: function({ value }) {
						return `<button class="btn btn-outline-primary btn-sm contract-btn" data-id="${value}">ë“±ë¡ì¦</button>`;
				    },
				    align: "center"
				},
				{ header: "ê³„ì•½ì„œ",  width: "100",
			        name: "contractNum", 
			        formatter: function({ row }) {
			            if (row.contractNum === 0) {
			            	return `ë¯¸ê³„ì•½`;
			            } else {
			                return `<button class="btn btn-outline-primary btn-sm contact-info" data-id="${row.companyNum}">ê³„ì•½ì„œ</button>`;
			            }
			        },
			        editor: 'text', align: "center"
				},
				{ header: "ìƒíƒœ", name: "serviceState",  width: "100",
					formatter: function({ value }) {
			            if (value === 'EC01') {
			            	return `ì„œë¹„ìŠ¤`;
			            } else if (value === 'EC02') {
			            	return `ì¼ì‹œì •ì§€`;
			            } else {
			                return `ì¢…ë£Œ`;
			            }
			        },
			        editor: 'text', align: "center"
				},
				{ header: "ë‚¨ì€ê¸°ê°„", name: "remainingDays", editor: 'text', width: "120",
					//í•´ë‹¹í–‰ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
					formatter: function({ row }) {
						// ë§Œë£Œì¼ ê°€ì ¸ì˜¤ê¸°
			            const endDateStr = row.subscriptionEndDate; 
			          	//ë§ˆì§€ë§‰ ë‚ ì§œ ë§Œë“¤ê¸°
			            const endDate = new Date(endDateStr);	
			         	// ì˜¤ëŠ˜ ë‚ ì§œ ë§Œë“¤ê¸°
			            const today = new Date();	
			         	// ë§Œë£Œì¼ - ì˜¤ëŠ˜ë‚ ì§œ (ë¯¸ë¦¬ì´ˆë¡œ ë°ì´í„° ë°˜í™˜)
			            const timeDiff = endDate.getTime() - today.getTime();
			            // ë¯¸ë¦¬ì´ˆ ë°ì´í„°ë¥¼ ì¼ ë‹¨ìœ„ë¡œ ë³€í™˜
			            const remainingDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

			            if(remainingDays > 10){
			            	return `${remainingDays}ì¼ ë‚¨ìŒ`;
			            }else if(remainingDays >= 0 && remainingDays <= 9){
			            	//ë‚˜ì¤‘ì— ë¶‰ì€ìƒ‰ ìŠ¤íƒ€ì¼ ë„£ì„êº¼ ê°€ë§Œí•˜ê³  ë¶„ë¦¬
			            	//grid.addRowClassName(row.rowKey, 'custom-red-row');
			            	return `${remainingDays}ì¼ ë‚¨ìŒ`;
			            }else{
				            return `ì¢…ë£Œ`;
			            }
			        },
			        align: "center"
			    },
				{ header: "êµ¬ë…í˜•íƒœ", name: "subscriptionForm", editor: 'text', width: "120",
					formatter: function({ value }) {
			            if (value === 'EL01') {
			            	return `ê¸°ê°„êµ¬ë…`;
			            } else if (value === 'EL02') {
			            	return `ì •ê¸°êµ¬ë…`;
			            }
			        },
			        align: "center"
			    },
				{ header: "ë§Œë£Œì¼", name: "subscriptionEndDate", editor: 'text', align: "center", width: "150" },
			],
			//ì´ˆê¸° ë°ì´í„° ë­˜ë¡œ í• ì§€
			data : dataSource,
		});
		
		grid.on('click', function (ev) {
			//í–‰ ì „ì²´ ì„ íƒí•˜ëŠ”ë²•
			/* var record = {
			  start: [ev.rowKey, 0],
			  end: [ev.rowKey, grid.getColumns().length]
			}
			grid.setSelectionRange(record); */
		
			if (ev.rowKey !== null) {

				//í˜„ì¬ ê°•ì¡°ëœ í–‰ í´ë˜ìŠ¤ ì´ˆê¸°í™”
				if (selectedRowKey !== null) {
		            grid.removeRowClassName(selectedRowKey, 'tui-grid-row-highlight');
		        }
		     	// í´ë¦­í•œ í–‰ì— ê°•ì¡° íš¨ê³¼ ì¶”ê°€
				grid.addRowClassName(ev.rowKey, 'tui-grid-row-highlight');
				 // í˜„ì¬ ê°•ì¡°ëœ í–‰ì„ ê¸°ë¡
		        selectedRowKey = ev.rowKey;
				
				rowData = grid.getRow(ev.rowKey);
				console.log(`í´ë¦­í•œ í–‰ ë°ì´í„°:\n${JSON.stringify(rowData, null, 2)}`);
				if(!rowData){
					return;
				}
				
				//í¼ ì´ˆê¸°í™”
				document.querySelector("#inputComFrom").reset();
				//ì—ëŸ¬ ë©”ì„¸ì§€ ì´ˆê¸°í™”
				document.querySelector(".errMessage").innerHTML = '';
				// íšŒì‚¬ë“±ë¡ë²„íŠ¼ ë¹„í™œì„±í™”
				inputComInserbtn.style.display="none";
				// ë“±ë¡ì–‘ì‹ í™œì„±í™”
				document.querySelector("#formSection").style.display="block";
				// íšŒì‚¬ì¼ë°˜ CS ì²˜ë¦¬ ê¸°ì¤€ì •ë³´ë¡œ ë³€ê²½
				document.querySelector("#customerServiceDivision").value = "EQ01";
				// íšŒì‚¬ cs ì²˜ë¦¬ ê´€ë ¨ ë²„íŠ¼ í™œì„±í™”
				document.querySelector(".csbtnlist").style.display="block";
				// ë‹«ê¸°ë²„íŠ¼ í™œì„±í™”
				allCanceinbtn.style.display="block";
				//insertAndUpdate
				document.querySelector("#insertAndUpdate").innerTEXT = "ì²˜ë¦¬ë°˜ì˜";
				// íšŒì‚¬ ì„œë¹„ìŠ¤ ê´€ë ¨ ì¸í’‹ ë°•ìŠ¤ í™œì„±í™”
				document.querySelector(".csinfolist").style.display="block";
				//ì„œë¹„ìŠ¤ ìƒíƒœ ì…€ë ‰íŠ¸ ë°•ìŠ¤ í™•ì¸
				document.querySelector(".custom-select").value = rowData.serviceState;
				//csë‚´ì—­ ë„ìš°ê¸°
				cslistfun();
				
				
				//ê°í–‰ì— ê°’ ë„£ê¸°
				document.querySelector("#companyNum").value = rowData.companyNum;	//íšŒì‚¬ë²ˆí˜¸
				document.querySelector("#companyName").value = rowData.companyName;	//íšŒì‚¬ì´ë¦„
				document.querySelector("#companyEngName").value = rowData.companyEngName;	//íšŒì‚¬ì˜ë¬¸ëª…
				document.querySelector("#companyEngName").readOnly = true;
				document.querySelector("#businessFullNumber").value = rowData.businessNum;	//íšŒì‚¬ ì‚¬ì—…ìë²ˆí˜¸
				let parts = rowData.businessNum.split("-");
				document.querySelector("#businessNum1").value = parts[0];
				document.querySelector("#businessNum2").value = parts[1];
				document.querySelector("#businessNum3").value = parts[2];
				document.querySelector("#representationName").value = rowData.representationName;	//ëŒ€í‘œìëª…
				document.querySelector("#chargerName").value = rowData.chargerName;	//ë‹´ë‹¹ìëª…
				document.querySelector("#representationPhone").value = rowData.representationPhone;	//ëŒ€í‘œìì—°ë½ì²˜
				document.querySelector("#chargerPhone").value = rowData.chargerPhone;	//ë‹´ë‹¹ìì—°ë½ì²˜
				document.querySelector("#chargerEmail").value = rowData.chargerEmail;	//ë©”ì¼
				//document.querySelector("#businessLicense").value = rowData.businessLicense;	//íŒŒì¼ëª…ì€ ìˆ˜ì •ë¶ˆê°€ ì‹ ê·œë“±ë¡ë§Œ ë¨
				document.querySelector("#fullAddress").value = rowData.companyAddress;	//íšŒì‚¬ì£¼ì†Œ (íˆë“ )
				document.querySelector("#companyAddress").value = rowData.companyAddress;	//íšŒì‚¬ì£¼ì†Œ (ì¸í’‹)
				
				
				document.querySelector("#subscriptionEndDate").value = rowData.subscriptionEndDate;	//ë§Œë£Œì¼
				//ë‚¨ì€ê¸°ê°„ êµ¬í•˜ê¸°
	            const endDateStr = rowData.subscriptionEndDate; 
	            const endDate = new Date(endDateStr);	
	            const today = new Date();
	            const timeDiff = endDate.getTime() - today.getTime();
	            const remainingDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
				document.querySelector("#dDay").value = remainingDays+"ì¼";	//ë‚¨ì€ê¸°ê°„
				
				//CS ë‚´ìš©
				//document.querySelector("#customerServiceContent").value = rowData.customerServiceContent;
			 }
		});
		
		
		//ê·¸ë¦¬ë“œ í‘œì‹œ ìˆ˜ëŸ‰ ë³€ê²½
		function changeDisplay() {
			let gap = parseInt(document.querySelector('#display_amount').value);
			grid.setPerPage(gap, dataSource)
		}
		//ì—”í„°ì´ë²¤íŠ¸
		document.getElementById("companyName2").addEventListener("keypress", function(event) {
		    if (event.key === "Enter") {
		        search();
		    }
		});
		//ê²€ìƒ‰ ì²˜ë¦¬ ì´ë²¤íŠ¸
		function search(){
			let companyName = document.querySelector('#companyName2').value;
			let ok_contact = document.querySelector('#ok_contact').checked;
			let no_contact = document.querySelector('#no_contact').checked;
			let useing = document.querySelector('#useing').checked;
			let unuseing = document.querySelector('#unuseing').checked;
			let daysubscript = document.querySelector('#daysubscript').checked;
			let regulsubscript = document.querySelector('#regulsubscript').checked;
			let lastday = document.querySelector('#lastday').checked;
			if(lastday){
				document.querySelector('#regulsubscript').checked = false;
			}
			
			grid.setRequestParams({"companyName" : companyName, "okContact" : ok_contact, "noContact" : no_contact, "useing" : useing, "unuseing" : unuseing
				, "daysubscript" : daysubscript, "regulsubscript" : regulsubscript, "lastday" : lastday});
			grid.readData();
		}
		//ê²€ìƒ‰ ì´ˆê¸°í™” ì´ë²¤íŠ¸
		function reset(){
			let companyName = document.querySelector('#companyName2');
			companyName.value = '';
			document.querySelector('#ok_contact').checked = true;
			document.querySelector('#no_contact').checked = true;
			document.querySelector('#useing').checked = true;
			document.querySelector('#unuseing').checked = true;
			document.querySelector('#daysubscript').checked = true;
			document.querySelector('#regulsubscript').checked = true;
			document.querySelector('#lastday').checked = false;

			
			
			grid.setRequestParams({"companyName" : companyName.value })
			grid.readData();
		}
		
		//ê³„ì•½ì„œ ë²„íŠ¼ í´ë¦­
		document.getElementById('grid').addEventListener('click', function(event) {
			if (event.target.classList.contains('contact-info')) {
				let companyNum = event.target.getAttribute("data-id"); // íšŒì‚¬ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
				console.log("companyNum"+companyNum);
		        fetchContract(companyNum);
			}
		});
		
		// ê³„ì•½ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
		function fetchContract(companyNum) {
		    fetch(`/erp/rest/contactread/`+companyNum, {
		        method: 'GET',
		        headers: {
		            "Content-Type": "application/json"
		        }
		    })
		    .then(response => response.json())
		    .then(data => {
		        if (data) {
		            displayContract(data);
		            let modal = new bootstrap.Modal(document.getElementById("contractModal"));
		            modal.show();
		        } else {
		            alert("ê³„ì•½ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
		        }
		    })
		    .catch(error => console.error("ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", error));
		}

		// ê³„ì•½ì„œ ë‚´ìš©ì„ ëª¨ë‹¬ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
		function displayContract(data) {
		    let content = `
		        <div class="container">
		            <h2 class="text-center fw-bold pt-0">ì‚¬ìš©ê³„ì•½ì„œ</h2>
		            <div class="pt-0 ps-4 pe-4 pm-0">
		                <p style="margin-bottom:8px;"><strong>beautyInside</strong> (ì´í•˜ "ì œê³µì")ì™€ <strong>${data.contract1}</strong> (ì´í•˜ "ì‚¬ìš©ì")ê°„ì— sERPing ì‚¬ìš© ê³„ì•½ì„ ì²´ê²°í•œë‹¤.</p>
		                <h5 class="fw-bold mt-2">ì œ 1ì¡° &lt;ëª©ì &gt;</h5>
		                <p style="margin-bottom:8px;">ë³¸ ê³„ì•½ì˜ ëª©ì ì€ "ì œê³µì"ì˜ sERPing í”„ë¡œê·¸ë¨(ì´í•˜ "í”„ë¡œê·¸ë¨")ì„ "ì‚¬ìš©ì"ì—ê²Œ ì œê³µí•¨ì— ìˆì–´ "ì œê³µì", "ì‚¬ìš©ì" ì–‘ìê°„ì˜ ì œë°˜ ì•½ì • ë‚´ìš©ì„ ê·œì •í•¨ì— ìˆë‹¤.</p>
		                
		                <h5 class="fw-bold mt-2">ì œ 2ì¡° &lt;"í”„ë¡œê·¸ë¨" ì‚¬ìš©ë²”ìœ„&gt;</h5>
		                <p style="margin-bottom:8px;">ê°€. "ì‚¬ìš©ì"ëŠ” "ì œê³µì"ì˜ "í”„ë¡œê·¸ë¨"ì„ <strong>${data.contract2}</strong> ë™ì•ˆ ì‚¬ìš©í•˜ê³ , <strong>${data.contract3}ì›</strong>ì„ ì§€ë¶ˆí•œë‹¤.</p>
		                <p style="margin-bottom:8px;">ë‚˜. "ì‚¬ìš©ì"ëŠ” "í”„ë¡œê·¸ë¨"ì„ <strong>${data.contract4}</strong> ê¸°ëŠ¥ì„ í•„ìš”ì— ë§ê²Œ ì‚¬ìš©í•œë‹¤.</p>
		                <p style="margin-bottom:8px;">ë‹¤. ì¶”ê°€ ê¸°ëŠ¥ì€ <strong>${data.contract5}</strong> í•­ëª©ì— ë”°ë¼ <strong>${data.contract6}ì›</strong>ì„ <strong>${data.contract7}</strong>í•˜ì—¬ ì‚¬ìš©í•œë‹¤.</p>

		                <h5 class="fw-bold mt-2">ì œ 3ì¡° &lt;"í”„ë¡œê·¸ë¨" ì‚¬ìš©ê¸°ê°„&gt;</h5>
		                <p style="margin-bottom:8px;">ê°€. ì‚¬ìš©ê¸°ê°„ì€ "ì œê³µì"ì— ì˜í•´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë©°, ë³€ê²½ ì „ "ì‚¬ìš©ì"ì—ê²Œ ê³ ì§€í•œë‹¤.</p>
		                <p style="margin-bottom:8px;">ë‚˜. ìµœì´ˆ ì‚¬ìš© ì‹œ ê³„ì•½ì„œë¥¼ ì‘ì„±í•˜ë©°, <strong>${data.contract8}</strong> ë° <strong>${data.contract9}</strong> ì‹œì—ëŠ” ë³„ë„ ê³„ì•½ì„œë¥¼ ì‘ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>

		                <h5 class="fw-bold mt-2">ì œ 4ì¡° &lt;ì¡°ê±´&gt;</h5>
		                <p style="margin-bottom:8px;">ê°€. "ì‚¬ìš©ì"ëŠ” ê³„ì•½ ì¢…ë£Œ ì‹œ <strong>${data.contract10}</strong>í•  ìˆ˜ ìˆë‹¤.</p>
		                <p style="margin-bottom:8px;">ë‚˜. "ì œê³µì"ëŠ” "ì‚¬ìš©ì"ì˜ <strong>${data.contract11}</strong> ë° <strong>${data.contract12}</strong>ë¡œ ì¸í•´ ê³„ì•½ì„ ì¢…ë£Œí•  ìˆ˜ ìˆë‹¤.</p>
		                <p style="margin-bottom:8px;">ë‹¤. ê³„ì•½ ì¢…ë£Œ ì‹œ ë‚¨ì€ ì„œë¹„ìŠ¤ê¸°ê°„ê³¼ í• ì¸ìœ¨ì„ ê³ ë ¤í•˜ì—¬ <strong>${data.contract13}</strong> ê°€ëŠ¥í•˜ë‹¤.</p>

		                <h5 class="fw-bold mt-2">ì œ 5ì¡° &lt;ê·€ì†&gt;</h5>
		                <p style="margin-bottom:8px;">ê°€. "í”„ë¡œê·¸ë¨"ì˜ ì €ì‘ê¶Œì€ "ì œê³µì"ì—ê²Œ ìˆìœ¼ë©°, "ì‚¬ìš©ì"ëŠ” ë‚´ë¶€ ê¸°ëŠ¥ <strong>${data.contract17}</strong>ì„ í™œìš©í•˜ì—¬ ìƒì„±í•œ <strong>${data.contract18}</strong>ì— ëŒ€í•œ ì €ì‘ê¶Œì„ ê°€ì§„ë‹¤.</p>

		                <div class="text-end contract-date">
			                <div class="d-flex justify-content-between">
				                <div class="text-center">
				                    <img style="width=100px;" src="http://www.hanalin.net/erp/signup/${data.erpContractDocument}" class="img-fluid" alt="ì „ì ì„œëª…">
				                </div>
				                <div>
				                    <strong>ê³„ì•½ ì²´ê²° í›„</strong> <strong>${data.contract21}</strong> ì¦‰ì‹œ íš¨ë ¥ ë°œìƒí•œë‹¤.
				                    <br>
				                    <strong>${data.contract22}</strong>ë…„ <strong>${data.contract23}</strong>ì›” <strong>${data.contract24}</strong>ì¼
			                    </div>
			                </div>
		                </div>
		            </div>
		        </div>
		    `;
		    document.getElementById("contractContent").innerHTML = content;
		}
	
		// ì£¼ì†Œê²€ìƒ‰ api
		document.addEventListener("DOMContentLoaded", function() {
		    // ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		    document.querySelectorAll("#companyAddress_search, #companyAddress").forEach(el => {
		        el.addEventListener("click", function() {
		            new daum.Postcode({
		                oncomplete: function(data) {
		                    // ê²€ìƒ‰ëœ ì£¼ì†Œ ë°ì´í„° ì²˜ë¦¬
		                    var fullAddress = data.address; // ê¸°ë³¸ ì£¼ì†Œ
		                    var extraAddress = ''; // ì°¸ê³ í•­ëª© (ì˜ˆ: ê±´ë¬¼ëª…)
		
		                    if (data.addressType === 'R') { // ë„ë¡œëª… ì£¼ì†Œì¸ ê²½ìš°
		                        if (data.bname !== '') {
		                            extraAddress += data.bname;
		                        }
		                        if (data.buildingName !== '') {
		                            extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
		                        }
		                        fullAddress += (extraAddress !== '' ? ' (' + extraAddress + ')' : '');
		                    }
		
		                    // ì£¼ì†Œ ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
		                    document.getElementById("companyAddress").value = fullAddress;
		                }
		            }).open();
		        });
		    });
		});
		// ì£¼ì†Œê²€ìƒ‰ api ë
		
		//ì§€ê¸ˆì‘ì—…ì¤‘
		//êµ¬ë…ë‚´ì—­ ê·¸ë¦¬ë“œ í™”ë©´ ë³´ì—¬ì£¼ê¸°
		document.querySelector(".relist").addEventListener("click", function(){
			sublist();//ê·¸ë¦¬ë“œ í˜¸ì¶œ í•­ëª© ìƒì„±
		});
		function sublist(){
			//í™”ë©´ ì´ˆê¸°í™”
			//document.querySelector(".appendsection").innerHTML = '<h5>êµ¬ë…ë‚´ì—­<h5>';
			document.querySelector(".appendsection").innerHTML = `
				<div class="appendsection2">
			    <div class="card p-3 shadow-sm" style="width: 100%; max-width: 700px; border-radius: 12px;">
			        <h5 class="mb-3 text-center fw-bold">ğŸ“‹ êµ¬ë… ë‚´ì—­</h5>
			        <div id="subscriptionContainer" class="d-flex flex-column gap-3 appdiv"></div>
			    </div>
			`;
			
			const sublistdataSource = {
					api : {
						readData: { url: '/erp/rest/subscriptionlist', method: 'GET', initParams: { companyNum: rowData.companyNum }},
					},
					contentType : 'application/json',
					headers: { 'x-custom-header': 'custom-header' },
				};
			
			
			// ìƒˆë¡œìš´ div ìƒì„±
		    const sublistContainer = document.createElement("div");
		    sublistContainer.id = "sublist";
		    sublistContainer.style.width = "665px"; // ê°€ë¡œ í¬ê¸° ì¡°ì • ê°€ëŠ¥
		    //document.querySelector(".appendsection").appendChild(sublistContainer);
		    document.querySelector(".appdiv").appendChild(sublistContainer);
			
		 	// ê¸°ì¡´ `sublistgrid` ê°ì²´ê°€ ìˆë‹¤ë©´ ì‚­ì œ
		    if (window.sublistgrid) {
		        window.sublistgrid.destroy();
		    }

		    // ìƒˆë¡œìš´ `sublistgrid` ìƒì„±
		    window.sublistgrid = new tui.Grid({
		        el: document.getElementById('sublist'),
		        scrollX: false,
			    scrollY: false,
			    minBodyHeight: 201,
			    columnOptions: {
			        resizable: true
			    },
		        pageOptions: {
		            useClient: false,
		            perPage: 5
		        },
		        columns: [
		            { header: "ë²ˆí˜¸", name: "subscriptionNum", editor: 'text', align: "center", width: "50" },
		            { header: "êµ¬ë…ìˆ˜ë‹¨", name: "subscriptionMeanName", editor: 'text', align: "center", width: "70" },
		            { header: "êµ¬ë…í˜•íƒœ", name: "subscriptionFormName", editor: 'text', align: "center", width: "70" },
		            { header: "êµ¬ë…ê¸ˆì•¡", name: "subscriptionAmount", editor: 'text', formatter: ({ value }) => value.toLocaleString() + 'ì›', align: "right", width: "100" },
		            { header: "êµ¬ë…ì¼ì‹œ", name: "subscriptionDate", editor: 'text',
						formatter: function({ value }) {
							return subscriptday(value);
					    },
					},
					{ header: "ê±°ë˜ëª…ì„¸ì„œ", name: "transactionstatement", editor: 'text', align: "center", width: "80",
						formatter: function({ row }) {
					        return `<button class="btn btn-outline-primary btn-sm sub-bill" data-id="${row.subscriptionNum}">ëª…ì„¸ì„œ</button>`;
					    },
					},
					{ header: "ì„¸ê¸ˆê³„ì‚°ì„œ", name: "taxinvoice", editor: 'text', align: "center", width: "80",
						formatter: function({ row }) {
							if(row.billForm=="EB01"){
								return `ë°œí–‰ë¶ˆê°€`;
							}else{
								if(row.billNum){
									return `<button class="btn btn-outline-primary btn-sm sub-tax" data-id="${row.subscriptionNum}_1">ë³´ê¸°</button>`;
								}else{
						        	return `<button class="btn btn-outline-primary btn-sm sub-tax" data-id="${row.subscriptionNum}_2">ë°œí–‰</button>`;							
								}							
							}
					    },
					},
					{ header: "í˜„ê¸ˆì˜ìˆ˜ì¦", name: "cashreceipt", editor: 'text', align: "center", width: "80",
						formatter: function({ row }) {
							if(row.subscriptionMeanName=="ë¬´í†µì¥" || row.subscriptionMeanName=="ê³„ì¢Œì´ì²´"){
								if(row.billForm=="EB02"){
									return `ë°œí–‰ë¶ˆê°€`;
								}else{
									if(row.billNum){
										return `<button class="btn btn-outline-primary btn-sm sub-cash" data-id="${row.subscriptionNum}_1">ë³´ê¸°</button>`;
									}else{
							        	return `<button class="btn btn-outline-primary btn-sm sub-cash" data-id="${row.subscriptionNum}_2">ë°œí–‰</button>`;							
									}								
								}
							}else{
								return `ë°œí–‰ë¶ˆê°€`;
							}
					    },
					},
		        ],
		        data: sublistdataSource
		    });
		    
		  	//ë‚ ì§œ ë³€í™˜í•¨ìˆ˜
			function subscriptday(value){
				const utcDate = new Date(value);
				// í•œêµ­ ì‹œê°„(KST)ìœ¼ë¡œ ë³€í™˜ (24ì‹œê°„ í˜•ì‹ ìœ ì§€)
				const options = { 
				    year: 'numeric', month: '2-digit', day: '2-digit',
				    hour: '2-digit', minute: '2-digit', second: '2-digit',
				    hour12: false, timeZone: "Asia/Seoul"
				};
				// `toLocaleString` ì‚¬ìš©í•˜ì—¬ ë³€í™˜ í›„, í¬ë§·ì„ `yyyy-MM-dd HH:mm:ss`ë¡œ ì¡°ì •
				const kstDate = new Intl.DateTimeFormat("ko-KR", options).format(utcDate)
				    .replace(/\./g, '-') // yyyy.MM.dd â†’ yyyy-MM-dd ë¡œ ë³€í™˜
				    .replace(/ /g, '')    // ê³µë°± ì œê±°
				    .trim();
				return kstDate;
			}
		  	
			//ëª…ì„¸ì„œë²„íŠ¼ í´ë¦­
			document.getElementById('sublist').addEventListener('click', function(event) {
				//ê±°ë˜ëª…ì„¸ì„œ
			    if (event.target.classList.contains('sub-bill')) {
			       	//ê±°ë˜ëª…ì„¸ì„œ ë°œí–‰
			        const subscriptionNum = event.target.getAttribute('data-id');
			        variactionNum = subscriptionNum;
			        const modalTitle = document.getElementById('modalTitle');
			        const modal = new bootstrap.Modal(document.getElementById('universalModal'));
			     	// (1) PDF ìƒì„± ì—”ë“œí¬ì¸íŠ¸ (Jasper â†’ PDF)
			       	const url = `/erp/report/report?companynum=${rowData.companyNum}&subscriptionnum=${subscriptionNum}`;
			       	let modalType = "ê±°ë˜ëª…ì„¸ì„œ";
			       	modalTitle.innerText = modalType;
			        //window.open(url, '_blank');
			       	// (2) PDF.jsë¡œ ìº”ë²„ìŠ¤ ë Œë”ë§
		            renderPDF(url, 1, rowData.companyNum);
		         	// (3) ëª¨ë‹¬ í‘œì‹œ
		         	modal.show();
			    //ì„¸ê¸ˆê³„ì‚°ì„œ    
			    }else if(event.target.classList.contains('sub-tax')){
			    	//ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰
			    	const subscriptionNum = event.target.getAttribute('data-id');
			    	const modalTitle = document.getElementById('modalTitle');
			        const modal1 = new bootstrap.Modal(document.getElementById('universalModal'));
			    	let tax = subscriptionNum.split("_");
			    	
			    	// (1) PDF ìƒì„± ì—”ë“œí¬ì¸íŠ¸ (Jasper â†’ PDF)
			       	const url = `/erp/report/taxinvoice?companynum=${rowData.companyNum}&subscriptionnum=${tax[0]}`;
			       	let modalType = "ì„¸ê¸ˆê³„ì‚°ì„œ";
			       	modalTitle.innerText = modalType;
			       	// (2) PDF.jsë¡œ ìº”ë²„ìŠ¤ ë Œë”ë§
		            renderPDF(url, 2, rowData.companyNum);
			    	//ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰
			    	variactionNum = tax[0];
			    	if(tax[1] == 2){
			    		//ê·¸ëƒ¥ DBì— ë°ì´í„°ë§Œ ì €ì¥í•˜ëŠ”ê±°ì„
			    		//api ì—†ì–´ì„œ ê·¸ëƒ¥ ì œìŠ¤í¼ ë¬¸ì„œ í•˜ëŠ”ê±¸ ë³´ì—¬ì£¼ëŠ”ê²ƒë¿ì„
			    		const requestData = {
			    				subscriptionNum: tax[0],
			    				employeeNum: rowData.companyNum,
			    				billForm: "EB02",
			    				pdfAddress: "ì¤€ë¹„ì¤‘",
			    				issueCompany: "EI02",
			    				companyCode: "NODATA",
			    				companyNum: rowData.companyNum,
						};
			    		console.log("aaaaaaaa",requestData);
			    		const url = `/erp/rest/taxbillpublishing`;
			    		//íŒ¨ì¹˜ ì‹œì‘
						fetch(url, {
							method:"post",
							headers: {
							      "Content-Type": "application/json",
							      //'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
							    },
							body : JSON.stringify(requestData),
						})
						.then( result => result.text() )
						.then( result => {
							if(result==="OK"){
								modal1.show();
								sublistgrid.reloadData();
							    setTimeout(() => {
							        let allRows = sublistgrid.getData();
							        let targetRowKey = allRows.findIndex(row => row.subscriptionNum == tax[0]); 
							        
							        if (targetRowKey !== -1) {
							            sublistgrid.addRowClassName(targetRowKey, 'tui-grid-row-highlight');
							            sublistgrid.focus(targetRowKey, 'subscriptionNum');  // ì´ˆì  ì´ë™
							        }
							    }, 500);
							}else{
								alert('ê³„ì‚°ì„œ ì €ì¥ì— ì‹¤íŒ¨ í–ˆìŠµë‹ˆë‹¤');
							}
						})
					//ê¸°ì¡´ì— ìˆëŠ”ê±° ë³´ì—¬ì¤Œ	
			    	}else if(tax[1] == 1){
			    		//ì•„ë¬´ í–‰ìœ„ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ
			    	}
			    	modal1.show();
			    //í˜„ê¸ˆ ì˜ìˆ˜ì¦	
			    }else if(event.target.classList.contains('sub-cash')){
			    	//í˜„ê¸ˆì˜ìˆ˜ì¦ ë°œí–‰
			    	const subscriptionNum = event.target.getAttribute('data-id');
			    	const modalTitle = document.getElementById('modalTitle');
			    	const modal2 = new bootstrap.Modal(document.getElementById('universalModal'));
			    	let cash = subscriptionNum.split("_");
			    	
			    	// (1) PDF ìƒì„± ì—”ë“œí¬ì¸íŠ¸ (Jasper â†’ PDF)
			       	const url = `/erp/report/cashinvoice?companynum=${rowData.companyNum}&subscriptionnum=${cash[0]}`;
			       	console.log(url);
			       	let modalType = "í˜„ê¸ˆì˜ìˆ˜ì¦";
			       	modalTitle.innerText = modalType;
			     	// (2) PDF.jsë¡œ ìº”ë²„ìŠ¤ ë Œë”ë§
		            renderPDF(url, 3, rowData.companyNum);
			       	
			      	//í˜„ê¸ˆì˜ìˆ˜ì¦ ë°œí–‰
			       	variactionNum = cash[0];
			    	if(cash[1] == 2){
						//ì˜ìˆ˜ì¦ ë°œí–‰ ê°ì²´ ìƒì„±
			    		const requestData = {
			    				subscriptionNum: cash[0],
			    				employeeNum: rowData.companyNum,
			    				billForm: "EB01",
			    				pdfAddress: "ì¤€ë¹„ì¤‘",
			    				issueCompany: "EI02",
			    				companyCode: "NODATA",
			    				companyNum: rowData.companyNum,
						};
			    		const url = `/erp/rest/taxbillpublishing`;
			    		//íŒ¨ì¹˜ ì‹œì‘
						fetch(url, {
							method:"post",
							headers: {
							      "Content-Type": "application/json",
							    },
							body : JSON.stringify(requestData),
						})
						.then( result => result.text() )
						.then( result => {
							if(result==="OK"){
								modal2.show();
								sublistgrid.reloadData();
							    setTimeout(() => {
							        let allRows = sublistgrid.getData();
							        let targetRowKey = allRows.findIndex(row => row.subscriptionNum == tax[0]); 
							        if (targetRowKey !== -1) {
							            sublistgrid.addRowClassName(targetRowKey, 'tui-grid-row-highlight');
							            sublistgrid.focus(targetRowKey, 'subscriptionNum');  // ì´ˆì  ì´ë™
							        }
							    }, 500);
							}else{
								alert('í˜„ê¸ˆì˜ìˆ˜ì¦ ì €ì¥ì— ì‹¤íŒ¨ í–ˆìŠµë‹ˆë‹¤');
							}
						})
			    	}else if(cash[1] == 1){
			    		//ì•„ë¬´ í–‰ìœ„ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ
			    	}
			    	modal2.show();
			    }
			});
			//ëª…ì„¸ì„œë²„íŠ¼ í´ë¦­ ë
			
			//ì•„ë¬´ì…€ í´ë¦­
			sublistgrid.on('click', function (ev) {
				//ë²„íŠ¼ í´ë¦­ì´ë©´ ì „ì²´ í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ ì•ˆí•˜ê²Œ í•˜ê¸°
				if (ev.nativeEvent.target.tagName.toLowerCase() === 'button') {
			        return;
			    }
				if (ev.rowKey !== null) {
					//í˜„ì¬ ê°•ì¡°ëœ í–‰ í´ë˜ìŠ¤ ì´ˆê¸°í™”
					if (subselectedRowKey !== null) {
						sublistgrid.removeRowClassName(subselectedRowKey, 'tui-grid-row-highlight');
			        }
					// í´ë¦­í•œ í–‰ì— ê°•ì¡° íš¨ê³¼ ì¶”ê°€
					sublistgrid.addRowClassName(ev.rowKey, 'tui-grid-row-highlight');
					 // í˜„ì¬ ê°•ì¡°ëœ í–‰ì„ ê¸°ë¡
			        subselectedRowKey = ev.rowKey;
					 
					subrowData = sublistgrid.getRow(ev.rowKey);
					console.log(`í´ë¦­í•œ í–‰ ë°ì´í„°:\n${JSON.stringify(subrowData, null, 2)}`);
					
					// ì˜µì…˜ì¡°íšŒ ì¿¼ë¦¬ í˜¸ì¶œ(goodsCode)
				    fetch('/erp/rest/subscriptionDetail/' + subrowData.subscriptionNum, {
				        method: 'GET',
				        headers: {
				            'Content-Type': 'application/json'
				        }
				    })
				    .then(response => response.json())
				    .then(data => {
				        //subDetailgrid.resetData(data);  // ì˜µì…˜ í…Œì´ë¸” ë°ì´í„° ì—…ë°ì´íŠ¸
				        console.log(data);
				        
				        if (data && data.length > 0) { // ë°ì´í„°ê°€ ì¡´ì¬í•˜ë©´ ëª¨ë‹¬ ì—´ê¸°
			                let modalContent = "";

			                data.forEach((item, index) => {
			                	modalContent += `
			                		<div class="subscription-card">
				                        <span class="icon">âœ…</span>
				                        <strong class="service-name">${index + 1}. ${item.subscriptionName}</strong>
				                        <span class="icon">ğŸ“Œ</span> <span>êµ¬ë…ì˜µì…˜: ${item.subscriptionOption}</span>
				                        <span class="icon">ğŸ’¸ <span>êµ¬ë…ê¸ˆì•¡: <strong>${item.subscriptionOptionPrice}</strong></span>
				                    </div>
			                    `;
			                });
		                    console.log(modalContent);

			                document.querySelector("#subinfolistModal .modal-body").innerHTML = modalContent;

			                // Bootstrap ëª¨ë‹¬ ê°ì²´ ìƒì„± ë° í‘œì‹œ
			                let modal = new bootstrap.Modal(document.getElementById("subinfolistModal"));
			                modal.show();
			            } else {
			                alert("ìƒì„¸ êµ¬ë… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
			            }
				    })
				    .catch(error => console.error("ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨:", error));
				}
			});
		}
		
		//êµ¬ë…ì •ë³´ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ë³´ì—¬ì£¼ê¸°
		var subscriptionState;
		document.querySelector(".reinfo").addEventListener("click", function(){
			subinfo();
		});
		async function subinfo(){
			const requestData = {
					companyNum: rowData.companyNum,	//íšŒì‚¬ë²ˆí˜¸
			};
			const url = '/erp/rest/servicereturn/'+requestData.companyNum;
			fetch ( url, {
				methmod:"get",
				headers: {
					"Content-Type": "application/json",
				    'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
				},
				//body : 
			})
			.then( result => result.json() )
			.then( result => {
				console.log(result);
				let servicetag = `
				<div class="appendsection2">
					<div class="card">
					   <h3 class="card-title">ğŸ“‹ êµ¬ë… ì •ë³´</h3>
					   <div class="service-list">
					`;
				let servicetag1 = ``;
				let servicetag2 = `
						<div class="service-item">
				           <span>âœ… <strong>ê·¸ë£¹ì›¨ì–´ ì„œë¹„ìŠ¤</strong></span>
				           <span>ğŸ‘¥ ê·¸ë£¹ì›¨ì–´: ë¯¸ì‚¬ìš©</span>
				       </div>	
					`;
				let servicetag3 = `
						<div class="service-item">
				           <span>âœ… <strong>ì¸ì‚¬ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
				           <span>ğŸ“Œ ì¸ì‚¬ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
				       </div>	
					`;
				let servicetag4 = `
						<div class="service-item">
				           <span>âœ… <strong>ì§€ì ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
				           <span>ğŸ“Œ ì§€ì ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
				       </div>	
					`;
				let servicetag5 = `
						<div class="service-item">
				           <span>âœ… <strong>íšŒê³„ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
				           <span>ğŸ“Œ íšŒê³„ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
				       </div>	
					`;
				
				result.forEach(ele=>{
					if(ele.subscriptionNameNum == 1 || ele.subscriptionNameNum == 6 ){
						//ì„œë¹„ìŠ¤ì‚¬ìš© í˜•íƒœì™€ ë°©ë²•
						if(ele.limitDay <= 0){
							servicetag1 = `
								<div class="service-item">
						           <span>âœ… <strong>sERPing ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ì¢…ë£Œ</span>
						       </div>
							`;
						}else{
							let endday = localdate(ele.subscriptionEndDate);
							servicetag1 +=`
									<div class="service-item">
							           <span>âœ… <strong>sERPing ì„œë¹„ìŠ¤</strong></span>
							           <span>ğŸ“Œ ${ele.subscriptionForm}</span>
							           <span>â³ ${ele.limitDay}ì¼ ë‚¨ìŒ</span>
							           <span>ğŸ“… ì¢…ë£Œì¼: ${endday}</span>
							       </div>
								`;							
						}
					}
					if(ele.subscriptionNameNum == 2 || ele.subscriptionNameNum == 7 ){
						//ê·¸ë£¹ì›¨ì–´ ì‚¬ìš©
						if(ele.limitDay <= 0){
							servicetag2 = `
								<div class="service-item">
						           <span>âœ… <strong>ê·¸ë£¹ì›¨ì–´ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ‘¥ ê·¸ë£¹ì›¨ì–´: ë¯¸ì‚¬ìš©</span>
						       </div>	
							`;
						}else{
							servicetag2 =`
								<div class="service-item">
						           <span>âœ… <strong>ê·¸ë£¹ì›¨ì–´ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ‘¥ ì‚¬ìš©ì: ${ele.subscriptionOption}</span>
						       </div>
							`;	
						}
					}
					if(ele.subscriptionNameNum == 3 || ele.subscriptionNameNum == 8 ){
						//ì¸ì‚¬ê´€ë¦¬ ì‚¬ìš©
						if(ele.limitDay <= 0){
							servicetag3 = `
								<div class="service-item">
						           <span>âœ… <strong>ì¸ì‚¬ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ì¸ì‚¬ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
						       </div>	
							`;
						}else{
							let endday = localdate(ele.subscriptionEndDate);
							servicetag3 =`
								<div class="service-item">
						           <span>âœ… <strong>ì¸ì‚¬ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ${ele.subscriptionForm}</span>
						           <span>â³ ${ele.limitDay}ì¼ ë‚¨ìŒ</span>
						           <span>ğŸ“… ì¢…ë£Œì¼: ${endday}</span>
						       </div>
							`;	
						}
					}
					if(ele.subscriptionNameNum == 4 || ele.subscriptionNameNum == 9 ){
						//ì§€ì ê´€ë¦¬ ì‚¬ìš©
						if(ele.limitDay <= 0){
							servicetag4 = `
								<div class="service-item">
						           <span>âœ… <strong>ì§€ì ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ì§€ì ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
						       </div>	
							`;
						}else{
							let endday = localdate(ele.subscriptionEndDate);
							servicetag4 =`
								<div class="service-item">
						           <span>âœ… <strong>ì§€ì ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ${ele.subscriptionForm}</span>
						           <span>â³ ${ele.limitDay}ì¼ ë‚¨ìŒ</span>
						           <span>ğŸ“… ì¢…ë£Œì¼: ${endday}</span>
						       </div>
							`;	
						}
					}
					if(ele.subscriptionNameNum == 5 || ele.subscriptionNameNum == 10 ){
						//íšŒê³„ê´€ë¦¬ ì‚¬ìš©
						if(ele.limitDay <= 0){
							servicetag5 = `
								<div class="service-item">
						           <span>âœ… <strong>íšŒê³„ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ íšŒê³„ê´€ë¦¬: ë¯¸ì‚¬ìš©</span>
						       </div>	
							`;
						}else{
							let endday = localdate(ele.subscriptionEndDate);
							servicetag5 =`
								<div class="service-item">
						           <span>âœ… <strong>íšŒê³„ê´€ë¦¬ ì„œë¹„ìŠ¤</strong></span>
						           <span>ğŸ“Œ ${ele.subscriptionForm}</span>
						           <span>â³ ${ele.limitDay}ì¼ ë‚¨ìŒ</span>
						           <span>ğŸ“… ì¢…ë£Œì¼: ${endday}</span>
						       </div>
							`;	
						}
					}
				});	//foreach ë
				servicetag += servicetag1 + servicetag2 + servicetag3 + servicetag4 + servicetag5+`</div></div></div>`;
				document.querySelector(".appendsection").innerHTML = '';
				document.querySelector(".appendsection").insertAdjacentHTML("beforeend", servicetag);
			})	// fetch ë
		}
		
		//ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜
		function localdate(value){
		    const utcDate = new Date(value);
		    // í•œêµ­ ì‹œê°„(KST)ìœ¼ë¡œ ë³€í™˜ (ë‚ ì§œë§Œ)
		    const options = { 
		        year: 'numeric', month: '2-digit', day: '2-digit',
		        timeZone: "Asia/Seoul"
		    };
		    // `toLocaleDateString` ì‚¬ìš©í•˜ì—¬ ë³€í™˜ í›„, í¬ë§·ì„ `yyyy-MM-dd`ë¡œ ì¡°ì •
		    const kstDate = new Intl.DateTimeFormat("ko-KR", options).format(utcDate)
		        .replace(/\./g, '-') // yyyy.MM.dd â†’ yyyy-MM-dd ë¡œ ë³€í™˜
		        .replace(/\s+/g, '') // ë¶ˆí•„ìš”í•œ ê³µë°± ì œê±°
		        .replace(/-$/, '');  // ë§ˆì§€ë§‰ì— ë¶™ëŠ” '-' ì œê±°
		    return kstDate;
		}
		
		//cs ë‚´ì—­
		document.querySelector(".cslist").addEventListener("click", function(){
			cslistfun();
		});
		function cslistfun(){
			//í´ë¦­í•˜ë©´ ë”ìœ¼ë¡œ ì €ê¸° ë‹¤ ìƒì„±ë˜ê²Œ í•´ì•¼í•¨
			const requestData = {
					companyNum: rowData.companyNum,	//íšŒì‚¬ë²ˆí˜¸
			};
			const url = "/erp/rest/csList";
			//íŒ¨ì¹˜ ì‹œì‘
			fetch(url, {
				method:"post",
				headers: {
				      "Content-Type": "application/json",
				      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
				    },
				body : JSON.stringify(requestData),
			})
			.then( result => result.json() )
			.then( result => {
				console.log("íšŒì‹ ê²°ê³¼ ", result);
				
				document.querySelector(".appendsection").innerHTML = '';
				
				result.forEach(ele => {
				    let customerServiceDate = new Date(ele.customerServiceDate); // UTC ê¸°ì¤€ìœ¼ë¡œ Date ê°ì²´ ìƒì„±
				    customerServiceDate.setHours(customerServiceDate.getHours() + 9); // KST(UTC+9) ë³€í™˜
				    // ë³€í™˜ëœ ë‚ ì§œë¥¼ YYYY-MM-DD HH:MM:SS í˜•ì‹ìœ¼ë¡œ í¬ë§·
				    const year = customerServiceDate.getFullYear();
				    const month = String(customerServiceDate.getMonth() + 1).padStart(2, '0');
				    const day = String(customerServiceDate.getDate()).padStart(2, '0');
				    const hours = String(customerServiceDate.getHours()).padStart(2, '0');
				    const minutes = String(customerServiceDate.getMinutes()).padStart(2, '0');
				    const seconds = String(customerServiceDate.getSeconds()).padStart(2, '0');
				    // ìµœì¢… ë³€í™˜ëœ ë‚ ì§œ
				    const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
				    let cstag = `
				        <div class="p-2 mb-3">
				            <table id="answerTable">
				                <tr>
				                    <th style="width:100px;height:40px;">ë‹µë³€ìœ í˜•</th>
				                    <td style="width:70px;">${ele.customerServiceDivision || "N/A"}</td>
				                    <th style="width:100px;">ì²˜ë¦¬ë‹´ë‹¹ì</th>
				                    <td style="width:70px;">${ele.employeeName || "N/A"}</td>
				                    <th style="width:100px;">ì²˜ë¦¬ì¼ì‹œ</th>
				                    <td>${formattedDate || "N/A"}</td>
				                </tr>
				                <tr>
				                    <th>ë‹µë³€ë‚´ìš©</th>
				                    <td class="p-3" colspan="5">
					                    ${ele.customerServiceContent ? ele.customerServiceContent.replace(/\n/g, '<br>') : "ë‚´ìš© ì—†ìŒ"}
					                </td>

				                </tr>
				            </table>
				        </div>
				    `;
				    document.querySelector(".appendsection").insertAdjacentHTML("beforeend", cstag);
				});
			} )
			//íŒ¨ì¹˜ ë
		}
		
		//ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
		document.querySelector(".pwreset").addEventListener("click", function(){
			if(document.querySelector("#customerServiceContent").value){
				const requestData = {
						companyNum: rowData.companyNum,						//íšŒì‚¬ë²ˆí˜¸
						customerServiceDivision: "EQ02",					//ë¬¸ì˜ìœ í˜•
						employeeNum: employeeNum,							//ì²˜ë¦¬ìë²ˆí˜¸
						customerServiceContent: document.querySelector("#customerServiceContent").value,		//ë¬¸ì˜ë‚´ìš©
				};
				const url = "/erp/rest/pwReSet";
				//íŒ¨ì¹˜ ì‹œì‘
				fetch(url, {
					method:"post",
					headers: {
					      "Content-Type": "application/json",
					      // 'Content-Type': 'application/x-www-form-urlencoded',
					      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
					    },
					body : JSON.stringify(requestData),
				})
				.then( result => result.text() )
				.then( result => {
					console.log("ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ê²°ê³¼ " + result);
					if(result==="OK"){
						alert('ì´ˆê¸°í™” ì™„ë£Œ');
						cslistfun();
					}else{
						alert("ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
					}
				} )
				//íŒ¨ì¹˜ ë
			}else{
				alert('ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
			}
		});
		
		//ì„œë¹„ìŠ¤ ìƒíƒœ ë³€ê²½
		document.querySelector(".serviceChange").addEventListener("click", function(){
			//ì¶”í›„ ì„œë¹„ìŠ¤ ë§Œë£Œì‹œ ë‚¨ì€ ê¸°ê°„ë“¤ì—ëŒ€í•œ í•´ì§€ê¸ˆ ì¶œë ¥ í•„ìš”
			if(document.querySelector("#customerServiceContent").value){
				
				let customSelect = document.querySelector(".custom-select").value;
				
				if( rowData.serviceState == customSelect ){
					alert('ë™ì¼í•œ ìƒíƒœë¡œ ë³€ê²½ ë¶ˆê°€ í•©ë‹ˆë‹¤');
				}else{
					//íšŒì‚¬ë²ˆí˜¸ì— ëŒ€í•œ ëª¨ë“  êµ¬ë…ëª©ë¡ì„ ë§Œë£Œì‹œí‚´
					//ì¼ì‹œì •ê¸° ê¸°ëŠ¥ì€ ì œê±° í•˜ì˜€ìŠµë‹ˆë‹¤
					const requestData = {
							companyNum: rowData.companyNum,						//íšŒì‚¬ë²ˆí˜¸
						    customerServiceDivision: "EQ02",					//ë¬¸ì˜ìœ í˜•
						    customerServiceContent: document.querySelector("#customerServiceContent").value,		//ë¬¸ì˜ë‚´ìš©
						    employeeNum: employeeNum,							//ì²˜ë¦¬ìë²ˆí˜¸
						    subscriptionEndDate: rowData.subscriptionEndDate,	//ê¸°ì¡´ êµ¬ë… ë§Œë£Œì¼
						    serviceState: customSelect,							//ì„œë¹„ìŠ¤ìƒíƒœ
					};
					const url = "/erp/rest/serviceToggle";
					//íŒ¨ì¹˜ ì‹œì‘
					fetch(url, {
						method:"post",
						headers: {
						      "Content-Type": "application/json",
						      // 'Content-Type': 'application/x-www-form-urlencoded',
						      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
						    },
						body : JSON.stringify(requestData),
					})
					.then( result => result.text() )
					.then( result => {
						console.log("ì„œë¹„ìŠ¤ë³€ê²½ê²°ê³¼ " + result);
						if(result=="OK"){
							//ì¬ì„ íƒ íš¨ê³¼ ì£¼ê¸°ìœ„í•´ ê°’ì„ ë‹´ìŒ
							let selectedRowKey = rowData ? rowData.rowKey : null;
							grid.reloadData();
							document.querySelector("#customerServiceContent").value = "";
							if(document.querySelector(".custom-select").value=="EC03"){
								document.querySelector("#subscriptionEndDate").value = "1010-10-10";
								document.querySelector("#dDay").value = "ì¢…ë£Œ";
							}else{
								let today = new Date();
								today.setDate(today.getDate() + 9);
								let formattedDate = today.toISOString().split('T')[0];
								document.querySelector("#subscriptionEndDate").value = formattedDate;
								document.querySelector("#dDay").value = "10ì¼";
							}
							cslistfun();
							setTimeout(() => {
					            grid.addRowClassName(selectedRowKey, 'tui-grid-row-highlight');
					        }, 500);
						}else{
							alert("ì„œë¹„ìŠ¤ìƒíƒœ ë³€ê²½ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
						}
					} )
					//íŒ¨ì¹˜ ë
				}
			}else{
				alert("ì²˜ë¦¬ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
			}
		});
		
		//ì„œë¹„ìŠ¤ ê¸°ê°„ ë³€ê²½
		document.querySelector(".dateChange").addEventListener("click", function(){
			
			if(rowData.subscriptionForm == "EL01"){
				if(document.querySelector("#customerServiceContent").value){
					
					let dateChangeInput = parseInt(document.querySelector("#dateChangeInput").value, 10);
					let subscriptionEndDate = document.querySelector("#subscriptionEndDate").value;
					
					let endDate = new Date(subscriptionEndDate);
					endDate.setDate(endDate.getDate() + dateChangeInput);
					let updatedDate = endDate.toISOString().split('T')[0];
					console.log("ìƒˆë¡œìš´ ë§Œë£Œì¼:", updatedDate);
					
					let today = new Date();
					let timeDiff = endDate.getTime() - today.getTime();
					let remainingDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
					console.log("ìƒˆë¡œìš´ ë‚¨ì€ê¸°ê°„:", remainingDays);
					
					//erp_subscription_info_list í…Œì´ë¸” í•´ë‹¹êµ¬ë…ë²ˆí˜¸ì˜ ë§Œë£Œì¼(subscription_end_date) ìˆ˜ì • ë° êµ¬ë…ì¼(subscription_update_date) ìˆ˜ì •
					//erp_company í…Œì´ë¸” ì„œë¹„ìŠ¤ìƒíƒœ(service_state) EC03ìœ¼ë¡œ ë³€ê²½  -10ì¼ë©´ ë§Œë£Œ ì²˜ë¦¬
					
					const requestData = {
							companyNum: rowData.companyNum,						//íšŒì‚¬ë²ˆí˜¸
						    customerServiceDivision: "EQ02",					//ë¬¸ì˜ìœ í˜•
						    customerServiceContent: document.querySelector("#customerServiceContent").value,		//ë¬¸ì˜ë‚´ìš©
						    employeeNum: employeeNum,							//ì²˜ë¦¬ìë²ˆí˜¸
						    subscriptionEndDate: updatedDate,					//êµ¬ë…ë§Œë£Œì¼
						    remainingDays: remainingDays,						//ë‚¨ì€ê¸°ê°„
						    subscriptionNum: rowData.subscriptionNum,			//êµ¬ë…ë²ˆí˜¸
					};
					
					const url = "/erp/rest/serviceChange";
					//íŒ¨ì¹˜ ì‹œì‘
					fetch(url, {
						method:"post",
						headers: {
						      "Content-Type": "application/json",
						      // 'Content-Type': 'application/x-www-form-urlencoded',
						      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
						    },
						body : JSON.stringify(requestData),
					})
					.then( result => result.text() )
					.then( result => {
						console.log("ê¸°ê°„ë³€ê²½ê²°ê³¼ " + result);
						if(result==="OK"){
							//ì¬ì„ íƒ íš¨ê³¼ ì£¼ê¸°ìœ„í•´ ê°’ì„ ë‹´ìŒ
							let selectedRowKey = rowData ? rowData.rowKey : null;
							grid.reloadData();
							cslistfun();
							document.querySelector("#customerServiceContent").value = "";
							setTimeout(() => {
					            grid.addRowClassName(selectedRowKey, 'tui-grid-row-highlight');
					        }, 500);
							document.querySelector("#subscriptionEndDate").value = updatedDate;
							document.querySelector("#dDay").value = remainingDays+"ì¼";	//ë‚¨ì€ê¸°ê°„
							if(remainingDays <= -10){
								document.querySelector(".custom-select").value = "EC03";
							}
						}else{
							alert("ê¸°ê°„ ë³€ê²½ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
						}
					} )
					//íŒ¨ì¹˜ ë
				}else{
					alert('ë‚´ìš©ì„ ê¸°ì…í•´ì•¼ë§Œ í•©ë‹ˆë‹¤.');
				}
			}else{				
				alert("ê¸°ê°„ì œ êµ¬ë…ì¼ë•Œë§Œ ì„œë¹„ìŠ¤ ê°€ëŠ¥í•©ë‹ˆë‹¤");
			}
		});
		
		
		//íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ì‹œ íŒŒì¼ ì„ íƒ ì²˜ë¦¬
		// íŒŒì¼ ì…ë ¥ í•„ë“œ
        const fileInput = document.getElementById("businessLicense");
        // íŒŒì¼ëª… í‘œì‹œí•˜ëŠ” í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ
        const fileNameDisplay = document.getElementById("fileName");
        // ì—…ë¡œë“œ ë²„íŠ¼
        const uploadButton = document.getElementById("businessLicense_upload");
        // ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
        uploadButton.addEventListener("click", function() {
            fileInput.click();  // íŒŒì¼ ì„ íƒì°½ ì—´ê¸°
        });
        // íŒŒì¼ ì„ íƒ í›„ íŒŒì¼ëª… í‘œì‹œ
        fileInput.addEventListener("change", function() {
            if (fileInput.files.length > 0) {
                fileNameDisplay.value = fileInput.files[0].name;  // íŒŒì¼ëª… í‘œì‹œ
            } else {
                fileNameDisplay.value = "";  // íŒŒì¼ ì„ íƒ ì·¨ì†Œ ì‹œ ì´ˆê¸°í™”
            }
        });
      	//íŒŒì¼ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ì‹œ íŒŒì¼ ì„ íƒ ì²˜ë¦¬ ë
		
      	
		// íšŒì‚¬ë“±ë¡ë²„íŠ¼
		const inputComInserbtn = document.querySelector(".inputComInser");
		// ë‹«ê¸°ë²„íŠ¼
		const allCanceinbtn = document.querySelector(".allCance");
		
		// íšŒì‚¬ë“±ë¡ë²„íŠ¼ì²˜ë¦¬
		inputComInserbtn.addEventListener("click", function(){
			//alert('a');
			// íšŒì‚¬ë“±ë¡ë²„íŠ¼ ë¹„í™œì„±í™”
			inputComInserbtn.style.display="none";
			// ë“±ë¡ì–‘ì‹ í™œì„±í™”
			document.querySelector("#formSection").style.display="block";
			// íšŒì‚¬ì‹ ê·œë“±ë¡ ì²˜ë¦¬
			document.querySelector("#customerServiceDivision").value = "EQ04";
			// ë‹«ê¸°ë²„íŠ¼ í™œì„±í™”
			allCanceinbtn.style.display="block";
			// íšŒì‚¬ ì„œë¹„ìŠ¤ ê´€ë ¨ ì¸í’‹ ë°•ìŠ¤ ë¹„í™œì„±í™”
			document.querySelector(".csinfolist").style.display="none";
			// íšŒì‚¬ì˜ë¬¸ëª… ì ì„ìˆ˜ìˆê²Œ
			document.querySelector("#companyEngName").readOnly = false;
			//íšŒì‚¬ ë“±ë¡ë²„íŠ¼ ëˆ„ë¥´ë©´ ì„ íƒí•œ í–‰ì˜ ë°ì´í„° ì‚­ì œ
			rowData = false;
		});
		
		// ë‹«ê¸°ë²„íŠ¼ => í¼ ì´ˆê¸°í™” => í¼ ì˜ì—­ none
		allCanceinbtn.addEventListener("click", function(){
			//alert('a');
			//í¼ ì´ˆê¸°í™”
			document.querySelector("#inputComFrom").reset();
			document.querySelector(".errMessage").innerHTML = '';
			//í¼ ìˆ¨ê¸°ê¸°
			document.querySelector("#formSection").style.display = "none";
			//íšŒì‚¬ ë“±ë¡ë²„íŠ¼ ë‹¤ì‹œë³´ì´ê²Œ
			inputComInserbtn.style.display="block";
			// ë‹«ê¸°ë²„íŠ¼ ë¹„í™œì„±í™”
			allCanceinbtn.style.display="none";
			//csë²„íŠ¼ ì˜ì—­ ì•ˆë³´ì´ê²Œ
			document.querySelector(".csbtnlist").style.display = "none";
			// íšŒì‚¬ ì„œë¹„ìŠ¤ ê´€ë ¨ ì¸í’‹ ë°•ìŠ¤ ë¹„í™œì„±í™”
			document.querySelector(".csinfolist").style.display="none";
			// íšŒì‚¬ì˜ë¬¸ëª… ì ì„ìˆ˜ìˆê²Œ
			document.querySelector("#companyEngName").readOnly = false;
			//ë‹«ê¸° ë“±ë¡ë²„íŠ¼ ëˆ„ë¥´ë©´ ì„ íƒí•œ í–‰ì˜ ë°ì´í„° ì‚­ì œ
			rowData = false;
			//í˜„ì¬ ê°•ì¡°ëœ í–‰ í´ë˜ìŠ¤ ì´ˆê¸°í™”
			if (selectedRowKey !== null) {
	            grid.removeRowClassName(selectedRowKey, 'tui-grid-row-highlight');
	        }
			//csë‚´ì—­ ì˜ì—­ ì§€ìš°ê¸°
			document.querySelector(".appendsection").innerHTML = '';			
		});
		
		let isOkNo = false;
		// íšŒì‚¬ì‚½ì… (ì‹¤ì œ ë“±ë¡í•´ì„œ ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ë¶€ë¶„)
		document.querySelector("#insertAndUpdate").addEventListener("click", async function(){

			let isOkNo = false;
			let errorMessage = "";
			//íšŒì‚¬ëª… ë…¼ë¦¬ ê²€ì¦
			let companyName = document.querySelector("#companyName").value;
			//companyName = "ì¢‹ì€íšŒì‚¬";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
			console.log("íšŒì‚¬ëª… "+companyName);
			if(getByteLength(companyName) < 50 && getByteLength(companyName) >= 1){
				isOkNo = true;
				errorMessage = "";
			}else{
				isOkNo = false;
				errorMessage = 'íšŒì‚¬ëª… 15ì ì´í•˜ ì…ë‹ˆë‹¤';
			}
			if(isOkNo && !rowData){
				//íšŒì‚¬ì˜ë¬¸ëª… ë…¼ë¦¬ ê²€ì¦
				let companyEngName = document.querySelector("#companyEngName").value;
				//companyEngName = "oliveyoungsa";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(getByteLength(companyEngName) <= 20 && isAllLowerCase(companyEngName) && getByteLength(companyEngName) >= 1){
					//í˜¸ì¶œí•´ì•¼í•¨ companyEngName
					let enboolean = await iscomapnyEngName(companyEngName);
					//console.log(enboolean);
					if(!enboolean){
						isOkNo = true;
						errorMessage = "";
					}else{
						isOkNo = false;
						errorMessage = "ì˜ë¬¸ëª…ì´ ì¤‘ë³µë©ë‹ˆë‹¤.";
					}
				}else{
					isOkNo = false;
					errorMessage = 'íšŒì‚¬ì˜ë¬¸ëª…ì€ ì†Œë¬¸ì 20ì ì´í•˜ ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ì‚¬ì—…ìë²ˆí˜¸ ë…¼ë¦¬ ê²€ì¦
				let businessNum1 = document.querySelector("#businessNum1").value;
				let businessNum2 = document.querySelector("#businessNum2").value;
				let businessNum3 = document.querySelector("#businessNum3").value;
				let businessNumber = businessNum1+businessNum2+businessNum3;
				//businessNumber = "6478100749";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(getByteLength(businessNumber) == 10 && isAllNumberCase(businessNumber)){
					document.querySelector("#businessFullNumber").value = businessNum1+"-"+businessNum2+"-"+businessNum3;
					isOkNo = true;
					errorMessage = "";
				}else{
					document.querySelector("#businessFullNumber").value = "";
					isOkNo = false;
					errorMessage = 'ì‚¬ì—…ìë²ˆí˜¸ëŠ” ìˆ«ìë¡œ 10ìë¦¬ ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ëŒ€í‘œìëª… ë…¼ë¦¬ ê²€ì¦
				let representationName = document.querySelector("#representationName").value;
				//representationName = "ë‚˜ëŒ€í‘œ";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(getByteLength(representationName) <= 12 && getByteLength(representationName) >= 1 && isAllKoreanCase(representationName)){
					isOkNo = true;
					errorMessage = "";
				}else{
					isOkNo = false;
					errorMessage = 'ëŒ€í‘œìëª…ì€ í•œê¸€ë¡œ 4ìë¦¬ ì´í•˜ ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ë‹´ë‹¹ìëª… ë…¼ë¦¬ ê²€ì¦
				let chargerName = document.querySelector("#chargerName").value;
				//chargerName = "ë‚˜ì‚¬ì›";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(getByteLength(chargerName) <= 12 && getByteLength(chargerName) >= 1 && isAllKoreanCase(chargerName)){
					isOkNo = true;
					errorMessage = "";
				}else{
					isOkNo = false;
					errorMessage = 'ë‹´ë‹¹ìëª…ì€ í•œê¸€ë¡œ 4ìë¦¬ ì´í•˜ ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ëŒ€í‘œì ë²ˆí˜¸ ë…¼ë¦¬ ê²€ì¦
				let representationPhone = document.querySelector("#representationPhone").value;
				//representationPhone = "01085216704";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				representationPhone = representationPhone.replaceAll("-","").trim();
				if(isAllNumberCase(representationPhone) && getByteLength(representationPhone) == 11){
					isOkNo = true;
					errorMessage = "";
					document.querySelector("#representationPhone").value = formatPhoneNumber(representationPhone);
				}else{
					isOkNo = false;
					errorMessage = 'ëŒ€í‘œìë²ˆí˜¸ëŠ” ìˆ«ì(11ìë¦¬) í•˜ì´í”ˆí¬í•¨(13ìë¦¬)ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ë‹´ë‹¹ì ë²ˆí˜¸ ë…¼ë¦¬ ê²€ì¦
				let chargerPhone = document.querySelector("#chargerPhone").value;
				//chargerPhone = "01085216704";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				chargerPhone = chargerPhone.replaceAll("-","").trim();
				if(isAllNumberCase(chargerPhone) && getByteLength(chargerPhone) == 11){
					isOkNo = true;
					errorMessage = "";
					document.querySelector("#chargerPhone").value = formatPhoneNumber(chargerPhone);
				}else{
					isOkNo = false;
					errorMessage = 'ë‹´ë‹¹ìë²ˆí˜¸ëŠ” ìˆ«ì(11ìë¦¬) í•˜ì´í”ˆí¬í•¨(13ìë¦¬)ì…ë‹ˆë‹¤';
				}
			}
			if(isOkNo){
				//ì´ë©”ì¼ ë…¼ë¦¬ ê²€ì¦
				let chargerEmail = document.querySelector("#chargerEmail").value;
				//chargerEmail = "hayeon8521@kakao.com";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(isValidEmail(chargerEmail)){
					isOkNo = true;
					errorMessage = "";
				}else{
					isOkNo = false;
					errorMessage = 'ì´ë©”ì¼ í˜•ì‹ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.';
				}
			}
			if(isOkNo && !rowData){
				//íŒŒì¼ëª… í™•ì¸
				let businessLicense = document.querySelector("#businessLicense").value;
				//businessLicense = "abad.png";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(businessLicense && isValidFileExtension(businessLicense)){
					isOkNo = true;
					errorMessage = "";
				}else{
					isOkNo = false;
					errorMessage = 'ì´ë¯¸ì§€ ë˜ëŠ” PDF íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.';
				}
			}else if(isOkNo && rowData){
				let businessLicense = document.querySelector("#businessLicense").value;
				if(businessLicense){
					if(isValidFileExtension(businessLicense)){
						isOkNo = true;
						errorMessage = "";
					}else{
						isOkNo = false;
						errorMessage = 'ì´ë¯¸ì§€ ë˜ëŠ” PDF íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.';
					}
				}else{
					isOkNo = true;
					errorMessage = "";
				}
			}
			if(isOkNo && !rowData){
				//ì£¼ì†Œ ë…¼ë¦¬ ê²€ì¦
				let companyAddress = document.querySelector("#companyAddress").value;
				let companyAddressMOD = document.querySelector("#companyAddressMOD").value;
				//companyAddress = "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ê°œí¬ë™";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				//companyAddressMOD = "1188-2";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(getByteLength(companyAddress) >= 1 && getByteLength(companyAddressMOD) >= 1){
					isOkNo = true;
					errorMessage = "";
					document.querySelector("#fullAddress").value = companyAddress+" "+companyAddressMOD;
				}else{
					isOkNo = false;
					errorMessage = 'ì£¼ì†Œë¥¼ ì…ë ¥ í•´ì£¼ì„¸ìš”.';
				}
			}else{
				let companyAddress = document.querySelector("#companyAddress").value;
				let companyAddressMOD = document.querySelector("#companyAddressMOD").value;
				if(companyAddressMOD){
					document.querySelector("#fullAddress").value = companyAddress+" "+companyAddressMOD;				
				}else{
					document.querySelector("#fullAddress").value = companyAddress+companyAddressMOD;
				}
			}
			if(isOkNo){
				//ì‚¬ìœ  ê¸°ì…í•´ì•¼ ë²„íŠ¼ ì²˜ë¦¬ ê°€ëŠ¥
				let customerServiceContent = document.querySelector("#customerServiceContent").value;
				//customerServiceContent = "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ê°œí¬ë™";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				if(customerServiceContent){
					isOkNo = true;
					errorMessage = "";
				}else{
					isOkNo = false;
					errorMessage = 'ë‚´ìš©ì„ ì…ë ¥ í•´ì£¼ì„¸ìš”.';
				}
					
			}
			document.querySelector(".errMessage").innerHTML = errorMessage;
			if (isOkNo) {
				let companyNum = document.querySelector("#companyNum").value;
				let companyName = document.querySelector("#companyName").value;
				let companyEngName = document.querySelector("#companyEngName").value;
				let businessNum = document.querySelector("#businessFullNumber").value;
				let representationName = document.querySelector("#representationName").value;
				let chargerName = document.querySelector("#chargerName").value;
				let representationPhone = document.querySelector("#representationPhone").value;
				let chargerPhone = document.querySelector("#chargerPhone").value;
				let chargerEmail = document.querySelector("#chargerEmail").value;
				//let businessLicense = document.querySelector("#businessLicense").value;
				let companyAddress = document.querySelector("#fullAddress").value;
				let customerServiceContent = document.querySelector("#customerServiceContent").value;
				//let customerServiceDivision = document.querySelector("#customerServiceDivision").value;	//ì´ê±´ ì•„ë«ìª½ì—ì„œ ë°›ìŒ
				
				if(rowData){
					if(rowData.companyName != companyName
							|| rowData.businessNum != businessNum
							|| rowData.representationName != representationName
							|| rowData.chargerName != chargerName
							|| rowData.representationPhone != representationPhone
							|| rowData.chargerPhone != chargerPhone
							|| rowData.chargerEmail != chargerEmail
							|| rowData.companyAddress != companyAddress
							|| document.getElementById("businessLicense").value
					){
						document.querySelector("#customerServiceDivision").value = "EQ02";	//ìƒíƒœë³€ê²½
					}else{
						document.querySelector("#customerServiceDivision").value = "EQ01";	//ë‹¨ìˆœ CS
					}			
				}
				
				let customerServiceDivision = document.querySelector("#customerServiceDivision").value;
				
				/*
				companyName = "ì¢‹ì€íšŒì‚¬16";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				companyEngName = "olivip";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				businessNum = "647-81-00749"
				representationName = "ë‚˜ëŒ€í‘œ";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				chargerName = "ë‚˜ì‚¬ì›";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				representationPhone = "010-8521-6704";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				chargerPhone = "010-8521-6704";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				chargerEmail = "hayeon8521@kakao.com";	//â˜…â˜…â˜…â˜…â˜…â˜…ê²€ì¦í›„ ì§€ìš°ê¸°
				//businessLicense = "abc.png";
				companyAddress = "ì„œìš¸ì‹œ ì¢‹ì€ê³³ì— ìœ„ì¹˜";
				customerServiceContent = "ë¬¸ì˜ë‚´ìš©ì´ì—ìš”";
				customerServiceDivision = "ì§ˆì˜ ë¶„ë¥˜";
				*/
				
				if( customerServiceDivision == "EQ01" ){	//ë‹¨ìˆœë¬¸ì˜
					const requestData = {
							companyNum: companyNum,								//íšŒì‚¬ë²ˆí˜¸
						    customerServiceDivision: customerServiceDivision,	//ë¬¸ì˜ìœ í˜•
						    customerServiceContent: customerServiceContent,		//ë¬¸ì˜ë‚´ìš©
						    employeeNum: employeeNum							//ì²˜ë¦¬ìë²ˆí˜¸
					};
					const url = "/erp/rest/cs";
					//íŒ¨ì¹˜ ì‹œì‘
					fetch(url, {
						method:"post",
						headers: {
						      "Content-Type": "application/json",
						      // 'Content-Type': 'application/x-www-form-urlencoded',
						      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
						    },
						body : JSON.stringify(requestData),
					})
					.then( result => result.text() )
					.then( result => {
						console.log("íšŒì‚¬ë“±ë¡ê²°ê³¼" + result);
						if(result==="OK"){
							//ì¬ì„ íƒ íš¨ê³¼ ì£¼ê¸°ìœ„í•´ ê°’ì„ ë‹´ìŒ
							let selectedRowKey = rowData ? rowData.rowKey : null;
							grid.reloadData();
							document.querySelector("#customerServiceContent").value = "";
							cslistfun();
							setTimeout(() => {
					            grid.addRowClassName(selectedRowKey, 'tui-grid-row-highlight');
					        }, 500);
						}else{
							alert("íšŒì‚¬ ë“±ë¡ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
						}
					} )
					//íŒ¨ì¹˜ ë
				}else if( customerServiceDivision == "EQ03" ){	//ë°œí–‰
					
				}else if( customerServiceDivision == "EQ02" ){	//ì •ë³´ìˆ˜ì •
					//ì´ í•­ëª© ê°œë°œ ë‹¤ë˜ë©´ ì—†ì–´ì§ˆêº¼ì„
					let uploadedFileName = "";
					let businessLicense = "";
					if(document.getElementById("businessLicense").value){
						uploadedFileName = await imgSave();
						if (uploadedFileName === "FAIL") {
							alert('ì¹˜ëª…ì  ì´ë¯¸ì§€ ì˜¤ë¥˜ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜');
					        return;
					    }
						businessLicense = uploadedFileName;
					}
					const url = "/erp/rest/upsertcompnay";
					let serviceState = rowData.serviceState;
					const param = {
							companyNum, companyName, companyEngName,
							representationName, chargerName, representationPhone,
							chargerPhone, chargerEmail, businessLicense,
							companyAddress, businessNum, serviceState
					};
					const requestData = {
							dto: param,
						    customerServiceDivision: customerServiceDivision,
						    customerServiceContent: customerServiceContent,
						    employeeNum: employeeNum
					};
					// íŒ¨ì¹˜ ì‹œì‘
					fetch(url, {
						method:"post",
						headers: {
						      "Content-Type": "application/json",
						      // 'Content-Type': 'application/x-www-form-urlencoded',
						      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
						    },
						body : JSON.stringify(requestData),
					})
					.then( result => result.text() )
					.then( result => {
						console.log("íšŒì‚¬ ìˆ˜ì • ê²°ê³¼" + result);
						if(result==="OK"){
							allCanceinbtn.click();
							grid.reloadData();
						}else{
							alert("íšŒì‚¬ ë“±ë¡ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
						}
					} )
					// íŒ¨ì¹˜ ë
					
				}else{
					//ì´ë¯¸ì§€ ë¨¼ì € ì €ì¥í•˜ê³ 
					const uploadedFileName = await imgSave();
					if (uploadedFileName === "FAIL") {
						alert('ì¹˜ëª…ì  ì´ë¯¸ì§€ ì˜¤ë¥˜ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜');
				        return;
				    }
					let businessLicense = uploadedFileName;
	    		    
					
					const url = "/erp/rest/newcomapny";
					const param = {
									companyName, companyEngName,
									representationName, chargerName, representationPhone,
									chargerPhone, chargerEmail, businessLicense,
									companyAddress, businessNum
					};
					const requestData = {
											dto: param,
										    customerServiceDivision: customerServiceDivision,
										    customerServiceContent: customerServiceContent,
										    employeeNum: employeeNum
					};
					fetch(url, {
						method:"post",
						headers: {
						      "Content-Type": "application/json",
						      // 'Content-Type': 'application/x-www-form-urlencoded',
						      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
						    },
						body : JSON.stringify(requestData),
					})
					.then( result => result.text() )
					.then( result => {
						console.log("íšŒì‚¬ë“±ë¡ê²°ê³¼" + result);
						if(result==="OK"){
							allCanceinbtn.click();
							grid.reloadData();
						}else{
							alert("íšŒì‚¬ ë“±ë¡ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ ê´€ë¦¬ì ë¬¸ì˜");
						}
					} )
				}
		    }
		});

		//ë¬¸ì ê¸¸ì´ êµ¬í•˜ëŠ” í•¨ìˆ˜ ( ë°”ì´íŠ¸ í˜•ì‹ )
		function getByteLength(str) {
		    let byteLength = 0;
		    for (let i = 0; i < str.length; i++) {
		        const char = str.charAt(i);
		        byteLength += (char.charCodeAt(0) > 127) ? 3 : 1; // í•œê¸€ íŠ¹ë¶„ 3ë°”ì´íŠ¸ (DB ì¼ì¹˜)
		    }
		    return byteLength;
		}
		//ì†Œë¬¸ì í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ( ì •ê·œì‹ )
		function isAllLowerCase(str) {
		    const lowerCaseRegex = /^[a-z]+$/;	//^[a-z\s]+$ = ë„ì›Œì“°ê¸° í—ˆìš©
		    return lowerCaseRegex.test(str);
		}
		//ìˆ«ì í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ( ì •ê·œì‹ )
		function isAllNumberCase(str){
			return /^\d+$/.test(str);
		}
		//ì™„ì„±í˜• í•œê¸€ë§Œ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ( ì •ê·œì‹ )
		function isAllKoreanCase(str) {
		    const KoreanCaseRegex = /^[ê°€-í£]+$/;
		    return KoreanCaseRegex.test(str);
		}
		//ì „í™”ë²ˆí˜¸ ë³€í™˜ í•¨ìˆ˜ ( ì •ê·œì‹ )
		function formatPhoneNumber(phoneNumber) {
		    return phoneNumber.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
		}
		//ì´ë©”ì¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ( ì •ê·œì‹ )
		function isValidEmail(email) {
		    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
		    return emailRegex.test(email);
		}
		// ì´ë¯¸ì§€ ë˜ëŠ” pdf íŒŒì¼ëª… í™•ì¸í•˜ëŠ” í•¨ìˆ˜
		function isValidFileExtension(filename) {
		    const fileRegex = /\.(jpg|jpeg|png|gif|pdf)$/i;
		    return fileRegex.test(filename);
		}
		// íšŒì‚¬ì˜ë¬¸ëª… ì¤‘ë³µì½”ë“œ í™•ì¸
		async function iscomapnyEngName(str){
			const url = `/erp/rest/comenname/${str}`;
			return fetch ( url, {
				method: "GET",
		        headers: {
			      'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
			    },
			} )
			.then ( result => result.json() )
			.then ( result => {
				//alert(result);
				return result;
			})
		}
		// ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜
		async function imgSave(){
			const fileInput = document.getElementById("businessLicense");
			const file = fileInput.files[0];
			const formData = new FormData();
		    formData.append("file", file);
		    return fetch("/erp/rest/uploadBusinessLicense", {
		        method: "POST",
		        headers: {
			      //'X-CSRF-TOKEN': document.querySelector('#csrfToken').value,
			    },
		        body: formData
		    })
		    .then(response => response.text())
		    .then(data => {
		    	return data;
		    })
		    .catch(error => {
		        console.error("íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
		    });
		}
		
		
		// (1) PDF.jsë¡œ PDF íŒŒì¼ì„ ìº”ë²„ìŠ¤ì— ë Œë”ë§
		function renderPDF(reportUrl, categori, companyNum) {
		  const canvas = document.getElementById("pdfCanvas");
		  const context = canvas.getContext('2d');
		  const pdfContainer = document.querySelector('.pdf-container');
		  // PDF ë¡œë“œ
		  pdfjsLib.getDocument(reportUrl).promise.then(pdf => {
		    console.log('PDF loaded, total pages:', pdf.numPages);
		    // ì²« í˜ì´ì§€ë§Œ ë Œë”ë§ (í•„ìš”ì‹œ ì—¬ëŸ¬ í˜ì´ì§€ ì§€ì› ê°€ëŠ¥)
		    pdf.getPage(1).then(page => {
		      const scale = 1.5; // í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨
		      const viewport = page.getViewport({ scale });
		      // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
		      canvas.width = viewport.width;
		      canvas.height = viewport.height;
		      // í˜ì´ì§€ ë Œë”ë§
		      const renderContext = {
		        canvasContext: context,
		        viewport: viewport
		      };
		      page.render(renderContext).promise.then(() => {
		        console.log('Page rendered');
		      });
		      if(categori==2){
	              setTimeout(() => {
	                  pdfContainer.scrollTop = 75;
	              }, 300);		    	  
		      }else if(categori==1 || categori==2){
		    	  setTimeout(() => {
	                  pdfContainer.scrollTop = 25;
	              }, 300);	
		      }
		    });
		  }).catch(error => {
		    console.error('PDF ë¡œë“œ ì˜¤ë¥˜:', error);
		  });
		}
		
		//pdfë‹¤ìš´
		document.getElementById('pdfDown').addEventListener('click', function () {
			const modalTitle = document.getElementById('modalTitle').innerHTML;
			let billtype = 0;
			if(modalTitle=="ê±°ë˜ëª…ì„¸ì„œ"){
				billtype = 1;
			}else if(modalTitle=="ì„¸ê¸ˆê³„ì‚°ì„œ"){
				billtype = 2;
			}else{
				billtype = 3;
			}
			// ë‹¤ìš´ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸ URL ìƒì„±
			const url = `/erp/report/taxinvoicedown?companynum=${rowData.companyNum}&subscriptionnum=${variactionNum}&billtype=${billtype}`;	
		    // ë¸Œë¼ìš°ì €ë¥¼ í•´ë‹¹ URLë¡œ ì´ë™ì‹œì¼œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤í–‰
		    window.location.href = url;
		});
		
		// ëª¨ë‹¬ ë‹«ê¸°
		document.addEventListener("DOMContentLoaded", function () {
		    const modalElement = document.getElementById("universalModal"); // í†µí•© ëª¨ë‹¬ ID
		    if (!modalElement) {
		        console.warn("âŒ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		        return;
		    }
		    const closeButton =  document.querySelector(".closemodal");
		    if (closeButton) {
		        closeButton.addEventListener("click", function () {
		            console.log("âœ… ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ë¨!");
		            try {
		                let modalInstance = bootstrap.Modal.getInstance(modalElement);
		                
		                if (!modalInstance) {
		                    modalInstance = new bootstrap.Modal(modalElement);
		                }
		                modalInstance.hide(); // âœ… Bootstrap ë°©ì‹ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
		                setTimeout(() => {
		                    modalElement.classList.remove("show");
		                    modalElement.style.display = "none";
		                    document.body.classList.remove("modal-open");
		                    // ğŸ”¥ ë°±ê·¸ë¼ìš´ë“œ ì œê±°
		                    document.querySelectorAll(".modal-backdrop").forEach((element) => element.remove());
		                }, 300);
		            } catch (error) {
		                console.warn("âŒ Bootstrap 5ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŒ. ëŒ€ì²´ ë°©ì‹ ì‚¬ìš©");
		                modalElement.classList.remove("show");
		                modalElement.style.display = "none";
		                document.body.classList.remove("modal-open");
		                setTimeout(() => {
		                    document.querySelectorAll(".modal-backdrop").forEach((element) => element.remove()); // ë°±ê·¸ë¼ìš´ë“œ ì œê±°
		                }, 300);
		            }
		        });
		    } else {
		        console.warn("âŒ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		    }
		});
		// ëª¨ë‹¬ ë‹«ê¸° ë
      
	</script>
</div>