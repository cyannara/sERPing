<!DOCTYPE html>
<html
        layout:decorate="~{layouts/layout}"
        lang="en"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns="http://www.w3.org/1999/xhtml"
>
<head>
    <meta charset="UTF-8">
    <title>ê²°ì¬ë¬¸ì„œ</title>

    <link rel="stylesheet" href="/css/stdr/doc.css"/>
</head>
<body layout:fragment="content">
    <h3 class="mb-4">ë¬¸ì„œ ì¡°íšŒ</h3>
    <div id="table-container">
        <div id="grid"></div>
        <div id="pagination" class="tui-pagination"></div>
    </div>
    <h3 class="mb-4">ë¬¸ì„œ ë“±ë¡</h3>
    <div id="custom-container">
    <div class="row mb-4">
        <div class="col-md-3">
            <label class="form-label">ìš”ì²­êµ¬ë¶„</label>
            <input type="text" class="form-control" name="documentType" id="documentType">
        </div>
        <div class="col-md-3">
            <label class="form-label">ë¬¸ì„œì œëª©</label>
            <input type="text" class="form-control" name="documentName"  id="documentName">
        </div>
        <div class="col-md-3 dropdown-dept">
            <label class="form-label">ê²°ì¬ë¶€ì„œ</label>
            <input type="text" class="form-control" name="deptName" id="deptName" placeholder="ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”" readonly>
            <ul class="dropdown-menu" id="dropdownMenu"></ul>
        </div>
        <div class="col-md-3 dropdown-type">
            <label class="form-label">ê²°ì¬ì¢…ë¥˜</label>
            <input type="text" class="form-control" name="approvalType" id="approvalType" placeholder="ê²°ì¬ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”" readonly>
            <ul class="dropdown-menu" id="dropdownType">
                <li><a class="dropdown-item" data-type="IN">ë‚´ë¶€ ê²°ì¬</a></li>
                <li><a class="dropdown-item" data-type="OUT">ì™¸ë¶€(ê±°ë˜ì²˜) ê²°ì¬</a></li>
            </ul>
        </div>
    </div>
    <div id="editor"></div>
    <button id="addBtn">ë“±ë¡</button>

    <script src="/js/stdr/doc.js"></script>
    <script>
        let Grid = tui.Grid;

        const dataSource = {
            api: {
                readData: { url: 'http://localhost:81/stdr/rest/document', method: 'GET', initParams: { page: 1 } },
                contentType: 'application/json'
            },
        };

        const grid = new Grid({
            el: document.querySelector('#grid'),
            scrollX: false,
            scrollY: false,
            pageOptions: {
                useClient: false,
                perPage: 10,
            },
            columns: [
                {header: "ë²ˆí˜¸", name: "documentId", sortable: true},
                {header: "ìš”ì²­êµ¬ë¶„", name: "documentType", sortable: true},
                {header: "ë¬¸ì„œì œëª©", name: "documentName", sortable: true},
                {
                    header: "ë¬¸ì„œ í…œí”Œë¦¿",
                    name: "moveToPage",
                    sortable: true,
                    formatter: ({ row }) => {
                        return `<button class="move-btn" data-id="${row.documentId}">
                          <i class="mdi mdi-arrow-right-bold"></i>
                        </button>`;
                    }
                },
                {header: "ê²°ì¬ë¶€ì„œ", name: "deptName", sortable: true}
            ],
            data : dataSource,
        });

        const Editor = toastui.Editor;
        const { tableMergedCell } = Editor.plugin;

        const tableContent = `
# ê·¼íƒœ ìˆ˜ì • ìš”ì²­ì„œ

| í•­ëª©       |         |
|-------------|--------|
| **ì‚¬ì›ë²ˆí˜¸** | [ì‚¬ì›ë²ˆí˜¸ ì…ë ¥] |
| **ì‚¬ì›ëª…**  | [ì‚¬ì›ëª… ì…ë ¥] |
| **ë¶€ì„œ**    | [ë¶€ì„œ ì…ë ¥] |
| **ìˆ˜ì • ìš”ì²­ì¼** | [YYYY-MM-DD] |
| **ê¸°ì¡´ ì¶œê·¼ ì‹œê°„** | [ê¸°ì¡´ ì¶œê·¼ ì‹œê°„ ì…ë ¥] |
| **ê¸°ì¡´ í‡´ê·¼ ì‹œê°„** | [ê¸°ì¡´ í‡´ê·¼ ì‹œê°„ ì…ë ¥] |
| **ì‹¤ì œ ì¶œê·¼ ì‹œê°„** | [ì‹¤ì œ ì¶œê·¼ ì‹œê°„ ì…ë ¥] |
| **ì‹¤ì œ í‡´ê·¼ ì‹œê°„** | [ì‹¤ì œ í‡´ê·¼ ì‹œê°„ ì…ë ¥] |
| **ìˆ˜ì • ì‚¬ìœ ** | [ìˆ˜ì • ì‚¬ìœ  ì…ë ¥] |

---

### ğŸ“Œ ìš”ì²­ ë‚´ìš©
ê·¼íƒœ ìˆ˜ì • ìš”ì²­ ì‚¬ìœ ë¥¼ ì‘ì„±í•´ ì£¼ì„¸ìš”.

\`\`\`
[ì‚¬ìœ  ì…ë ¥]
\`\`\`

---

**ğŸ“… ì‘ì„±ì¼:** [YYYY-MM-DD]
`;

        const editor = new Editor({
            el: document.querySelector('#editor'),
            previewStyle: 'vertical',
            height: '500px',
            initialValue: tableContent,
            initialEditType: 'wysiwyg',
            plugins: [tableMergedCell],
        });

        const addBtn = document.getElementById('addBtn')
        addBtn.addEventListener('click', () => {
            addDocTemplate()
        })

        const deptName = document.getElementById("deptName");
        const dropdownMenu = document.getElementById("dropdownMenu");
        const approvalType = document.getElementById("approvalType");
        const dropdownType = document.getElementById("dropdownType");

        // Input í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        deptName.addEventListener("click", function () {
            dropdownMenu.classList.toggle("show");
        });
        approvalType.addEventListener("click", function () {
            dropdownType.classList.toggle("show");
        });

        // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
        document.addEventListener("click", function (event) {
            if (!deptName.closest(".dropdown-dept").contains(event.target)) {
                dropdownMenu.classList.remove("show");
            }
            if (!approvalType.closest(".dropdown-type").contains(event.target)) {
                dropdownType.classList.remove("show");
            }
        });

        getHqDeptList()

        document.addEventListener("click", function (event) {
            const button = event.target.closest(".move-btn");
            if (button) {
                const dataset = button.dataset; // ë²„íŠ¼ì—ì„œ data-id ê°’ ê°€ì ¸ì˜¤ê¸°
                window.location.href = `/standard/doc/template?documentId=${dataset.id}`;
            }
        });
    </script>
    </div>
</body>
</html>
