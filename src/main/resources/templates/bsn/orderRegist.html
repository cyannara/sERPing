<!DOCTYPE html>
<html 
lang="en"
layout:decorate="~{layouts/layout}" 
xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>

<head>
 
  <style>
  	#custom-container{
		background-color: #f8f9fa; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
		padding: 20px;
		border-radius: 10px;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* ë°•ìŠ¤ ê·¸ë¦¼ì */
		margin-bottom: 20px;
	
	}
  </style>
  

</head>

<body layout:fragment="content">
  <!-- í˜ì´ì§€ ë‚´ìš© ì‹œì‘ -->
  <div class="container">
	
    <h3>ì£¼ë¬¸ ë“±ë¡</h3>

    <!-- ğŸ” ê²€ìƒ‰ ì¡°ê±´ -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">ê²€ìƒ‰ ì¡°ê±´</h4>
                    <p class="card-description">ê²€ìƒ‰ ì¡°ê±´ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                    <!--  <form name='searchForm' action="/bsn/order" class="forms-sample"> -->
                        <div class="d-flex align-items-center gap-3">
                            <!-- ë¼ë””ì˜¤ ë²„íŠ¼ -->
                            <div class="d-flex gap-3">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="optionsRadios" value="notSelect" checked onclick="toggleDateInputs(false)">
                                        ì‚¬ìš©ì•ˆí•¨
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="optionsRadios" value="orderDate" onclick="toggleDateInputs(true)">
                                        ì£¼ë¬¸ì¼ì
                                    </label>
                                </div>
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input type="radio" class="form-check-input" name="optionsRadios" value="dueDate" onclick="toggleDateInputs(true)">
                                        ë‚©ê¸°ì¼ì
                                    </label>
                                </div>
                            </div>

                            <!-- ë‚ ì§œ ì…ë ¥ -->
                            <div class="d-flex gap-3">
                                <div>
                                    <label for="startDate">ì‹œì‘ ë‚ ì§œ</label>
                                    <input type="date" class="form-control" id="startDate" name="startDate" disabled>
                                </div>
                                <div>
                                    <label for="endDate">ë ë‚ ì§œ</label>
                                    <input type="date" class="form-control" id="endDate" name="endDate" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="form-group m-3">
                            <label for="selectBhf">ë°œì£¼ì§€ì </label>
                            <select class="form-control" id="selectBhf">
                            	<option>all</option>
                                <option>ë°œì£¼ì§€ì 1</option>
                                <option>ë°œì£¼ì§€ì 2</option>
                                <option>ë°œì£¼ì§€ì 3</option>
                                <option>yedam</option>
                            </select>
                        </div>
						<div class="col-12 text-center">
                        	<button class="btn btn-primary mr-2" onclick="search()">ê²€ìƒ‰</button>
                        	<button class="btn btn-light"        onclick="reset()">ì´ˆê¸°í™”</button>
                        </div>
                    <!-- </form> -->
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“‹ ë°œì£¼ ìš”ì²­ ë¦¬ìŠ¤íŠ¸ & ì„ íƒí•œ ë°œì£¼ ìš”ì²­ ì •ë³´ -->
    <div class="row">
        <!-- ë°œì£¼ ìš”ì²­ ë¦¬ìŠ¤íŠ¸ -->
        <div class="col-md-9 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">ğŸ“‹ ê²€ìƒ‰ ê²°ê³¼ (ë°œì£¼ ìš”ì²­ ë¦¬ìŠ¤íŠ¸)</h4>
                    <p class="card-description">ê·¸ë¦¬ë“œ - ê²€ìƒ‰í•œ ì§€ì ì¸¡ ë°œì£¼ ì‹ ì²­ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥</p>
                    <div id="orderList"></div>
                    <div id="pagination" class="tui-pagination"></div>
                </div>
            </div>
        </div>

        <!-- ì„ íƒí•œ ë°œì£¼ ìš”ì²­ ì •ë³´ -->
        <div class="col-md-3 col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">ğŸ“ ì„ íƒí•œ ë°œì£¼ ìš”ì²­ ì •ë³´</h4>
                    <p class="card-description">ì„ íƒí•œ ë°œì£¼ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                    <div id="selectedOrder"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“¦ ì„ íƒí•œ ë°œì£¼ ìƒì„¸ ì •ë³´ -->
    <div class="row">
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">ğŸ“¦ ì„ íƒí•œ ë°œì£¼ ìƒì„¸ (ìƒí’ˆ ë¦¬ìŠ¤íŠ¸)</h4>
                    <p class="card-description">ê·¸ë¦¬ë“œ - ì„ íƒí•œ ë°œì£¼ ì‹ ì²­ì˜ ìƒì„¸(ìƒí’ˆ) ëª©ë¡ ì¶œë ¥</p>
                    <div id="orderDetailList"></div>
                    <div id="pagination" class="tui-pagination"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… ìŠ¹ì¸ / ğŸš« ê±°ë¶€ ë²„íŠ¼ -->
    <div class="row mt-3">
        <div class="col-12 text-center">
            <button class="btn btn-success" id="registerButton">âœ… ìŠ¹ì¸ (ë“±ë¡)</button>
            <button class="btn btn-danger"  id="cancelButton">ğŸš« ê±°ë¶€ (ì·¨ì†Œ)</button>
        </div>
    </div>
    
    <!-- ëª¨ë‹¬ë“¤  (ëª¨ë‹¬ID, ëª¨ë‹¬ì‚¬ì´ì¦ˆ(modal-xl,...), ëª¨ë‹¬ì œëª©, ëª¨ë‹¬ë‚´ìš© HTML, ëª¨ë‹¬í’‹í„° HTML)-->
      
       
    <div th:include="bsn/modal/bsnModalTemplate :: ModalTemplate (
						    	'registerModal', 
						    	'modal-md', 
						    	'ì£¼ë¬¸ ë“±ë¡', 
						    	'bsn/modal/bsnOrdRegister', 
						    	'bsn/modal/bsnModalFooter'
						    )">
     </div>
     
      
     <div th:include="bsn/modal/bsnModalTemplate :: ModalTemplate(
						    	'cancelModal', 
						    	'modal-md', 
						    	'ë°œì£¼ ê±°ë¶€ ë° ì·¨ì†Œ', 
						    	'bsn/modal/bsnOrdCancel', 
						    	'bsn/modal/bsnModalFooter')">
     </div>
     
    
    
</div>

      <!-- container ë -->

  <!-- í˜ì´ì§€ ë‚´ìš© ë -->
  
  	<!-- ì„¸ì…˜ì •ë³´ -->
  	  <script th:inline="javascript">
	  	let companyNum = [[${session.companyNum}]];
	  	let employeeNum = [[${session.employeeNum}]];
	  </script>
	  
	  <script>
	  
	  <!-- ê²€ìƒ‰ì°½ ë‚ ì§œ ë¹„í™œì„± -->
	  	function toggleDateInputs(enable) {
	      document.getElementById("startDate").disabled = !enable;
	      document.getElementById("endDate").disabled = !enable;
	      //console.log(companyNum);
	      //console.log(employeeNum);;
	      
	     
	    }
	 
	  
	  
	    var Grid = tui.Grid;
	    var selectedRow = null; // ì„ íƒëœ ì£¼ë¬¸ ì •ë³´
	    var detailData = [];    // ìƒì„¸ ë°ì´í„° ì •ë³´
	    
	    

		
		const dataSource = {
				api: {
					readData: { url: '/bsn/rest/bhfOrder', method: 'GET', 
						initParams: { page: 1 }},
				},
				contentType: 'application/json'
			};
		//ìƒí’ˆ í…Œì´ë¸”
		const grid = new Grid({
				el: document.getElementById('orderList'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
				pageOptions: {
				useClient: false,
				perPage: 10,

			},
			//rowHeaders: ['checkbox'],
			columns: [ 
				{ header : "ì£¼ë¬¸ì½”ë“œ", name : "orderCode"},
				{ header : "ì§€ì ì½”ë“œ", name : "branchOfficeId"},
				{ header : "ì£¼ë¬¸ì¼", name : "orderDate", formatter: ({ value }) => formatDate(value, 'order'), sortable : true},
				{ header : "ë‚©ê¸°ì¼", name : "dueDate", formatter: ({ value }) => formatDate(value, 'due'), sortable : true},
				{ header : "ë¹„ê³ ", name : "remark", formatter: ({ value }) => truncate(value, 10)},
				//{ header : "íšŒì‚¬ë²ˆí˜¸", name : "companyNum"},
			],
			data: dataSource
		});
		
		//ê·¸ë¦¬ë“œ ë‚ ì§œ í˜•ì‹ ë³€ê²½(ë°ì´í„° ìˆ˜ì •X, í‘œê¸°ë§Œ)
		function formatDate(dateString, type) {
		    if (!dateString) return ''; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
		    const date = new Date(dateString);
		    if (isNaN(date)) return dateString; // ë‚ ì§œ ë³€í™˜ì´ ì‹¤íŒ¨í•˜ë©´ ì›ë³¸ ìœ ì§€

		    return type === 'order' 
		        ? date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' }) // "2025ë…„ 2ì›” 17ì¼"
		        : date.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' }) // "2025ë…„ 2ì›” 17ì¼"
		        	//date.toLocaleDateString('ko-KR', { month: '2-digit', day: '2-digit', weekday: 'short' }); // "02/17 (ì›”)"
		}
		
		// remark ë‚´ìš©ì´ ê¸¸ë©´ ìë¥´ëŠ” í•¨ìˆ˜
		function truncate(value, maxLength) {
		  if (!value) return "";
		  return value.length > maxLength ? value.slice(0, maxLength) + "..." : value;
		}
		
	  	//ì•ˆì“°ëŠ”ì¤‘
		function changeDisplay() {
		    let gap = parseInt(document.querySelector('#perPageSelect').value); // perPage ê°’ì„ ê°€ì ¸ì˜´
		    grid.setPerPage(gap);
		}

		
		//<!-- ë°œì£¼ë¥¼ ì„ íƒí•˜ë©´ ì„ íƒí•œ ì£¼ë¬¸ ì½”ë“œë¡œ ìƒì„¸ ì •ë³´ ë¡œë“œ -->
		grid.on('click', (ev) => {
			const rowKey = ev.rowKey;
			selectedRow = grid.getRow(rowKey);
			
			
			if (selectedRow) {
		        document.querySelector('#selectedOrder').innerHTML = `
		            <p><strong>ì£¼ë¬¸ ì½”ë“œ:</strong> ${selectedRow.orderCode}</p>
		            <p><strong>ì§€ì ID:</strong> ${selectedRow.branchOfficeId}</p>
		            <p><strong>ì£¼ë¬¸ì¼:</strong> ${formatDate(selectedRow.orderDate, 'order')}</p>
		            <p><strong>ë‚©ê¸°ì¼:</strong> ${formatDate(selectedRow.dueDate, 'due')}</p>
		            ${selectedRow.remark ? `<p><strong>ë¹„ê³ :</strong> ${selectedRow.remark}</p>` : ''}
		        `;
		        
		    }
			
			
		    if (selectedRow && selectedRow.orderCode) { // orderCodeê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
		        loadOrderDetails(selectedRow.orderCode);
		        console.log("ì„ íƒëœ ì£¼ë¬¸ ì½”ë“œ:", selectedRow.orderCode);
		        
		    } else {
		        console.warn("ì„ íƒëœ ì£¼ë¬¸ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
		    }
		});
		
		function loadOrderDetails(orderCode) {
		    if (!orderCode) {
		        console.warn("ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ë¬¸ ì½”ë“œì…ë‹ˆë‹¤.");
		        return;
		    }

		    fetch(`/bsn/rest/bhfOrder/detail?orderCode=${orderCode}&perPage=5&page=1`)
		        .then(response => {
		            if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
		            return response.json();
		        })
		        .then(data => {
		            if (data && data.data && data.data.contents) {
		            	detailData = data.data.contents; // ìƒì„¸ ë°ì´í„° ì €ì¥
		            	//
		                detailGrid.resetData(data.data.contents);
		            } else {
		                console.warn("ìƒì„¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
		                detailGrid.resetData([]); // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
		                //
		                detailGrid.resetData(detailData);
		            }
		        })
		        .catch(error => console.error('Error:', error));
		}

		
		
		const detailGrid = new Grid({
		    el: document.getElementById('orderDetailList'),
		    pageOptions: {
		        useClient: false,
		        perPage: 5,
		    },
		    columns: [
		        { header: "ë°œì£¼ìƒì„¸ì½”ë“œ", name: "orderDetailCode" },
		        { header: "ìƒí’ˆë²ˆí˜¸", name: "goodsCode" },
		        { header: "ìƒí’ˆì´ë¦„", name: "goodsName" },
		        { header: "ì˜µì…˜ëª…", name: "optionName" },
		        { header: "ê·œê²©", name: "goodsStandard" },
		        { header: "ìˆ˜ëŸ‰", name: "quantity" },
		    ]
		});
		
		//í˜ì´ì§€ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì „ì²´ ê²€ìƒ‰
		document.addEventListener('DOMContentLoaded', function() {
		    search();  // DOMContentLoaded ì´ë²¤íŠ¸ í›„ ìë™ìœ¼ë¡œ ê²€ìƒ‰ ì‹¤í–‰
		});

		//ê²€ìƒ‰
		function search(){
			let selectedOption = document.querySelector('input[name="optionsRadios"]:checked').value; // ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ ê°’
		    let startDate = document.getElementById("startDate").value; // ì‹œì‘ ë‚ ì§œ
		    let endDate = document.getElementById("endDate").value; // ë ë‚ ì§œ
		    let selectedBhf = document.getElementById("selectBhf").value; // ë°œì£¼ì§€ì  ì„ íƒ ê°’
		    
		    console.log(selectedOption, startDate, endDate, selectedBhf);
		    
		    let params = {
		    		"companyNum": companyNum,
		    		"deteOption": selectedOption,
		            "startDate": startDate,
		            "endDate": endDate,
		            "branch": selectedBhf
		    };
		    
		    console.log("ê²€ìƒ‰ ì¡°ê±´:", params);
		    
		 	grid.readData(1, params, true);
		   
		}
		
		//ê²€ìƒ‰ ì¡°ê±´ ì´ˆê¸°í™”
		function reset(){
			// ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ ê°’ ì´ˆê¸°í™”
		    // "ì‚¬ìš©ì•ˆí•¨" ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì²´í¬í•˜ë„ë¡ ì„¤ì •
		    let notSelectRadio = document.querySelector('input[name="optionsRadios"][value="notSelect"]');
		    if (notSelectRadio) {
		        notSelectRadio.checked = true;  // "ì‚¬ìš©ì•ˆí•¨" ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ
		        toggleDateInputs(false);  // ë‚ ì§œ ì…ë ¥ ë¹„í™œì„±í™”
		    }

			// ì‹œì‘ ë‚ ì§œì™€ ë ë‚ ì§œ ì´ˆê¸°í™”
	    	document.getElementById("startDate").value = "";
	    	document.getElementById("endDate").value = "";
	    	// ë°œì£¼ì§€ì  ì„ íƒ ê°’ ì´ˆê¸°í™”
	        document.getElementById("selectBhf").value = "all";


		}
		
		
		// ì£¼ë¬¸ë“±ë¡, ë°œì£¼ì·¨ì†Œ í•œë’¤ í™”ë©´ ì´ˆê¸°í™”
		function refreshOrderGrid() {
			
			
		    // ìƒì„¸ í…Œì´ë¸” ì´ˆê¸°í™”
		    detailGrid.resetData([]);

		    // ê·¸ë¦¬ë“œ ë°ì´í„° ê°±ì‹ 
		    grid.reloadData();

		    // ìš”ì²­ ì •ë³´ ì¶œë ¥ ì‚­ì œ
		    document.querySelector('#selectedOrder').innerHTML = '';
		    
		    selectedRow = null; // ì„ íƒëœ ì£¼ë¬¸ ì •ë³´ ì´ˆê¸°í™”
			detailData = [];    // ìƒì„¸ ë°ì´í„° ì •ë³´ ì´ˆê¸°í™”
		}

		
		
		
		
		// ëª¨ë“  í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
		async function loadAllOrderDetails(orderCode) {
		    if (!orderCode) {
		        console.warn("ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ë¬¸ ì½”ë“œì…ë‹ˆë‹¤.");
		        return;
		    }
		
		    let allDetails = [];
		    let page = 1;
		    let isLastPage = false;
		
		    while (!isLastPage) {
		        try {
		            const response = await fetch(`/bsn/rest/bhfOrder/detail?orderCode=${orderCode}&perPage=5&page=${page}`);
		            if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
		            
		            const data = await response.json();
		            if (data?.data?.contents?.length) {
		                allDetails = allDetails.concat(data.data.contents);
		                page++;
		            } else {
		                isLastPage = true;
		            }
		        } catch (error) {
		            console.error("ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
		            isLastPage = true;
		        }
		    }
		
		    console.log("ëª¨ë“  ìƒì„¸ ë°ì´í„°:", allDetails);
		
		    let orderDTO = {
		        orderCode: selectedRow.orderCode,
		        branchOfficeId: selectedRow.branchOfficeId,
		        orderDate: selectedRow.orderDate,
		        dueDate: selectedRow.dueDate,
		        remark: selectedRow.remark,
		        companyNum: selectedRow.companyNum,
		        employeeNum: employeeNum,
		        orderDetails: allDetails
		    };
		
		    console.log("ë“±ë¡í•  ì£¼ë¬¸:", orderDTO);
		    
		 	// ë“±ë¡ í•¨ìˆ˜ í˜¸ì¶œ(ì‹¤í—˜í•˜ê¸° ìœ„í•´ ë§‰ì•„ë‘ )
		    registerOrder(orderDTO);
		 	
		 	//í™”ë©´ ì´ˆê¸°í™” í•¨ìˆ˜
		 	//refreshOrderGrid();
		 	
		}

		
	    
		// ì£¼ë¬¸ ë“±ë¡ í•¨ìˆ˜
		function registerOrder(orderDTO) {
			const header = document.querySelector('meta[name="_csrf_header"]').content;
		    const token = document.querySelector('meta[name="_csrf"]').content;
			
		    fetch('/bsn/rest/order/insert', {
		        method: 'POST',
		        headers: {
		        	'header': header,
		        	'X-CSRF-Token': token,
		            'Content-Type': 'application/json'  // JSON í˜•ì‹ìœ¼ë¡œ ë³´ë‚´ê¸°
		        },
		        body: JSON.stringify(orderDTO)  // ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
		    })
		    .then(response => response.json())
		    .then(data => {
		        if (data.status === "success") {
		            showAlert('ì£¼ë¬¸ ë“±ë¡ ì„±ê³µ', 'success');
		         	// ê°’ ì´ˆê¸°í™” + ê°’ ì´ˆê¸°í™”
		            refreshOrderGrid();
		           
		        } else {
		            showAlert('ë°œì£¼ ë“±ë¡ ì‹¤íŒ¨:'+ data.message, 'danger');
		        }
		        //í…Œì´ë¸” ì´ˆê¸°í™”?

		    }) 
		}
		
		//ì·¨ì†Œ ì‚¬ìœ  ì…ë ¥ìš© ê°ì²´ ìƒì„±
		function createCancelRequest() {
			const cancelReasonInput = document.querySelector('#cancelReason');
		    const cancelReason = cancelReasonInput.value.trim(); // ê³µë°± ì œê±°

		    if (!cancelReason) { // ë¹ˆ ê°’ ì²´í¬
		        showAlert('ì·¨ì†Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'danger');
		        cancelReasonInput.focus(); // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
		        return null; // ìœ íš¨í•˜ì§€ ì•Šì€ ì…ë ¥ì´ë©´ null ë°˜í™˜
		    }
		    
		    return {
		        orderCode: selectedRow.orderCode, // ì„ íƒëœ ì£¼ë¬¸ ì½”ë“œ
		        orderCancelReason: cancelReason //cancelReasonInput.value
		    };
		}
		
		// ë°œì£¼ ì·¨ì†Œ í•¨ìˆ˜
		function cancelOrder(cancelRequest) {
			const header = document.querySelector('meta[name="_csrf_header"]').content;
		    const token = document.querySelector('meta[name="_csrf"]').content;
			
		    fetch('/bsn/rest/bhfOrder/cancel', {
		        method: 'POST',
		        headers: {
		        	'header': header,
		        	'X-CSRF-Token': token,
		            'Content-Type': 'application/json'  // JSON í˜•ì‹ìœ¼ë¡œ ë³´ë‚´ê¸°
		        },
		        body: JSON.stringify(cancelRequest)  // ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
		    })
		    .then(response => response.json())
		    .then(data => {
		        if (data.status === "success") {
		            showAlert('ë°œì£¼ ì·¨ì†Œ ì™„ë£Œ', 'success');
		         	// ê·¸ë¦¬ë“œ ì´ˆê¸°í™” + ê°’ ì´ˆê¸°í™”
		            refreshOrderGrid();
		            document.querySelector('#cancelReason').value = '';
		           
		        } else {
		            showAlert('ë°œì£¼ ì·¨ì†Œ ì‹¤íŒ¨:'+ data.message, 'danger');
		        }


		    }) 
		}

		// ëª¨ë‹¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
		const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
		const cancelModal = new bootstrap.Modal(document.getElementById('cancelModal'));

		// ì£¼ë¬¸ ì„ íƒ í™•ì¸ í•¨ìˆ˜
		function checkOrderSelection(modal) {
		    if (selectedRow && selectedRow.orderCode) {
		    	// ëª¨ë‹¬ì´ 'cancelModal'ì´ë©´ ë°œì£¼ ì½”ë“œ í‘œì‹œ
		        if (modal === cancelModal) {
		            document.getElementById("cancelOrderCode").textContent = selectedRow.orderCode;
		        }
		        modal.show();
		    } else {
		        showAlert('ì£¼ë¬¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'danger');
		    }
		}

		// ì£¼ë¬¸ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		document.getElementById('registerButton').addEventListener('click', () => {
		    checkOrderSelection(registerModal); // ë“±ë¡ ëª¨ë‹¬ ë„ìš°ê¸°
		});

		// ì£¼ë¬¸ ê±°ë¶€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		document.getElementById('cancelButton').addEventListener('click', () => {
		    checkOrderSelection(cancelModal); // ê±°ë¶€ ëª¨ë‹¬ ë„ìš°ê¸°
		});

		// ê³µí†µëœ ë²„íŠ¼ì„ ë‹¤ë£¨ë˜, ëª¨ë‹¬ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ ì„¤ì •
		document.querySelectorAll('.modal-footer #btn-register').forEach(button => {
		    button.addEventListener('click', () => {
		        if (selectedRow && selectedRow.orderCode) {
		            // í˜„ì¬ show í´ë˜ìŠ¤ê°€ ìˆëŠ” ëª¨ë‹¬ ì°¾ê¸°
		            const activeModal = document.querySelector('.modal.show');
		            
		            if (activeModal) {
		                if (activeModal.id === 'registerModal') {
		                    // ì£¼ë¬¸ ë“±ë¡ ì²˜ë¦¬
		                    loadAllOrderDetails(selectedRow.orderCode);
		                    registerModal.hide();
		                    
		                } else if (activeModal.id === 'cancelModal') {
		                	// ë°œì£¼ìš”ì²­ ì·¨ì†Œìš© ê°ì²´ ìƒì„±
		                    const cancelRequest = createCancelRequest();
		                    if (!cancelRequest) return; // ì·¨ì†Œ ì‚¬ìœ ê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
		                    //ë°œì£¼ìš”ì²­ ì·¨ì†Œ ì²˜ë¦¬
		                    cancelOrder(cancelRequest);
		                    //console.log(cancelRequest);
		                    cancelModal.hide();
		                }
		            }
		        } else {
		            showAlert('ì£¼ë¬¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'danger');
		        }
		    });
		});

		document.querySelectorAll('.modal-footer .btn-secondary').forEach(button => {
		    button.addEventListener('click', () => {
		        // í˜„ì¬ í™œì„±í™”ëœ ëª¨ë‹¬ ì°¾ê¸°
		        const activeModal = document.querySelector('.modal.show');

		        if (activeModal) {
		        	//console.log(activeModal);
		        	if (activeModal.id === 'registerModal') {
	                    // ì£¼ë¬¸ ë“±ë¡ ì²˜ë¦¬
	                    registerModal.hide();
	                } else if (activeModal.id === 'cancelModal') {
	                    // ë°œì£¼ ì·¨ì†Œ ì²˜ë¦¬ ë¡œì§
	                    document.querySelector('#cancelReason').value = '';
	                    cancelModal.hide();
	                }
		        }
		    });
		});





	  </script>



</body>

</html>