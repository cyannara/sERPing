
<body>

<style>
/* ìƒí’ˆëª… & ìƒí’ˆì½”ë“œ ë³‘í•©ëœ ì…€ ìŠ¤íƒ€ì¼ */

/* âœ… ì „ì²´ ê·¸ë¦¬ë“œì˜ ìŠ¤í¬ë¡¤ ì œê±° */
#productGrid {
    overflow: hidden !important; /* âœ… ìŠ¤í¬ë¡¤ ì œê±° */
    height: auto !important; /* âœ… ë†’ì´ ìë™ ì¡°ì • */
}

/* âœ… ë‚´ë¶€ ìš”ì†Œì—ì„œ ê°•ì œ ìŠ¤í¬ë¡¤ ì œê±° */
.tui-grid-body-area {
    overflow: hidden !important;
}

/* âœ… ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì—†ì• ê¸° */
.tui-grid-container {
    max-height: none !important;
}
.merged-cell {
    background-color: #f8f9fa !important; /* ì—°í•œ íšŒìƒ‰ */
    font-weight: bold;
    text-align: left;
    padding: 10px;
}

/* âœ… ê·¸ë¦¬ë“œ ì „ì²´ í…Œë‘ë¦¬ ì¶”ê°€ */
.tui-grid-container {
    border: 1px solid #ddd !important; /* ì „ì²´ ê·¸ë¦¬ë“œ ë°•ìŠ¤ í…Œë‘ë¦¬ */
    border-radius: 5px; /* ë‘¥ê·¼ í…Œë‘ë¦¬ */
    overflow: hidden; /* ëª¨ì„œë¦¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬ */
}

/* âœ… í—¤ë”(ì»¬ëŸ¼ëª…) ë¶€ë¶„ í…Œë‘ë¦¬ */
.tui-grid-header-area {
    border-bottom: 2px solid #ccc !important; /* í—¤ë”ì™€ ë°”ë”” êµ¬ë¶„ */
}

/* âœ… ì…€(Cell) í…Œë‘ë¦¬ ì„¤ì • */
.tui-grid-cell {
    border-right: 1px solid #ddd !important;
    border-bottom: 1px solid #ddd !important;
}

/* âœ… ë§ˆì§€ë§‰ ì»¬ëŸ¼ì˜ í…Œë‘ë¦¬ ì—†ì• ê¸° (ë””ìì¸ ê°œì„ ) */
.tui-grid-cell:last-child {
    border-right: none !important;
}

/* âœ… ë§ˆì§€ë§‰ í–‰ì˜ í…Œë‘ë¦¬ ì—†ì• ê¸° (ë””ìì¸ ê°œì„ ) */
.tui-grid-body-area .tui-grid-cell:last-child {
    border-bottom: none !important;
}

/* âœ… í—¤ë”(ì»¬ëŸ¼ëª…) ë°°ê²½ìƒ‰ & ê¸€ì”¨ ìŠ¤íƒ€ì¼ */
.tui-grid-header-cell {
    background-color: #f1f1f1 !important; /* í—¤ë” ë°°ê²½ìƒ‰ */
    font-weight: bold;
    text-align: center;
    border-right: 1px solid #ddd !important;
}

/* âœ… ì¤„ ê°„ê²© ìŠ¤íƒ€ì¼ ì¡°ì • */
.tui-grid-row {
    border-bottom: 1px solid #ddd !important;
}

/* âœ… hover(ë§ˆìš°ìŠ¤ ì˜¤ë²„) ì‹œ ê°•ì¡° íš¨ê³¼ */
.tui-grid-cell:hover {
    background-color: #f9f9f9 !important;
}

</style>
<!-- ê²€ìƒ‰ì°½ -->
<div class="search-grid" id="custom-container">
    <div class="d-flex flex-wrap align-items-center gap-3">
        <div class="d-flex align-items-center">
            <span class="label-search me-2">ìƒí’ˆëª…</span>
            <input type="text" name="goodsName" id="searchGoodsName" class="form-control w-auto">
        </div>
        <div class="d-flex align-items-center">
            <span class="label-search me-2">ë¸Œëœë“œëª…</span>
            <input type="text" name="brandName" id="searchBrandName" class="form-control w-auto">
        </div>
        <div class="d-flex align-items-center">
            <span class="label-search me-2">í‘œì‹œìˆ˜ëŸ‰</span>
            <select name="display_amount" id="product_display_amount" class="form-control w-auto" onchange="changeProductDisplay()">
                <option value="10" selected>10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <button type="button" class="btn btn-primary ms-auto" onclick="productSearch()">ê²€ìƒ‰</button>
        <button type="button" class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
    </div>
</div>

<!-- ê·¸ë¦¬ë“œ -->
<div id="table-container" class="mt-3">
    <div id="productGrid"></div>
    <div id="pagination" class="tui-pagination"></div>
</div>



<script>
document.addEventListener("DOMContentLoaded", function () {
    console.log("âœ… ìƒí’ˆ ì¡°íšŒ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨");
    initProductGrid();
    
    if (typeof productGrid !== 'undefined' && productGrid !== null) {
    	
        productGrid.on("click", function (ev) {
            console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ê·¸ë¦¬ë“œ ì…€ í´ë¦­ë¨:", ev);

            if (ev.rowKey !== null && ev.rowKey !== undefined) {
                const rowData = productGrid.getRow(ev.rowKey);
                console.log("ğŸ“¢ ì„ íƒí•œ í–‰ì˜ ë°ì´í„°:", rowData);

                // âœ… sessionStorageì— ì €ì¥ (ê° í‚¤ì— ëŒ€í•´ ì €ì¥)
                sessionStorage.setItem("selectedGoodsCode", rowData.goodsCode || '');
                sessionStorage.setItem("selectedGoodsName", rowData.goodsName || '');
                sessionStorage.setItem("selectedOptionCode", rowData.optionCode || '');
                sessionStorage.setItem("selectedOptionName", rowData.optionName || '');
                sessionStorage.setItem("selectedOptionNum", rowData.optionNum || '');
                sessionStorage.setItem("selectedVendorName", rowData.vendorName || '');
                sessionStorage.setItem("selectedVendorId", rowData.vendorId || '');
                sessionStorage.setItem("selectedGoodsStandard", rowData.goodsStandard || '');
                sessionStorage.setItem("selectedGoodsSupplyPrice", rowData.goodsSupplyPrice || '');

                console.log("âœ… ì €ì¥ëœ ë°ì´í„° í™•ì¸:");
                console.log("ğŸ“¢ ìƒí’ˆì½”ë“œ:", sessionStorage.getItem("selectedGoodsCode"));
                console.log("ğŸ“¢ ìƒí’ˆëª…:", sessionStorage.getItem("selectedGoodsName"));
                console.log("ğŸ“¢ ì˜µì…˜ì½”ë“œ:", sessionStorage.getItem("selectedOptionCode"));
                console.log("ğŸ“¢ ì˜µì…˜ëª…:", sessionStorage.getItem("selectedOptionName"));
                console.log("ğŸ“¢ ì˜µì…˜ë²ˆí˜¸:", sessionStorage.getItem("selectedOptionNum"));
                console.log("ğŸ“¢ ê±°ë˜ì²˜ëª…:", sessionStorage.getItem("selectedVendorName"));
                console.log("ğŸ“¢ ê±°ë˜ì²˜ë²ˆí˜¸:", sessionStorage.getItem("selectedVendorId"));
                console.log("ğŸ“¢ ê·œê²©:", sessionStorage.getItem("selectedGoodsStandard"));
                console.log("ğŸ“¢ ê³µê¸‰ê°€ê²©:", sessionStorage.getItem("selectedGoodsSupplyPrice"));
            } else {
                console.warn("âŒ rowKeyê°€ null ë˜ëŠ” undefined ì…ë‹ˆë‹¤.");
            }
        });
    } else {
        console.warn("âŒ productGridê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    }
    
    
});

let productGrid;

function initProductGrid() {
	
	console.log("initProductGrid()ì‹¤í–‰")

    const companyNum = [[${session.companyNum}]];
  

	if (!companyNum) {
        console.error("âŒ ì„¸ì…˜ì—ì„œ companyNum ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.");
        return; // companyNumì´ ì—†ìœ¼ë©´ ìš”ì²­ì„ í•˜ì§€ ì•ŠìŒ
    } 
    
    //const companyNum = 1;

    console.log("âœ… ì„¤ì •ëœ companyNum:", companyNum);

    const productDataSource = {
            api: {  
                readData: { 
                    url: '/purchs/rest/product/list', 
                    method: 'GET',
                    requestOptions: { // âœ… ëª…í™•í•œ ì˜µì…˜ ì¶”ê°€
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'same-origin' // âœ… CORS ë¬¸ì œ ë°©ì§€
                    },
                    initParams:{ 
                        page: 1,
                        perPage: 10,
                        companyNum: companyNum
                    },
                    beforeRequest: function(request) {
                        console.log("ğŸ“¢ ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ê¸° ì „ requestParams:", request.params);
                    },
                    afterResponse: function(response) {
                        console.log("ğŸ“¢ ì„œë²„ ì‘ë‹µ:", response);

                        if (response.data && response.data.contents) {
                            console.log("âœ… ë³€í™˜ëœ ë°ì´í„°:", response.data.contents);
                            return { data: response.data.contents, totalCount: response.data.pagination.totalCount };
                        }

                        console.warn("âš ï¸ ì„œë²„ ì‘ë‹µì— contentsê°€ ì—†ìŠµë‹ˆë‹¤.");
                        return { data: [], totalCount: 0 };
                    }

                }
            },
            contentType: 'application/json',
            serverSidePagination: true
        };
        
        console.log("âœ… productDataSource ì„¤ì • ì™„ë£Œ:", productDataSource);

        productGrid = new tui.Grid({
            el: document.getElementById('productGrid'),
            data: productDataSource,  
            pageOptions: {
                useClient: false,
                perPage: 10,
            },
            bodyHeight: 'auto', 
            columns: [
                { header: "ìƒí’ˆëª…", 
                  name: "goodsName", 
                  rowSpan: true,
                  renderer: {
                      type: CustomTextRenderer
                  },
                  className: "merged-cell"
                  },
                { header: "ìƒí’ˆì½”ë“œ", 
                  name: "goodsCode", 
                  rowSpan: true,
                  renderer: {
                      type: CustomTextRenderer
                  },
                  className: "merged-cell"
                  }, 
                { header: "ì˜µì…˜ëª…", name: "optionName" },
                { header: "ì˜µì…˜ë²ˆí˜¸", name: "optionCode" },
                { header: "ë¸Œëœë“œ", name: "brandName" },
                { header: "ê·œê²©", name: "goodsStandard"}
               
            ],
            rowClassName: function(row) {
                return getRowColorClass(row);
            }
        });
        
        console.log("âœ… Toast Grid ì´ˆê¸°í™” ì™„ë£Œ");
        
        // âœ… ìƒí’ˆ ì„ íƒ ì‹œ sessionStorageì— ì €ì¥
        productGrid.on('click', function (ev) {
            const rowData = productGrid.getRow(ev.rowKey);
            ["goodsCode", "goodsName", "optionCode", "optionName", "vendorName", "goodsStandard"].forEach(key => {
                sessionStorage.setItem(`selected${key}`, rowData[key]);
            });
        });

}

// í‘œì‹œ ìˆ˜ëŸ‰ ë³€ê²½
function changeProductDisplay() {
    let gap = parseInt(document.querySelector('#product_display_amount').value);
    productGrid.setPerPage(gap);
    productGrid.reloadData();
}

// ê²€ìƒ‰ ì‹¤í–‰
function productSearch() {
    let goodsName = document.querySelector('#searchGoodsName').value;
    let brandName = document.querySelector('#searchBrandName').value;

    productGrid.setRequestParams({
        "companyNum": [[${session.companyNum}]],
        "goodsName": goodsName,
        "brandName": brandName
    });

    productGrid.reloadData();
}

// í•„í„° ì´ˆê¸°í™”
function resetFilters() {
    document.querySelector('#searchGoodsName').value = '';
    document.querySelector('#searchBrandName').value = '';
    document.querySelector('#product_display_amount').value = '10';

    productGrid.setRequestParams({
        "companyNum": companyNum,
        "goodsName": '',
        "brandName": ''
    });

    productGrid.reloadData();
}

//âœ… í…ìŠ¤íŠ¸ë¥¼ êµµê²Œí•˜ê³  ì •ë ¬í•˜ëŠ” ë Œë”ëŸ¬
class CustomTextRenderer {
    constructor(props) {
        const el = document.createElement('div');
        el.innerText = props.value;
        el.style.padding = '10px';
        el.style.fontWeight = 'bold';
        el.style.textAlign = 'left';
        this.el = el;
    }
    getElement() {
        return this.el;
    }
}



</script>


</body>




