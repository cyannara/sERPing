<!DOCTYPE html>
<html layout:decorate="~{layouts/layout}"
      lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ë°œì£¼ì„œ / ë°œì£¼ì„œ ë“±ë¡</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Toast Grid CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.grid/latest/tui-grid.css">
    
    <!-- jQuery & Toast Grid JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://uicdn.toast.com/tui.grid/latest/tui-grid.js"></script>

    <style>
        .form-control { width: 100%; }
        
        .button-container { margin-top: 15px; }
        #custom-container{
		background-color: #f8f9fa; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
		padding: 20px;
		border-radius: 10px;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* ë°•ìŠ¤ ê·¸ë¦¼ì */
		margin-bottom: 20px;
	
		}
        #grid { height: 300px; }
    </style>
</head>
<body layout:fragment="content">
<div class="container mt-4" >
<h2 class="mb-4">ë°œì£¼ì„œ ë“±ë¡</h2>
	<div class="container">
	    <!-- ğŸ”¹ ë°œì£¼ì„œ ì •ë³´ -->
	    <div id="custom-container">
	        <div class="row g-3">
	            <div class="col-md-3">
	                <label class="form-label">ì¼ì</label>
	               <input type="date" class="form-control" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" readonly>
	            </div>
	            <div class="col-md-3">
	                <label class="form-label">ë‹´ë‹¹ì</label>
	                <input type="text" class="form-control" th:value="${session.employeeName}" readonly>
	            </div>
	            <div class="col-md-3">
	                <label class="form-label">ë‚©ê¸°ì¼ì</label>
	                <input type="date" class="form-control" th:value="${PurchaseDTO.puchaseDueDate}">
	            </div>
	        </div>
	
	        <!-- ğŸ”¹ ë¶€ê°€ì„¸ìœ¨(VAT) ì„ íƒ -->
	        <div class="d-flex align-items-center mt-3">
	            <div class="form-check me-3">
	                <input class="form-check-input" type="checkbox" id="vatUnchecked">
	                <label class="form-check-label" for="vatUnchecked">ë¶€ê°€ì„¸ìœ¨(VAT) ë¯¸ì ìš©</label>
	            </div>
	            <div class="form-check">
	                <input class="form-check-input" type="checkbox" id="vatChecked" checked>
	                <label class="form-check-label" for="vatChecked">ë¶€ê°€ì„¸ìœ¨(VAT) ì ìš©</label>
	            </div>
	        </div>
	    </div>
	
	    <!-- ğŸ”¹ ë²„íŠ¼ -->
	    <div class="mb-3 d-flex justify-content-between">
	        <div>
	            <button class="btn btn-secondary">ì£¼ë¬¸ì„œ ì¡°íšŒ</button>
	            <button class="btn btn-secondary">ì¬ê³  ì¡°íšŒ</button>
	            <button class="btn btn-secondary">ê³„íš ì¡°íšŒ</button>
	        </div>
	        <button class="btn btn-primary" id="bttAdd">ë°œì£¼ ì¶”ê°€</button>
	    </div>
	
	    <!-- ğŸ”¹ Toast Grid -->
	    <div id="grid"></div>
	    <div id="pagination" class="tui-pagination"></div>
        
	 
	    <!-- ğŸ”¹ ì €ì¥ ë° ì´ˆê¸°í™” ë²„íŠ¼ -->
	    <div class="button-container text-center mt-3">
	        <button class="btn btn-success">ì €ì¥</button>
	        <button class="btn btn-secondary">ì´ˆê¸°í™”</button>
	    </div>
	</div>
	
</div>


<script>

let grid;
const header = document.querySelector('meta[name="_csrf_header"]').content;
const token = document.querySelector('meta[name="_csrf"]').content;

document.addEventListener("DOMContentLoaded", function(){
	
	var Grid = tui.Grid;
	const dataSource = [];
	  // Toast Grid ë°ì´í„° ì„¤ì •
  	grid = new Grid({
        el: document.getElementById('grid'),
       
        columns: [
       
            { header: 'ìƒí’ˆì½”ë“œ', name: 'goodsCode' },
            { header: 'ìƒí’ˆëª…', name: 'goodsName' },
            { header: 'ì˜µì…˜ì½”ë“œ', name: 'optionCode'},
            { header: 'ì˜µì…˜ëª…', name: 'optionName'},
            { header: 'ê±°ë˜ì²˜ëª…', name: 'vendorName'},
            { header: 'ê·œê²©', name: 'goodsStandard'},
            { header: 'ìˆ˜ëŸ‰', name: 'puchaseQuantity'},
            { header: 'ë‹¨ê°€', name: 'puchaseUnitPrice'},
            { header: 'ê³µê¸‰ê°€ê²©', name: 'puchaseSupplyPrice'},
            { header: 'ë¶€ê°€ì„¸', name: 'puchaseVat'}
        ],
        rowHeaders: ['checkbox'],
        data : dataSource,
        scrollX: true,
        scrollY: 300
    });
    
    const bttAdd = document.getElementById("bttAdd");
    
    bttAdd.addEventListener("click", function () {
       grid.appendRow({}, { at: 0 }); // ë¹ˆ í–‰ ì¶”ê°€
    });
    
 	/* //ìƒí’ˆ ì„ íƒ ì‹œ ì ìš©ë  ë°ì´í„° ì˜ˆì‹œ
    function onProductSelect(selectedProduct) {
        // í˜„ì¬ ì„ íƒëœ rowKey ê°€ì ¸ì˜¤ê¸°
        const rowKey = grid.getFocusedCell().rowKey;
        
        if (rowKey === null) {
            alert("í–‰ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!");
            return;
        }

        // ì„ íƒëœ ìƒí’ˆ ì •ë³´ë¥¼ ì—¬ëŸ¬ ì¹¸(column)ì— ì ìš©
        grid.setValue(rowKey, "goodsCode", selectedProduct.goodsCode);
        grid.setValue(rowKey, "goodsName", selectedProduct.goodsName);
        grid.setValue(rowKey, "optionCode", selectedProduct.optionCode);
        grid.setValue(rowKey, "optionName", selectedProduct.optionName);
        grid.setValue(rowKey, "vendorName", selectedProduct.vendorName);
        grid.setValue(rowKey, "goodsStandard", selectedProduct.goodsStandard);
        grid.setValue(rowKey, "goodsPrice", selectedProduct.goodsPrice);
        grid.setValue(rowKey, "goodsSupplyPrice", selectedProduct.goodsSupplyPrice);
    }
 	
    //ìƒí’ˆ ë° ì˜µì…˜ ì¹¸ í´ë¦­ í•˜ë©´ ì •ë³´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì¶œë ¥ 
    grid.on("click", (ev) => {
    if (ev.columnName === "goodsName" || ev.columnName === "goodsCode" || ev.columnName === "optionName" || ev.columnName === "optionCode") {
        openProductModal(ev.rowKey);
	    }
	});
	
    //ëª¨ë‹¬ì´ ì—´ë¦° í›„ ì‘ì—… 
    function openProductModal(rowKey){
    	 sessionStorage.setItem("selectedRowKey", rowKey);
    	 let selectedRowKey = parseInt(sessionStorage.getItem("selectedRowKey"), 10);
    	 
    	 

    	    // ëª¨ë‹¬ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    	    const modalElement = document.getElementById('goodsModal');
    	    if (!modalElement) {
    	        console.error("warehouseModal ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    	        return;
    	    }
    	    

    	    // ì°½ê³  ê·¸ë¦¬ë“œê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„ ë°ì´í„° ê°±ì‹ 
    	    if (typeof productGrid !== 'undefined' && productGrid !== null) {
    	        console.log("ğŸ“¢ ì°½ê³  ëª¨ë‹¬: ë°ì´í„° ì´ˆê¸°í™” ë° ìƒˆë¡œê³ ì¹¨ ì‹œì‘");
    	
    	        // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
    	    
    	        let Data = productGrid.getData();
    	        console.log("ê·¸ë¦¬ë“œë°ì´í„°",Data)
    	        console.log(bootstrap.Version);

    	        
    	        productGrid.readData();
    	        
    	        setTimeout(() => {
    	        	productGrid.refreshLayout();  // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
    	        	
    			}, 500);
   

    	        // ë°ì´í„°ë¥¼ ë‹¤ ë¶ˆëŸ¬ì˜¨ í›„ ëª¨ë‹¬ ì—´ê¸° (onGridUpdated ì´ë²¤íŠ¸ í™œìš©)
    	         productGrid.on("onGridUpdated", function () {
    	            console.log("ì°½ê³  ëª¨ë‹¬: ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ");
    	            

    	            // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ëª¨ë‹¬ ì—´ê¸°
    	            const modalInstance = new bootstrap.Modal(modalElement);
    	            modalInstance.show(); // ëª¨ë‹¬ ì—´ê¸°
    	            
    	            
    	            console.log("ì°½ê³  ëª¨ë‹¬ ì—´ë¦¼:", rowKey);
    	        }); 
    	    } else {
    	        console.warn("warehouseGridê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
    	    } 
    }
    
  */
    
})

  
</script>

</body>
</html>