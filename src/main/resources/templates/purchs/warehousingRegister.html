<html layout:decorate="~{layouts/layout}"
      lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
 
 <head>

<style>
        /* âœ… ê³µí†µ ìŠ¤íƒ€ì¼ */
        .container { max-width: 1200px; margin: auto; }
        .section-box { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .section-title { font-weight: bold; margin-bottom: 10px; }

        

        
    </style>
 	
 </head>     
<body layout:fragment="content">
<div class="container mt-4">
    <h2>ì œí’ˆêµ¬ë§¤ / êµ¬ë§¤ ë“±ë¡</h2>
    
    <!-- âœ… ìƒë‹¨: ë°œì£¼ ê²€ìƒ‰ (ì‘ê²Œ) & ë°œì£¼ì„œ ëª©ë¡ (ë„“ê²Œ) -->
    <div class="row">
        <!-- âœ… ë°œì£¼ì„œ ì¡°íšŒ ë°•ìŠ¤ í¬ê¸° ì¤„ì´ê¸° -->
        <div class="col-md-4">
            <div class="section-box">
                <h4 class="section-title">ë°œì£¼ì„œ ì¡°íšŒ</h4>
                <div class="row g-2 align-items-center">
                    <div class="col-6">
                        <label for="searchPurchaseNum" class="form-label">ë°œì£¼ë²ˆí˜¸</label>
                        <input type="text" id="searchPurchaseNum" class="form-control" placeholder="ë°œì£¼ë²ˆí˜¸ ì…ë ¥">
                    </div>
                    <div class="col-6">
                        <label for="searchVendorName" class="form-label">ê±°ë˜ì²˜ëª…</label>
                        <input type="text" id="searchVendorName" class="form-control">
                    </div>
                    <div class="col-12">
                        <label class="form-label">ë°œì£¼ì¼ì</label>
                        <div class="input-group">
                            <input type="date" id="searchStartDate" class="form-control">
                            <span class="input-group-text">~</span>
                            <input type="date" id="searchEndDate" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-end">
                    <button type="button" class="btn btn-primary" onclick="purchaseSearch()">ê²€ìƒ‰</button>
                    <button type="button" class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <!-- âœ… ë°œì£¼ì„œ ëª©ë¡ ê·¸ë¦¬ë“œ ë„“ê²Œ ë°°ì¹˜ -->
        <div class="col-md-8">
            <div class="section-box">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="section-title mb-0">ë°œì£¼ì„œ ëª©ë¡</h4>
                    <div class="d-flex align-items-center">
                        <label for="purchase_display_amount" class="form-label me-2 mb-0" style="font-size: 14px;">í‘œì‹œ ìˆ˜ëŸ‰</label>
                        <select id="purchase_display_amount" class="form-select form-select-sm" onchange="changeProductDisplay()" style="width: 80px;">
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
                <div id="purchaselistGrid"></div>
                <div id="pagination" class="tui-pagination mt-3"></div>
                <button type="button" class="btn btn-primary" id="addwarehousinglist" onclick="moveToPurchaseDetail()">êµ¬ë§¤ë¦¬ìŠ¤íŠ¸ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <!-- âœ… í•˜ë‹¨: êµ¬ë§¤ ì •ë³´ ì…ë ¥ & êµ¬ë§¤ ìƒì„¸ ë¦¬ìŠ¤íŠ¸ -->
    
    <!-- âœ… êµ¬ë§¤ ì •ë³´ ì…ë ¥ -->
	<div class="section-box mt-3">
	    <h4 class="section-title">êµ¬ë§¤ ì •ë³´ ì…ë ¥</h4>
	    <div class="d-flex flex-wrap gap-3">
	        <div class="flex-grow-1">
	            <label for="purchaseDate" class="form-label">ì¼ì</label>
	            <input type="date" id="purchaseDate" class="form-control" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" readonly>
	        </div>
	        <div class="flex-grow-1">
	            <label for="responsiblePerson" class="form-label">ë‹´ë‹¹ì</label>
	            <input type="text" id="employeeName" name="employeeName" class="form-control" th:value="${session.employeeName}" readonly>
	        </div>
	        <div class="flex-grow-1">
	            <label for="warehouse" class="form-label">ì…ê³ ì°½ê³ </label>
	            <input type="text" id="warehouseName" name="warehouseName" class="form-control" data-bs-toggle="modal" data-bs-target="#warehouseModal">
	            <input type="hidden" id="warehouseId" name="warehouseId">
	        </div>
	          <!--  ì°½ê³  ëª¨ë‹¬ -->
			    <div th:include="purchs/ModalTemplate :: ModalTemplate (
			    'warehouseModal', 
			    'modal-xl', 
			    'ì°½ê³  ì¡°íšŒ', 
			    'purchs/warehouseTable', 
			    'purchs/warehouseFooter'
			    )"></div>
	        <div class="flex-grow-1">
	            <label for="manufactureDate" class="form-label">ì œì¡°ì¼ì</label>
	            <input type="date" id="manufactureDate" class="form-control">
	        </div>
	    </div>
	    
	    <!-- âœ… ë¶€ê°€ì„¸ ì²´í¬ë°•ìŠ¤: ì•„ë˜ ë³„ë„ ë°°ì¹˜ -->
	    <div class="mt-3">
	        <input type="checkbox" id="vatUnchecked"> ë¶€ê°€ì„¸ìœ¨(VAT) ë¯¸ì ìš©
	        <input type="checkbox" id="vatChecked"> ë¶€ê°€ì„¸ìœ¨(VAT) ì ìš©
	    </div>
	</div>

    <div class="section-box mt-3">
        <h4 class="section-title">êµ¬ë§¤ ìƒì„¸ ë¦¬ìŠ¤íŠ¸</h4>
        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-primary btn-custom" id="bttAdd">ì˜µì…˜ ì¶”ê°€</button>
        </div>
        <div id="warehousinglistGrid"></div>
    </div>
    
    	 
	<!-- ìƒí’ˆ ëª¨ë‹¬ -->
	 <div th:include="purchs/ModalTemplate :: ModalTemplate (
	  'goodsModal', 
	  'modal-xl', 
	  'ìƒí’ˆ ì¡°íšŒ', 
	  'purchs/goodsTable', 
	  'purchs/brandFooter'
	  )"></div> 

    <div class="text-center mt-4">
        <button type="button" class="btn btn-primary">ë“±ë¡</button>
        <button type="button" class="btn btn-secondary">ì´ˆê¸°í™”</button>
    </div>
</div>


<script>

	
  // ì»¤ìŠ¤í…€ ë Œë”ëŸ¬ í´ë˜ìŠ¤ ì •ì˜ (ìµœìƒë‹¨)
  class CustomTextRenderer {
      constructor(props) {
          const el = document.createElement('div');
          el.innerText = props.value;
          el.style.padding = '10px';
          el.style.fontWeight = 'bold';
          el.style.textAlign = 'left';
          this.el = el;
      }
      getElement() {
          return this.el;
      }
  }
  
	//âœ… ì‚­ì œ ë²„íŠ¼ ë Œë”ëŸ¬ (ì „ì—­ìœ¼ë¡œ ì´ë™)
	  class DeleteRenderer {
	      constructor(props) {
	          const el = document.createElement("button");
	          el.textContent = "ì‚­ì œ";
	          el.className = "btnDelete btn btn-danger btn-sm";
	          el.addEventListener("click", () => {
	              // âœ… ì˜¬ë°”ë¥¸ ê·¸ë¦¬ë“œ ê°ì²´ì—ì„œ í•´ë‹¹ í–‰ ì‚­ì œ
	              warehousinglistGrid.removeRow(props.rowKey);
	          });
	          this.el = el;
	      }
	      getElement() {
	          return this.el;
	      }
	  }
	
  let purchaselistGrid; 
  let warehousinglistGrid; // âœ… ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
  let header = document.querySelector('meta[name="_csrf_header"]').content;
  let token = document.querySelector('meta[name="_csrf"]').content;
  // í˜ì´ì§€ ë¡œë“œ í›„ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
  document.addEventListener("DOMContentLoaded", function () {
      console.log("âœ… ë°œì£¼ì„œ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”");
      initPurchaseGrid();
      initWarehouseModal(); // âœ… ì°½ê³  ëª¨ë‹¬ ì´ˆê¸°í™” ì¶”ê°€
     
   
      
   // âœ… êµ¬ë§¤ë¦¬ìŠ¤íŠ¸ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
      //document.querySelector("#addwarehousinglist").addEventListener("click", moveToPurchaseDetail);
  });

  

  function initPurchaseGrid() {
      const companyNum = [[${session.companyNum}]];
      if (!companyNum) {
          console.error("âŒ ì„¸ì…˜ì—ì„œ companyNum ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.");
          return;
      }
      const purchaselistDataSource = {
          api: {
              readData: {
                  url: '/purchs/rest/nonwarehousing/list',
                  method: 'GET',
                  requestOptions: {
                      headers: { 'Content-Type': 'application/json' },
                      credentials: 'same-origin'
                  },
                  initParams: {
                      page: 1,
                      perPage: 10,
                      companyNum: companyNum
                  },
                  beforeRequest: function(request) {
                      console.log("ğŸ“¢ ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ê¸° ì „ requestParams:", request.params);
                  },
                  afterResponse: function(response) {
                      console.log("ğŸ“¢ ì„œë²„ ì‘ë‹µ:", response);
                      if (response.data && response.data.contents) {
                          console.log("âœ… ë³€í™˜ëœ ë°ì´í„°:", response.data.contents);
                          return { data: response.data.contents, totalCount: response.data.pagination.totalCount };
                      }
                      console.warn("âš ï¸ ì„œë²„ ì‘ë‹µì— contentsê°€ ì—†ìŠµë‹ˆë‹¤.");
                      return { data: [], totalCount: 0 };
                  }
              }
          },
          contentType: 'application/json',
          serverSidePagination: true
      };

      purchaselistGrid = new tui.Grid({
          el: document.getElementById('purchaselistGrid'),
          data: purchaselistDataSource,
          pageOptions: {
              useClient: false,
              perPage: 10
          },
          bodyHeight: 'auto',
          scrollX :false,
          scrollY : false,
          rowHeaders: ['checkbox'], 
          columns: [
              { header: "ë°œì£¼ë²ˆí˜¸", name: "purchaseNum", rowSpan: true, renderer: { type: CustomTextRenderer } },
              { header: "ê±°ë˜ì²˜ëª…", name: "vendorName" },
              { header: "ìƒí’ˆëª…", name: "goodsName" },
              { header: "ì˜µì…˜ëª…", name: "optionName" },
              { header: "ë°œì£¼ìˆ˜", name: "purchaseQuantity" },
              { header: "ë¯¸ì…ê³ ìˆ˜", name: "nonWarehousingNum" },
          ]
      });

      console.log("âœ… Toast Grid ì´ˆê¸°í™” ì™„ë£Œ");
  }

  // 3. ê¸°íƒ€ í•¨ìˆ˜ë“¤ (ê²€ìƒ‰, í•„í„° ì´ˆê¸°í™”, í‘œì‹œ ìˆ˜ëŸ‰ ë³€ê²½ ë“±)
  function purchaseSearch() {
      let purchaseNum = document.querySelector('#searchPurchaseNum').value.trim();
      let vendorName = document.querySelector('#searchVendorName').value.trim();
      let startDate = document.querySelector('#searchStartDate').value;
      let endDate = document.querySelector('#searchEndDate').value;
      purchaselistGrid.setRequestParams({
          "companyNum": [[${session.companyNum}]],
          "vendorName" : vendorName,
          "purchaseNum": purchaseNum,
          "startDate": startDate,
          "endDate": endDate
      });
      purchaselistGrid.reloadData();
  }

  function changeProductDisplay() {
      let gap = parseInt(document.querySelector('#purchase_display_amount').value);
      purchaselistGrid.setPerPage(gap);
      purchaselistGrid.reloadData();
  }

  function resetFilters() {
      document.querySelector('#searchPurchaseNum').value = '';
      document.querySelector('#searchVendorName').value = '';
      document.querySelector('#searchStartDate').value = '';
      document.querySelector('#searchEndDate').value = '';
      document.querySelector('#purchase_display_amount').value = '';
      purchaselistGrid.setRequestParams({
          "companyNum": companyNum,
          "vendorName" : vendorName,
          "purchaseNum": '',
          "startDate": '',
          "endDate": ''
      });
      purchaselistGrid.reloadData();
  }
  
  //êµ¬ë§¤ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ 
  function initwarehousingGrid(){

		 warehousinglistGrid = new tui.Grid({
          el: document.getElementById('warehousinglistGrid'),
          data: [],
          
          bodyHeight: 'auto',
          scrollX :false,
          scrollY : false,
          rowHeaders: ['checkbox'], 
          columns: [
              { header: "ìƒí’ˆì½”ë“œ", name: "goodsCode"},
              { header: "ë°œì£¼ì„œë²ˆí˜¸", name: "purchaseBodyNum" ,hidden: true},
              { header: "ìƒí’ˆëª…", name: "goodsName" },
              { header: "ì˜µì…˜ì½”ë“œ", name: "optionCode" },
              { header: "ì˜µì…˜ëª…", name: "optionName" },
              { header: "ì˜µì…˜ë²ˆí˜¸", name: "optionNum" },
              { header: "ê±°ë˜ì²˜ëª…", name: "vendorName" },
              { header: "ê±°ë˜ì²˜ë²ˆí˜¸", name: "vendorId" ,hidden: true},
              { header: "ê·œê²©", name: "goodsStandard" },
              { header: "ìˆ˜ëŸ‰", name: "purchaseQuantity", editor: "text" },
              { header: "ë‹¨ê°€", name: "purchaseUnitPrice" },
              { header: "ê³µê¸‰ê°€ì•¡", name: "purchaseSupplyPrice" },
              { header: "ë¶€ê°€ì„¸", name: "purchaseVat" },
              {
                  header : "ì‚­ì œ"
                  ,name: "delete"
                  ,renderer: {
                  type: DeleteRenderer // ì‚­ì œë²„íŠ¼ ì •ì˜ ë Œë”ëŸ¬
                  }  
                  ,cellStyle: { textAlign: "center" }
                  ,className: "tui-grid-cell-readonly"
              }
  
              
          ]
      });
		 
	      const bttAdd = document.getElementById("bttAdd");
	 	 // í–‰ì¶”ê°€
	         bttAdd.addEventListener("click", function () {
	         	warehousinglistGrid.appendRow({}, { at: 0 }); // ë¹ˆ í–‰ ì¶”ê°€
	         });
	 	 
	      //ìƒí’ˆ ë° ì˜µì…˜ ì¹¸ í´ë¦­ í•˜ë©´ ì •ë³´ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ì¶œë ¥ 
	   	  window.purchaseGrid.on("click", (ev) => {
	   	    if (ev.columnName === "goodsName" || ev.columnName === "goodsCode" || ev.columnName === "optionName" || ev.columnName === "optionCode") {
	   	        openGoodsModal(ev.rowKey);
	   		    }
	   	});
  }

  function initWarehouseModal() {
	    console.log("âœ… ì°½ê³  ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”");

	    const modalElement = document.getElementById("warehouseModal");

	    if (!modalElement) {
	        console.error("âŒ warehouseModal ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	        return;
	    }

	    modalElement.addEventListener("shown.bs.modal", function () {
	        console.log("ğŸ“¢ ì°½ê³  ëª¨ë‹¬ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰");

	        if (typeof warehouseGrid !== "undefined" && warehouseGrid !== null) {
	            console.log("ğŸ“¢ ì°½ê³  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
	            warehouseGrid.readData(); // ğŸš€ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
	            warehouseGrid.refreshLayout();
	        } else {
	            console.warn("âŒ warehouseGridê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ˆê¸°í™” ì‹œë„");
	            initWarehouseGrid(); // ğŸš€ ê·¸ë¦¬ë“œ ì¬ì´ˆê¸°í™”
	        }
	    });

	    // ì°½ê³  ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (table row í´ë¦­)
	    document.addEventListener("click", function (event) {
	        const selectedRow = event.target.closest("tr.select-warehouse"); // âœ… ê°€ì¥ ê°€ê¹Œìš´ `tr.select-warehouse` ì°¾ê¸°

	        if (selectedRow) {
	            const warehouseId = selectedRow.getAttribute("data-id");
	            const warehouseName = selectedRow.getAttribute("data-name");

	            if (warehouseId && warehouseName) {
	                console.log(`âœ… ì„ íƒí•œ ì°½ê³ : ID=${warehouseId}, ì´ë¦„=${warehouseName}`);

	                // âœ… ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
	                sessionStorage.setItem("selectedWarehouseId", warehouseId);
	                sessionStorage.setItem("selectedWarehouseName", warehouseName);

	                // âœ… ì…ë ¥ í•„ë“œì— ê°’ ì„¤ì •
	                document.getElementById("warehouseId").value = warehouseId;
	                document.getElementById("warehouseName").value = warehouseName;

	                // âœ… ëª¨ë‹¬ ë‹«ê¸°
	                const modalInstance = bootstrap.Modal.getInstance(modalElement);
	                if (modalInstance) {
	                    modalInstance.hide();
	                }
	            } else {
	                console.warn("âŒ ì°½ê³  ID ë˜ëŠ” ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	            }
	        }
	    });

	    // ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
	    modalElement.addEventListener("hidden.bs.modal", function () {
	        console.log("ğŸ“¢ ì°½ê³  ëª¨ë‹¬ì´ ë‹«í˜”ìŠµë‹ˆë‹¤. ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ");

	        const selectedWarehouseId = sessionStorage.getItem("selectedWarehouseId");
	        const selectedWarehouseName = sessionStorage.getItem("selectedWarehouseName");

	        if (selectedWarehouseId && selectedWarehouseName) {
	            console.log(`ğŸ“¢ ì €ì¥ëœ ë°ì´í„° ì ìš©: ID=${selectedWarehouseId}, ì´ë¦„=${selectedWarehouseName}`);

	            // âœ… input ë°•ìŠ¤ì— ê°’ ìë™ ë°˜ì˜
	            document.getElementById("warehouseId").value = selectedWarehouseId;
	            document.getElementById("warehouseName").value = selectedWarehouseName;

	            // âœ… ì €ì¥ëœ ê°’ ì œê±° (í•œ ë²ˆ ì ìš© í›„ ì‚­ì œ)
	            sessionStorage.removeItem("selectedWarehouseId");
	            sessionStorage.removeItem("selectedWarehouseName");
	        }
	    });
	}
  

  
//âœ… êµ¬ë§¤ë¦¬ìŠ¤íŠ¸ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ì²´í¬ëœ ë°œì£¼ì„œ ë°ì´í„°ë¥¼ êµ¬ë§¤ ìƒì„¸ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™

	function moveToPurchaseDetail() {
	    console.log("ğŸ“¢ êµ¬ë§¤ë¦¬ìŠ¤íŠ¸ì¶”ê°€ ë²„íŠ¼ í´ë¦­ë¨");
	
	    // âœ… ë°œì£¼ì„œ ëª©ë¡ì—ì„œ ì²´í¬ëœ í•­ëª© ê°€ì ¸ì˜¤ê¸°
	    let checkedRows = purchaselistGrid.getCheckedRows();
	
	    if (checkedRows.length === 0) {
	    	showAlert('ì´ë™í•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.', 'danger');
	        return;
	    }
	
	    console.log("âœ… ì„ íƒëœ í–‰ ë°ì´í„°:", checkedRows);
	    
	    
	
	    // âœ… `warehousinglistGrid`ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ˆê¸°í™”
	    if (warehousinglistGrid === null) {
	        console.warn("âŒ `warehousinglistGrid`ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ˆê¸°í™” ì‹œë„!");
	        initwarehousingGrid();  // âœ… ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
	    }
	
	    if (warehousinglistGrid === null) {
	        console.error("âŒ `warehousinglistGrid` ì´ˆê¸°í™” ì‹¤íŒ¨!");
	        return;
	    }
	
	    // âœ… ì„ íƒëœ ë°ì´í„° êµ¬ë§¤ ìƒì„¸ ë¦¬ìŠ¤íŠ¸(warehousinglistGrid)ì— ì¶”ê°€
	    checkedRows.forEach(row => {
	        warehousinglistGrid.appendRow({
	            goodsCode: row.goodsCode || "", // ìƒí’ˆì½”ë“œ
	            goodsName: row.goodsName || "", // ìƒí’ˆëª…
	            purchaseBodyNum : row.purchaseBodyNum || "",
	            optionCode: row.optionCode || "", // ì˜µì…˜ì½”ë“œ
	            optionName: row.optionName || "", // ì˜µì…˜ëª…
	            optionNum : row.optionNum ,
	            vendorName: row.vendorName || "", // ê±°ë˜ì²˜ëª…
	            vendorId: row.vendorId || "", // ê±°ë˜ì²˜ë²ˆí˜¸ (hidden)
	            goodsStandard: row.goodsStandard || "", // ê·œê²©
	            purchaseQuantity: row.nonWarehousingNum || 1, // ìˆ˜ëŸ‰ (ê¸°ë³¸ê°’ 1)
	            purchaseUnitPrice: row.purchaseUnitPrice || 0, // ë‹¨ê°€
	            purchaseSupplyPrice: row.purchaseSupplyPrice || 0, // ê³µê¸‰ê°€ì•¡
	            purchaseVat: row.purchaseVat || 0, // ë¶€ê°€ì„¸
	        });
	    });
	
	    console.log("âœ… êµ¬ë§¤ ìƒì„¸ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ ì™„ë£Œ");
	    
  
	}
	
//ìƒí’ˆ ëª¨ë‹¬ ì‘ì—… 
// âœ… ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
	function openGoodsModal(rowKey) {
	    console.log("ğŸ“¢ ì„ íƒí•œ í–‰(rowKey):", rowKey);
	
	    const modalElement = document.getElementById('goodsModal');
	    if (!modalElement) {
	        console.error("âŒ ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	        return;
	    }
	
	    if (typeof productGrid !== 'undefined' && productGrid !== null) {
	        console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ê·¸ë¦¬ë“œ ë°ì´í„° ê°±ì‹  ì‹œì‘");
	
	        // ë°ì´í„°ë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¨ í›„, ëª¨ë‹¬ì„ í‘œì‹œ
	        productGrid.readData();
	        
	        // âœ… ë°ì´í„° ê°±ì‹  í›„ ëª¨ë‹¬ì„ í‘œì‹œí•˜ë„ë¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
	        productGrid.on("onGridUpdated", function () {
	            console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ê·¸ë¦¬ë“œ ë°ì´í„° ê°±ì‹  ì™„ë£Œ");
	            
	            // âœ… ëª¨ë‹¬ í‘œì‹œ
	            const modalInstance = new bootstrap.Modal(modalElement);
	            modalInstance.show();
	            console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ëª¨ë‹¬ ì—´ë¦¼:", rowKey);
	
	            // âœ… ë°ì´í„° ë°˜ì˜ í›„ ë ˆì´ì•„ì›ƒ ìƒˆë¡œê³ ì¹¨ (ì§€ì—° ì‹¤í–‰)
	            setTimeout(() => {
	                productGrid.refreshLayout();
	                console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ê·¸ë¦¬ë“œ ë¦¬í”„ë ˆì‹œ ì™„ë£Œ");
	            }, 500);
	        });
	    } else {
	        console.warn("âŒ productGridê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
	    }
	}
	
	// âœ… ëª¨ë‹¬ì´ ì™„ì „íˆ ì—´ë¦° í›„ ë™ì‘
	document.getElementById('goodsModal').addEventListener('shown.bs.modal', function () {
	    console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ëª¨ë‹¬ì´ ì™„ì „íˆ ì—´ë¦¼");

	    if (typeof productGrid !== 'undefined' && productGrid !== null) {
	        setTimeout(() => {
	            productGrid.refreshLayout();
	            console.log("ğŸ“¢ ìƒí’ˆ ì¡°íšŒ ê·¸ë¦¬ë“œ ë¦¬í”„ë ˆì‹œ ì‹¤í–‰ë¨");
	        }, 500);
	    } else {
	        console.warn("âŒ productGridê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
	    }
	});
	
	// âœ… ëª¨ë‹¬ ë‹«í ë•Œ sessionStorage ê°’ ê°€ì ¸ì™€ì„œ ê·¸ë¦¬ë“œì— ì €ì¥
	function setupModalCloseEvent() {
		console.log("âœ… ëª¨ë‹¬ ë‹«í˜ ì´ë²¤íŠ¸ ì‹¤í–‰");

		 
	  

	 const rowKey = purchaseGrid.getFocusedCell()?.rowKey;
	        if (rowKey === null || rowKey === undefined) {
	            console.warn("âŒ ë¨¼ì € í–‰ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.");
	            return;
	        }
			
			
	//âœ… sessionStorageì˜ keyì™€ ê·¸ë¦¬ë“œì˜ nameì„ ë§¤ì¹­
		 const dataMap = {
		            selectedGoodsCode: "goodsCode",
		            selectedGoodsName: "goodsName",
		            selectedOptionCode: "optionCode",
		            selectedOptionName: "optionName",
					selectedOptionNum : "optionNum",
		            selectedVendorName: "vendorName",
					selectedVendorId: "vendorId",
		            selectedGoodsStandard: "goodsStandard",
		            selectedGoodsSupplyPrice: "purchaseUnitPrice"
		        };

		        Object.keys(dataMap).forEach(storageKey => {
		            const gridColumn = dataMap[storageKey];
		            const value = sessionStorage.getItem(storageKey);
		            if (value) {
		            	warehousinglistGrid.setValue(rowKey, gridColumn, value);
		                sessionStorage.removeItem(storageKey); // âœ… ì‚¬ìš©í•œ ë°ì´í„° ì‚­ì œ
		            }
		        });
		
	

        console.log("âœ… ë°œì£¼ ê·¸ë¦¬ë“œì— ë°ì´í„° ì €ì¥ ì™„ë£Œ");
	  
	}


 
  
</script>

</body>

