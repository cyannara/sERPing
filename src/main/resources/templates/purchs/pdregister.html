<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ë“±ë¡</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <!-- toast grid -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">ìƒí’ˆ ë“±ë¡</h2>
    
    <form th:action="@{purchs/product/register}" method="post">
        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">ìƒí’ˆëª…</label>
                <input type="text" class="form-control" name="productName" th:value="${product.name}">
            </div>
            <div class="col-md-6">
                <label class="form-label">ìƒí’ˆë²ˆí˜¸</label>
                <input type="text" class="form-control" name="productCode" th:value="${product.code}" readonly>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">ìƒí’ˆë¶„ë¥˜</label>
                <select class="form-select" name="category">
                    <option value="makeup" selected>ì•„ì´ë©”ì´í¬ì—…</option>
                    <option value="makeup" selected>ìŠ¤í‚¨ì¼€ì–´</option>
                    <option value="makeup" selected>ë² ì´ìŠ¤ë©”ì´í¬ì—…</option>
                    <option value="makeup" selected>ë¦½ë©”ì´í¬ì—…</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="form-label">ë¸Œëœë“œ</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="brand" th:value="${product.brand}" readonly>
                    <button class="btn btn-secondary">ğŸ”</button>
                </div>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">ê³µê¸‰ì²˜</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="supplier" th:value="${product.supplier}" readonly>
                    <button class="btn btn-secondary">ğŸ”</button>
                </div>
            </div>
            <div class="col-md-6">
                <label class="form-label">ì›ê°€</label>
                <input type="text" class="form-control" name="cost" th:value="${product.cost}">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">íŒë§¤ê°€</label>
                <input type="text" class="form-control" name="price" th:value="${product.price}">
            </div>
            <div class="col-md-6">
                <label class="form-label">ê³µê¸‰ê°€ì•¡</label>
                <input type="text" class="form-control" name="supplyAmount" th:value="${product.supplyAmount}">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">ê·œê²©</label>
                <input type="text" class="form-control" name="size" th:value="${product.size}">
            </div>
            <div class="col-md-6">
                <label class="form-label">ë‹´ë‹¹ì</label>
                <input type="text" class="form-control" name="manager" th:value="${product.manager}" readonly>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">ëŒ€í‘œ ì´ë¯¸ì§€</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="image" th:value="${product?.image}" readonly>
                    <button class="btn btn-secondary">ğŸ“‚</button>
                </div>
            </div>
            <div class="col-md-6">
                <label class="form-label">ìƒí’ˆì„¤ëª…</label>
                <div class="input-group">
                    <textarea class="form-control" name="description" rows="2"></textarea>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-between mb-3">
            <div>
                <input type="checkbox" id="singleRegister" name="registerType">
                <label for="singleRegister">ë‹¨ê±´ ë“±ë¡</label>
        
                <input type="checkbox" id="optionRegister" name="registerType">
                <label for="optionRegister">ì˜µì…˜ ë“±ë¡</label>
            </div>
        </div>
        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-primary mb-3" id="bttAdd">ì˜µì…˜ ì¶”ê°€</button>
        </div>
        <div id="myGrid" class="tui-grid-container"  style="height: 200px;"></div>
        <div id="pagination" class="tui-pagination"></div>
        <div class="mt-4">
            <button type="submit" class="btn btn-success">ë“±ë¡</button>
            <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
        </div>
    </form>
</div>

<script>
    var Grid = tui.Grid;
    //ì…ë ¥ ì°½ì˜ ê²½ìš° 
    const dataSource = [];
    // ì‚¬ìš©ì ì •ì˜ ë Œë”ëŸ¬ (ì‚­ì œ ë²„íŠ¼ ì¶”ê°€)
    class DeleteRenderer {
        constructor(props) {
            const el = document.createElement('button');
            el.textContent = 'ì‚­ì œ';
            el.className = 'btnDelete btn btn-danger btn-sm';
            el.addEventListener('click', () => {
                grid.removeRow(props.rowKey); // í´ë¦­ ì‹œ í•´ë‹¹ í–‰ ì‚­ì œ
            });
            this.el = el;
        }
        getElement() {
            return this.el;
        }
    }

    const grid = new Grid({
        el: document.getElementById('myGrid'), // ì»¨í…Œì´ë„ˆ ì—˜ë¦¬ë¨¼íŠ¸
        rowHeaders: ['checkbox'], 
        columns: [ 
            {header : "ì˜µì…˜ì½”ë“œ" , name:"optionCode",className: "tui-grid-cell-readonly"},
            {header : "ì˜µì…˜ëª…" , name:"optionName" , editor: "text"},
            {header : "í˜„ì¬ì¬ê³ " , name:"currentAmount",className: "tui-grid-cell-readonly"},
            {header : "ì•ˆì „ì¬ê³ " , name:"optionSafetyInvoice" , className: "tui-grid-cell-readonly"},
            {header : "ìƒí’ˆìœ„ì¹˜" , name:"warehouseName" , editor: "text"},
            {
                header : "ì‚­ì œ"
                ,name: "delete"
                ,renderer: {
                type: DeleteRenderer // ì‚­ì œë²„íŠ¼ ì •ì˜ ë Œë”ëŸ¬
                }  
                ,cellStyle: { textAlign: "center" }
                ,className: "tui-grid-cell-readonly"
            }
        ],
        data: dataSource
    });
    

    document.addEventListener("DOMContentLoaded", function(){
        const singleRegister = document.getElementById("singleRegister");
        const optionRegister = document.getElementById("optionRegister");
        const bttAdd = document.getElementById("bttAdd");
         // ë‹¨ê±´ ì¡°íšŒê°€ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function isSingleRowExists() {
            return grid.getData().some(row => row.optionName === "ë‹¨ê±´");
        }

          // ëª¨ë“  í–‰ ì‚­ì œ í•¨ìˆ˜ (removeRow ì‚¬ìš©)
        function deleteAllRows() {
            const rowKeys = grid.getData().map(row => row.rowKey); // ëª¨ë“  í–‰ì˜ rowKeyë¥¼ ì–»ìŒ
            rowKeys.forEach(key => {
                grid.removeRow(key); // ê° í–‰ì„ ì‚­ì œ
            });
        }
        

        
        //ë‹¨ê±´ë“±ë¡ì‹œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ 
        singleRegister.addEventListener("change", function(){
             // ì²´í¬ ìƒíƒœ ë³€ê²½ ì‹œ ê¸°ì¡´ í–‰ ì‚­ì œ
            deleteAllRows();

            if (this.checked) {
                if (!isSingleRowExists()) {
                    grid.appendRow({ optionName: "ë‹¨ê±´" }, { at: 0 }); // ì˜µì…˜ëª… "ë‹¨ê±´" ì¶”ê°€
                }
                // ë‹¨ê±´ì´ ì¶”ê°€ë˜ë©´ bttAdd ë¹„í™œì„±í™”
                bttAdd.disabled = true;
                optionRegister.checked= false;
            }else {
                bttAdd.disabled = false; // ë‹¤ì‹œ bttAdd ë²„íŠ¼ í™œì„±í™”
            }
        });

        optionRegister.addEventListener("change", function(){
            if(this.checked){
                grid.appendRow({}, { at: 0 }); // ë¹ˆ í–‰ ì¶”ê°€
                singleRegister.checked= false;
                bttAdd.disabled = false; // bttAdd ë²„íŠ¼ í™œì„±í™”
            }else {
                bttAdd.disabled = false; // ë‹¤ì‹œ bttAdd ë²„íŠ¼ í™œì„±í™”
            }
        });

        // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        // í–‰ì¶”ê°€
        bttAdd.addEventListener("click", function () {
            if (!singleRegister.checked && optionRegister.checked) {
                grid.appendRow({}, { at: 0 }); // ë¹ˆ í–‰ ì¶”ê°€
            }
        });
    });
        
    


    


</script>

</body>
</html>
